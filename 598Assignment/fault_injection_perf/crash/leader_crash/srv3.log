2022-04-27T12:03:08.750_856+00:00 [16039] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:03:08.752_246+00:00 [16039] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:03:08.752_276+00:00 [16039] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:03:08.752_280+00:00 [16039] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:03:08.752_304+00:00 [16039] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:03:08.752_308+00:00 [16039] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:03:08.752_312+00:00 [16039] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:03:08.752_345+00:00 [16039] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:03:08.752_491+00:00 [16076] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:03:10.307_811+00:00 [16047] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:03:10.307_822+00:00 [16047] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:03:10.307_837+00:00 [16047] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:03:10.307_854+00:00 [16047] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:03:10.307_860+00:00 [16047] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:03:10.307_864+00:00 [16047] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:03:10.307_883+00:00 [16047] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:03:10.307_937+00:00 [16075] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:03:10.307_945+00:00 [16075] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:03:10.307_954+00:00 [16075] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:03:20.311_622+00:00 [16047] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:03:20.311_637+00:00 [16047] [INFO] session 1 got connection from 127.0.0.1:51080 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:03:20.311_740+00:00 [16047] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:03:20.311_766+00:00 [16047] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:03:20.311_831+00:00 [16047] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:03:20.311_866+00:00 [16047] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:03:20.311_869+00:00 [16047] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:03:20.311_871+00:00 [16047] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:03:20.311_881+00:00 [16047] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:03:20.312_651+00:00 [16047] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51080 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:03:20.812_949+00:00 [16047] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:03:20.812_969+00:00 [16047] [INFO] session 2 got connection from 127.0.0.1:51082 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:03:20.813_090+00:00 [16047] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:03:20.813_094+00:00 [16047] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:03:20.813_289+00:00 [16047] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:03:20.813_294+00:00 [16047] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:03:20.813_366+00:00 [16075] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:03:20.813_370+00:00 [16075] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:03:20.813_379+00:00 [16075] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:03:20.813_382+00:00 [16075] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:03:20.813_389+00:00 [16075] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:03:20.813_402+00:00 [16075] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:03:20.813_408+00:00 [16075] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:03:20.813_428+00:00 [16075] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:03:40.558_987+00:00 [16066] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51082 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:03:41.502_106+00:00 [16066] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:03:41.502_130+00:00 [16066] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:03:41.502_138+00:00 [16066] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:03:41.502_212+00:00 [16066] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:03:41.502_257+00:00 [16066] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:03:41.502_750+00:00 [16066] [INFO] 0x7fa360002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:03:41.502_948+00:00 [16066] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:03:41.503_018+00:00 [16066] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:03:41.700_134+00:00 [16043] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:03:41.700_148+00:00 [16043] [INFO] session 3 got connection from 127.0.0.1:51084 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:03:41.700_253+00:00 [16043] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:03:41.700_261+00:00 [16043] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:03:41.700_425+00:00 [16043] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:03:41.700_448+00:00 [16043] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:03:41.700_457+00:00 [16043] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:03:41.700_468+00:00 [16043] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:03:41.700_671+00:00 [16043] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:03:41.700_900+00:00 [16075] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:03:41.700_923+00:00 [16075] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:03:41.700_940+00:00 [16075] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:03:45.558_445+00:00 [16064] [INFO] 0x7fa32c001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:03:45.558_761+00:00 [16064] [INFO] 0x7fa3200014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:04:30.626_237+00:00 [16481] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:04:30.627_622+00:00 [16481] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:04:30.627_652+00:00 [16481] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:04:30.627_658+00:00 [16481] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:04:30.627_681+00:00 [16481] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:04:30.627_685+00:00 [16481] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:04:30.627_688+00:00 [16481] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:04:30.627_720+00:00 [16481] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:04:30.627_871+00:00 [16518] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:04:32.014_931+00:00 [16489] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:04:32.014_944+00:00 [16489] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:04:32.014_959+00:00 [16489] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:04:32.014_971+00:00 [16489] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:04:32.014_978+00:00 [16489] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:04:32.014_982+00:00 [16489] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:04:32.015_002+00:00 [16489] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:04:32.015_059+00:00 [16517] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:04:32.015_069+00:00 [16517] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:04:32.015_080+00:00 [16517] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:04:42.940_652+00:00 [16489] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:04:42.940_676+00:00 [16489] [INFO] session 1 got connection from 127.0.0.1:51086 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:04:42.940_784+00:00 [16489] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:04:42.940_809+00:00 [16489] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:04:42.940_873+00:00 [16489] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:04:42.940_906+00:00 [16489] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:04:42.940_909+00:00 [16489] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:04:42.940_911+00:00 [16489] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:04:42.940_921+00:00 [16489] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:04:42.941_641+00:00 [16489] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51086 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:04:43.441_929+00:00 [16489] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:04:43.441_946+00:00 [16489] [INFO] session 2 got connection from 127.0.0.1:51088 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:04:43.442_060+00:00 [16489] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:04:43.442_064+00:00 [16489] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:04:43.442_232+00:00 [16489] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:04:43.442_237+00:00 [16489] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:04:43.442_312+00:00 [16517] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:04:43.442_315+00:00 [16517] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:04:43.442_325+00:00 [16517] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:04:43.442_327+00:00 [16517] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:04:43.442_335+00:00 [16517] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:04:43.442_350+00:00 [16517] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:04:43.442_355+00:00 [16517] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:04:43.442_378+00:00 [16517] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:05:02.184_658+00:00 [16508] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51088 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:05:03.156_722+00:00 [16508] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:05:03.156_737+00:00 [16508] [INFO] session 3 got connection from 127.0.0.1:51090 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:05:03.156_836+00:00 [16508] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:05:03.156_843+00:00 [16508] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:05:03.865_366+00:00 [16508] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:05:03.865_389+00:00 [16508] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:05:03.865_396+00:00 [16508] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:05:03.865_476+00:00 [16508] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:05:03.865_511+00:00 [16508] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:05:03.865_908+00:00 [16508] [INFO] 0x7f226c013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:05:03.866_112+00:00 [16508] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:03.866_184+00:00 [16508] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:05:03.866_187+00:00 [16508] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:05:03.866_188+00:00 [16508] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:05:03.866_198+00:00 [16508] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:05:03.866_372+00:00 [16503] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:05:03.866_378+00:00 [16503] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:05:03.866_387+00:00 [16503] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:05:03.866_390+00:00 [16503] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:05:03.866_426+00:00 [16503] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:05:03.866_552+00:00 [16503] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:05:03.866_771+00:00 [16517] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:05:03.866_793+00:00 [16517] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:05:03.866_809+00:00 [16517] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:05:03.866_970+00:00 [16503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:04.367_622+00:00 [16497] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:04.917_569+00:00 [16497] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:05.517_788+00:00 [16497] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:06.167_944+00:00 [16497] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:06.868_058+00:00 [16497] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:07.184_508+00:00 [16497] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:07.312_463+00:00 [16488] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:07.568_728+00:00 [16490] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:08.068_796+00:00 [16503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:08.568_842+00:00 [16489] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:09.068_749+00:00 [16508] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:09.568_929+00:00 [16487] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:10.068_858+00:00 [16509] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:10.569_023+00:00 [16509] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:11.069_200+00:00 [16492] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:11.569_105+00:00 [16503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:12.069_328+00:00 [16492] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:05:12.569_404+00:00 [16486] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:05:21.148_461+00:00 [16517] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:05:21.148_474+00:00 [16517] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:05:21.148_499+00:00 [16517] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:05:21.148_505+00:00 [16517] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:05:52.255_990+00:00 [16925] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:05:52.257_352+00:00 [16925] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:05:52.257_382+00:00 [16925] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:05:52.257_386+00:00 [16925] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:05:52.257_412+00:00 [16925] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:05:52.257_416+00:00 [16925] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:05:52.257_419+00:00 [16925] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:05:52.257_454+00:00 [16925] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:05:52.257_607+00:00 [16962] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:05:53.822_691+00:00 [16933] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:05:53.822_704+00:00 [16933] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:05:53.822_720+00:00 [16933] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:05:53.822_732+00:00 [16933] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:05:53.822_739+00:00 [16933] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:05:53.822_743+00:00 [16933] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:05:53.822_763+00:00 [16933] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:05:53.822_821+00:00 [16961] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:05:53.822_829+00:00 [16961] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:05:53.822_839+00:00 [16961] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:06:04.065_750+00:00 [16933] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:06:04.065_772+00:00 [16933] [INFO] session 1 got connection from 127.0.0.1:51092 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:06:04.065_879+00:00 [16933] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:06:04.065_905+00:00 [16933] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:06:04.065_965+00:00 [16933] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:06:04.066_001+00:00 [16933] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:06:04.066_004+00:00 [16933] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:06:04.066_006+00:00 [16933] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:06:04.066_015+00:00 [16933] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:06:04.066_751+00:00 [16933] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51092 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:06:04.567_159+00:00 [16933] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:06:04.567_175+00:00 [16933] [INFO] session 2 got connection from 127.0.0.1:51094 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:06:04.567_278+00:00 [16933] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:06:04.567_281+00:00 [16933] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:06:04.567_432+00:00 [16933] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:06:04.567_436+00:00 [16933] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:06:04.567_503+00:00 [16961] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:06:04.567_507+00:00 [16961] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:06:04.567_516+00:00 [16961] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:06:04.567_517+00:00 [16961] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:06:04.567_525+00:00 [16961] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:06:04.567_538+00:00 [16961] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:06:04.567_542+00:00 [16961] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:06:04.567_562+00:00 [16961] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:06:24.063_580+00:00 [16953] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51094 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:06:25.151_406+00:00 [16953] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:06:25.151_430+00:00 [16953] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:06:25.151_438+00:00 [16953] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:06:25.151_510+00:00 [16953] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:06:25.151_555+00:00 [16953] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:06:25.151_997+00:00 [16953] [INFO] 0x7f29e4002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:06:25.152_199+00:00 [16953] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:06:25.152_273+00:00 [16953] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:06:25.648_639+00:00 [16953] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:06:25.648_654+00:00 [16953] [INFO] session 3 got connection from 127.0.0.1:51096 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:06:25.648_730+00:00 [16953] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:06:25.648_737+00:00 [16953] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:06:25.648_935+00:00 [16953] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:06:25.648_954+00:00 [16953] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:06:25.648_962+00:00 [16953] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:06:25.648_971+00:00 [16953] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:06:25.649_146+00:00 [16953] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:06:25.649_317+00:00 [16961] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:06:25.649_335+00:00 [16961] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:06:25.649_349+00:00 [16961] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:06:29.063_647+00:00 [16953] [INFO] 0x7f29a8001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:06:29.063_982+00:00 [16950] [INFO] 0x7f29a00014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:06:41.678_868+00:00 [16955] [INFO] 0x7f29a8021390 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:07:14.133_302+00:00 [17357] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:07:14.134_692+00:00 [17357] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:07:14.134_731+00:00 [17357] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:07:14.134_741+00:00 [17357] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:07:14.134_767+00:00 [17357] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:07:14.134_773+00:00 [17357] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:07:14.134_777+00:00 [17357] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:07:14.134_831+00:00 [17357] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:07:14.135_017+00:00 [17394] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:07:15.919_999+00:00 [17365] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:07:15.920_009+00:00 [17365] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:07:15.920_024+00:00 [17365] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:07:15.920_035+00:00 [17365] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:07:15.920_042+00:00 [17365] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:07:15.920_046+00:00 [17365] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:07:15.920_065+00:00 [17365] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:07:15.920_114+00:00 [17393] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:07:15.920_122+00:00 [17393] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:07:15.920_131+00:00 [17393] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:07:26.197_978+00:00 [17365] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:07:26.197_997+00:00 [17365] [INFO] session 1 got connection from 127.0.0.1:51098 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:07:26.198_097+00:00 [17365] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:07:26.198_123+00:00 [17365] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:07:26.198_185+00:00 [17365] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:07:26.198_218+00:00 [17365] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:07:26.198_221+00:00 [17365] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:07:26.198_224+00:00 [17365] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:07:26.198_234+00:00 [17365] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:07:26.198_975+00:00 [17365] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51098 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:07:26.699_289+00:00 [17365] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:07:26.699_306+00:00 [17365] [INFO] session 2 got connection from 127.0.0.1:51100 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:07:26.699_406+00:00 [17365] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:07:26.699_410+00:00 [17365] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:07:26.699_580+00:00 [17365] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:07:26.699_585+00:00 [17365] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:07:26.699_651+00:00 [17393] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:07:26.699_655+00:00 [17393] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:07:26.699_664+00:00 [17393] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:07:26.699_665+00:00 [17393] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:07:26.699_672+00:00 [17393] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:07:26.699_686+00:00 [17393] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:07:26.699_691+00:00 [17393] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:07:26.699_710+00:00 [17393] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:07:45.941_262+00:00 [17384] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51100 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:07:47.213_752+00:00 [17384] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:07:47.213_765+00:00 [17384] [INFO] session 3 got connection from 127.0.0.1:51102 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:07:47.213_861+00:00 [17384] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:07:47.213_869+00:00 [17384] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:07:47.622_999+00:00 [17384] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:07:47.623_021+00:00 [17384] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:07:47.623_030+00:00 [17384] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:07:47.623_107+00:00 [17384] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:07:47.623_145+00:00 [17384] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:07:47.623_551+00:00 [17384] [INFO] 0x7f1758013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:07:47.623_748+00:00 [17384] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:47.623_810+00:00 [17384] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:07:47.623_813+00:00 [17384] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:07:47.623_815+00:00 [17384] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:07:47.623_824+00:00 [17384] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:07:47.623_980+00:00 [17384] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:07:47.623_984+00:00 [17384] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:07:47.623_991+00:00 [17384] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:07:47.623_995+00:00 [17384] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:07:47.624_035+00:00 [17384] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:07:47.624_105+00:00 [17384] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:07:47.624_354+00:00 [17393] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:07:47.624_370+00:00 [17393] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:07:47.624_381+00:00 [17393] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:07:47.624_487+00:00 [17384] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:48.124_544+00:00 [17377] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:48.674_637+00:00 [17377] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:49.274_809+00:00 [17377] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:49.924_955+00:00 [17377] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:50.625_137+00:00 [17362] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:50.941_113+00:00 [17362] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:51.069_054+00:00 [17378] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:51.325_321+00:00 [17368] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:51.825_479+00:00 [17391] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:52.325_373+00:00 [17388] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:52.825_409+00:00 [17376] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:53.325_503+00:00 [17364] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:53.825_668+00:00 [17375] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:54.325_677+00:00 [17373] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:54.825_766+00:00 [17389] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:55.325_709+00:00 [17367] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:55.825_663+00:00 [17389] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:07:56.325_737+00:00 [17384] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:08:05.012_380+00:00 [17393] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:08:05.012_388+00:00 [17393] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:08:05.012_411+00:00 [17393] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:08:05.012_416+00:00 [17393] [INFO] create snapshot idx 100000 log_term 2 done: 24 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:08:36.013_938+00:00 [17816] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:08:36.015_584+00:00 [17816] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:08:36.015_615+00:00 [17816] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:08:36.015_619+00:00 [17816] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:08:36.015_644+00:00 [17816] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:08:36.015_648+00:00 [17816] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:08:36.015_652+00:00 [17816] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:08:36.015_683+00:00 [17816] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:08:36.015_837+00:00 [17853] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:08:37.778_883+00:00 [17824] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:08:37.778_895+00:00 [17824] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:08:37.778_911+00:00 [17824] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:08:37.778_923+00:00 [17824] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:08:37.778_930+00:00 [17824] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:08:37.778_934+00:00 [17824] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:08:37.778_954+00:00 [17824] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:08:37.779_009+00:00 [17852] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:08:37.779_018+00:00 [17852] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:08:37.779_029+00:00 [17852] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:08:48.328_411+00:00 [17824] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:08:48.328_432+00:00 [17824] [INFO] session 1 got connection from 127.0.0.1:51104 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:08:48.328_536+00:00 [17824] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:08:48.328_561+00:00 [17824] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:08:48.328_621+00:00 [17824] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:08:48.328_655+00:00 [17824] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:08:48.328_658+00:00 [17824] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:08:48.328_660+00:00 [17824] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:08:48.328_669+00:00 [17824] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:08:48.329_383+00:00 [17824] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51104 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:08:48.829_689+00:00 [17824] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:08:48.829_705+00:00 [17824] [INFO] session 2 got connection from 127.0.0.1:51106 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:08:48.829_815+00:00 [17824] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:08:48.829_819+00:00 [17824] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:08:48.829_992+00:00 [17824] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:08:48.829_997+00:00 [17824] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:08:48.830_068+00:00 [17852] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:08:48.830_072+00:00 [17852] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:08:48.830_081+00:00 [17852] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:08:48.830_083+00:00 [17852] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:08:48.830_090+00:00 [17852] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:08:48.830_104+00:00 [17852] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:08:48.830_109+00:00 [17852] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:08:48.830_129+00:00 [17852] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:09:07.821_792+00:00 [17843] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51106 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:09:09.037_595+00:00 [17843] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:09:09.037_608+00:00 [17843] [INFO] session 3 got connection from 127.0.0.1:51110 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:09:09.037_710+00:00 [17843] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:09:09.037_718+00:00 [17843] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:09:09.060_518+00:00 [17843] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:09:09.060_537+00:00 [17843] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:09:09.060_544+00:00 [17843] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:09:09.060_620+00:00 [17843] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:09:09.060_659+00:00 [17843] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:09:09.061_070+00:00 [17843] [INFO] 0x7f5b68013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:09:09.061_262+00:00 [17843] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:09.061_319+00:00 [17843] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:09:09.061_322+00:00 [17843] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:09:09.061_324+00:00 [17843] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:09:09.061_334+00:00 [17843] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:09:09.061_505+00:00 [17838] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:09:09.061_511+00:00 [17838] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:09:09.061_520+00:00 [17838] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:09:09.061_523+00:00 [17838] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:09:09.061_560+00:00 [17838] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:09:09.061_637+00:00 [17838] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:09:09.061_904+00:00 [17852] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:09:09.061_916+00:00 [17852] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:09:09.061_925+00:00 [17852] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:09:09.062_024+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:09.562_032+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:10.112_138+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:10.712_357+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:11.362_488+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:12.062_644+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:12.812_746+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:12.940_922+00:00 [17844] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:13.197_059+00:00 [17828] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:13.696_972+00:00 [17838] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:14.197_105+00:00 [17840] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:14.697_104+00:00 [17839] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:15.197_348+00:00 [17827] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:15.697_307+00:00 [17835] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:16.197_434+00:00 [17829] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:16.697_596+00:00 [17821] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:17.197_599+00:00 [17828] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:17.697_498+00:00 [17830] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:09:18.197_673+00:00 [17833] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:09:26.743_309+00:00 [17852] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:09:26.743_322+00:00 [17852] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:09:26.743_349+00:00 [17852] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:09:26.743_354+00:00 [17852] [INFO] create snapshot idx 100000 log_term 2 done: 27 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:09:57.891_087+00:00 [18268] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:09:57.892_585+00:00 [18268] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:09:57.892_631+00:00 [18268] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:09:57.892_636+00:00 [18268] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:09:57.892_669+00:00 [18268] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:09:57.892_675+00:00 [18268] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:09:57.892_678+00:00 [18268] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:09:57.892_714+00:00 [18268] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:09:57.892_908+00:00 [18305] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:09:58.954_948+00:00 [18276] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:09:58.954_960+00:00 [18276] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:09:58.954_974+00:00 [18276] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:09:58.954_985+00:00 [18276] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:09:58.954_992+00:00 [18276] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:09:58.954_995+00:00 [18276] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:09:58.955_014+00:00 [18276] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:09:58.955_064+00:00 [18304] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:09:58.955_072+00:00 [18304] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:09:58.955_082+00:00 [18304] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:10:10.205_910+00:00 [18276] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:10:10.205_932+00:00 [18276] [INFO] session 1 got connection from 127.0.0.1:51112 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:10:10.206_034+00:00 [18276] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:10:10.206_060+00:00 [18276] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:10:10.206_124+00:00 [18276] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:10:10.206_158+00:00 [18276] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:10:10.206_161+00:00 [18276] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:10:10.206_163+00:00 [18276] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:10:10.206_172+00:00 [18276] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:10:10.206_888+00:00 [18276] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51112 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:10:10.707_202+00:00 [18276] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:10:10.707_217+00:00 [18276] [INFO] session 2 got connection from 127.0.0.1:51114 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:10:10.707_322+00:00 [18276] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:10:10.707_326+00:00 [18276] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:10:10.707_488+00:00 [18276] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:10:10.707_492+00:00 [18276] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:10:10.707_560+00:00 [18304] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:10:10.707_564+00:00 [18304] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:10:10.707_573+00:00 [18304] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:10:10.707_574+00:00 [18304] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:10:10.707_582+00:00 [18304] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:10:10.707_595+00:00 [18304] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:10:10.707_600+00:00 [18304] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:10:10.707_619+00:00 [18304] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:10:29.198_585+00:00 [18294] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51114 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:10:29.821_739+00:00 [18294] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:10:29.821_762+00:00 [18294] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:10:29.821_772+00:00 [18294] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:10:29.821_846+00:00 [18294] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:10:29.821_892+00:00 [18294] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:10:29.822_347+00:00 [18294] [INFO] 0x7f2100002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:10:29.822_555+00:00 [18294] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:10:29.822_630+00:00 [18294] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:10:29.991_089+00:00 [18294] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:10:29.991_103+00:00 [18294] [INFO] session 3 got connection from 127.0.0.1:51116 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:10:29.991_178+00:00 [18294] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:10:29.991_185+00:00 [18294] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:10:29.991_382+00:00 [18294] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:10:29.991_404+00:00 [18294] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:10:29.991_413+00:00 [18294] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:10:29.991_424+00:00 [18294] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:10:29.991_631+00:00 [18294] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:10:29.991_887+00:00 [18304] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:10:29.991_909+00:00 [18304] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:10:29.991_923+00:00 [18304] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:10:34.198_187+00:00 [18275] [INFO] 0x7f20cc001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:10:34.198_491+00:00 [18286] [INFO] 0x7f20c40014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:11:19.266_728+00:00 [18693] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:11:19.268_057+00:00 [18693] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:11:19.268_088+00:00 [18693] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:11:19.268_094+00:00 [18693] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:11:19.268_117+00:00 [18693] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:11:19.268_121+00:00 [18693] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:11:19.268_124+00:00 [18693] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:11:19.268_157+00:00 [18693] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:11:19.268_310+00:00 [18730] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:11:20.489_372+00:00 [18701] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:11:20.489_383+00:00 [18701] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:11:20.489_396+00:00 [18701] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:11:20.489_410+00:00 [18701] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:11:20.489_416+00:00 [18701] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:11:20.489_419+00:00 [18701] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:11:20.489_436+00:00 [18701] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:11:20.489_482+00:00 [18729] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:11:20.489_489+00:00 [18729] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:11:20.489_497+00:00 [18729] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:11:30.828_006+00:00 [18701] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:11:30.828_053+00:00 [18701] [INFO] session 1 got connection from 127.0.0.1:51118 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:11:30.828_266+00:00 [18701] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:11:30.828_312+00:00 [18701] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:11:30.828_428+00:00 [18701] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:11:30.828_485+00:00 [18701] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:11:30.828_489+00:00 [18701] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:11:30.828_492+00:00 [18701] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:11:30.828_505+00:00 [18701] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:11:30.829_550+00:00 [18701] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51118 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:11:31.329_782+00:00 [18701] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:11:31.329_796+00:00 [18701] [INFO] session 2 got connection from 127.0.0.1:51120 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:11:31.329_889+00:00 [18701] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:11:31.329_893+00:00 [18701] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:11:31.330_032+00:00 [18701] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:11:31.330_035+00:00 [18701] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:11:31.330_094+00:00 [18729] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:11:31.330_097+00:00 [18729] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:11:31.330_104+00:00 [18729] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:11:31.330_106+00:00 [18729] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:11:31.330_112+00:00 [18729] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:11:31.330_123+00:00 [18729] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:11:31.330_127+00:00 [18729] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:11:31.330_144+00:00 [18729] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:11:50.574_085+00:00 [18700] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51120 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:11:51.795_023+00:00 [18700] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:11:51.795_047+00:00 [18700] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:11:51.795_056+00:00 [18700] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:11:51.795_135+00:00 [18700] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:11:51.795_183+00:00 [18700] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:11:51.795_976+00:00 [18700] [INFO] 0x7fb990002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:11:51.796_183+00:00 [18700] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:11:51.796_245+00:00 [18700] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:11:51.802_479+00:00 [18700] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:11:51.802_489+00:00 [18700] [INFO] session 3 got connection from 127.0.0.1:51124 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:11:51.802_550+00:00 [18700] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:11:51.802_557+00:00 [18700] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:11:51.802_740+00:00 [18700] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:11:51.802_760+00:00 [18700] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:11:51.802_769+00:00 [18700] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:11:51.802_781+00:00 [18700] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:11:51.803_005+00:00 [18700] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:11:51.803_227+00:00 [18729] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:11:51.803_250+00:00 [18729] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:11:51.803_266+00:00 [18729] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:11:55.573_596+00:00 [18713] [INFO] 0x7fb954001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:11:55.573_986+00:00 [18713] [INFO] 0x7fb94c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:12:40.642_688+00:00 [19118] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:12:40.644_038+00:00 [19118] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:12:40.644_072+00:00 [19118] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:12:40.644_077+00:00 [19118] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:12:40.644_102+00:00 [19118] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:12:40.644_107+00:00 [19118] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:12:40.644_110+00:00 [19118] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:12:40.644_144+00:00 [19118] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:12:40.644_298+00:00 [19155] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:12:42.344_336+00:00 [19126] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:12:42.344_348+00:00 [19126] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:12:42.344_363+00:00 [19126] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:12:42.344_375+00:00 [19126] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:12:42.344_381+00:00 [19126] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:12:42.344_385+00:00 [19126] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:12:42.344_404+00:00 [19126] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:12:42.344_454+00:00 [19154] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:12:42.344_462+00:00 [19154] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:12:42.344_472+00:00 [19154] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:12:52.707_743+00:00 [19126] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:12:52.707_761+00:00 [19126] [INFO] session 1 got connection from 127.0.0.1:51126 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:12:52.707_876+00:00 [19126] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:12:52.707_903+00:00 [19126] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:12:52.707_966+00:00 [19126] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:12:52.708_002+00:00 [19126] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:12:52.708_005+00:00 [19126] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:12:52.708_007+00:00 [19126] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:12:52.708_015+00:00 [19126] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:12:52.708_773+00:00 [19126] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51126 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:12:53.209_065+00:00 [19126] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:12:53.209_079+00:00 [19126] [INFO] session 2 got connection from 127.0.0.1:51128 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:12:53.209_176+00:00 [19126] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:12:53.209_179+00:00 [19126] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:12:53.209_339+00:00 [19126] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:12:53.209_343+00:00 [19126] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:12:53.209_423+00:00 [19154] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:12:53.209_427+00:00 [19154] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:12:53.209_437+00:00 [19154] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:12:53.209_439+00:00 [19154] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:12:53.209_448+00:00 [19154] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:12:53.209_464+00:00 [19154] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:12:53.209_468+00:00 [19154] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:12:53.209_485+00:00 [19154] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:13:12.450_480+00:00 [19143] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51128 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:13:13.043_561+00:00 [19143] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:13:13.043_576+00:00 [19143] [INFO] session 3 got connection from 127.0.0.1:51130 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:13:13.043_686+00:00 [19143] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:13:13.043_695+00:00 [19143] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:13:13.229_793+00:00 [19143] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:13:13.229_817+00:00 [19143] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:13:13.229_825+00:00 [19143] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:13:13.229_911+00:00 [19143] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:13:13.229_949+00:00 [19143] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:13:13.230_392+00:00 [19143] [INFO] 0x7f3e40013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:13:13.230_599+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:13.230_700+00:00 [19143] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:13:13.230_703+00:00 [19143] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:13:13.230_705+00:00 [19143] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:13:13.230_716+00:00 [19143] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:13:13.230_870+00:00 [19143] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:13:13.230_874+00:00 [19143] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:13:13.230_881+00:00 [19143] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:13:13.230_885+00:00 [19143] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:13:13.230_923+00:00 [19143] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:13:13.231_027+00:00 [19143] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:13:13.231_219+00:00 [19154] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:13:13.231_236+00:00 [19154] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:13:13.231_248+00:00 [19154] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:13:13.231_383+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:13.731_404+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:14.281_487+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:14.881_646+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:15.531_790+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:16.231_970+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:16.982_122+00:00 [19122] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:17.450_314+00:00 [19122] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:17.706_368+00:00 [19134] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:18.206_377+00:00 [19150] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:18.706_373+00:00 [19142] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:19.206_531+00:00 [19140] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:19.706_604+00:00 [19153] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:20.206_696+00:00 [19147] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:20.706_814+00:00 [19131] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:21.206_893+00:00 [19137] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:21.706_887+00:00 [19150] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:22.206_879+00:00 [19143] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:13:22.706_949+00:00 [19134] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:13:31.438_798+00:00 [19154] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:13:31.438_806+00:00 [19154] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:13:31.438_831+00:00 [19154] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:13:31.438_836+00:00 [19154] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:14:02.523_392+00:00 [19568] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:14:02.524_736+00:00 [19568] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:14:02.524_768+00:00 [19568] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:14:02.524_771+00:00 [19568] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:14:02.524_793+00:00 [19568] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:14:02.524_796+00:00 [19568] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:14:02.524_799+00:00 [19568] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:14:02.524_827+00:00 [19568] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:14:02.524_972+00:00 [19605] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:14:03.868_030+00:00 [19576] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:14:03.868_042+00:00 [19576] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:14:03.868_057+00:00 [19576] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:14:03.868_073+00:00 [19576] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:14:03.868_079+00:00 [19576] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:14:03.868_083+00:00 [19576] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:14:03.868_101+00:00 [19576] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:14:03.868_152+00:00 [19604] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:14:03.868_160+00:00 [19604] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:14:03.868_170+00:00 [19604] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:14:14.338_168+00:00 [19576] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:14:14.338_193+00:00 [19576] [INFO] session 1 got connection from 127.0.0.1:51132 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:14:14.338_307+00:00 [19576] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:14:14.338_335+00:00 [19576] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:14:14.338_397+00:00 [19576] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:14:14.338_429+00:00 [19576] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:14:14.338_432+00:00 [19576] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:14:14.338_434+00:00 [19576] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:14:14.338_443+00:00 [19576] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:14:14.339_158+00:00 [19576] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51132 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:14:14.839_474+00:00 [19576] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:14:14.839_491+00:00 [19576] [INFO] session 2 got connection from 127.0.0.1:51134 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:14:14.839_596+00:00 [19576] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:14:14.839_600+00:00 [19576] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:14:14.839_761+00:00 [19576] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:14:14.839_765+00:00 [19576] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:14:14.839_835+00:00 [19604] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:14:14.839_839+00:00 [19604] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:14:14.839_848+00:00 [19604] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:14:14.839_850+00:00 [19604] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:14:14.839_857+00:00 [19604] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:14:14.839_871+00:00 [19604] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:14:14.839_875+00:00 [19604] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:14:14.839_895+00:00 [19604] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:14:34.080_625+00:00 [19592] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51134 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:14:35.461_674+00:00 [19592] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:14:35.461_688+00:00 [19592] [INFO] session 3 got connection from 127.0.0.1:51136 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:14:35.461_788+00:00 [19592] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:14:35.461_796+00:00 [19592] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:14:35.553_620+00:00 [19592] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:14:35.553_643+00:00 [19592] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:14:35.553_650+00:00 [19592] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:14:35.553_732+00:00 [19592] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:14:35.553_768+00:00 [19592] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:14:35.554_200+00:00 [19592] [INFO] 0x7f15f8013df0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:14:35.554_388+00:00 [19592] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:35.554_462+00:00 [19592] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:14:35.554_465+00:00 [19592] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:14:35.554_467+00:00 [19592] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:14:35.554_476+00:00 [19592] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:14:35.554_686+00:00 [19572] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:14:35.554_694+00:00 [19572] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:14:35.554_702+00:00 [19572] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:14:35.554_705+00:00 [19572] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:14:35.554_742+00:00 [19572] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:14:35.554_868+00:00 [19572] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:14:35.555_069+00:00 [19604] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:14:35.555_089+00:00 [19604] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:14:35.555_103+00:00 [19604] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:14:35.555_262+00:00 [19572] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:36.055_221+00:00 [19572] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:36.605_232+00:00 [19572] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:37.205_461+00:00 [19572] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:37.855_619+00:00 [19572] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:38.555_879+00:00 [19573] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:39.080_415+00:00 [19573] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:39.208_378+00:00 [19577] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:39.464_406+00:00 [19577] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:39.964_535+00:00 [19587] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:40.464_572+00:00 [19583] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:40.964_594+00:00 [19584] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:41.464_673+00:00 [19599] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:41.964_930+00:00 [19579] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:42.464_827+00:00 [19591] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:42.965_167+00:00 [19603] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:43.465_182+00:00 [19582] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:43.965_134+00:00 [19603] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:14:44.465_330+00:00 [19597] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:14:53.197_186+00:00 [19604] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:14:53.197_198+00:00 [19604] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:14:53.197_223+00:00 [19604] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:14:53.197_228+00:00 [19604] [INFO] create snapshot idx 100000 log_term 2 done: 24 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:15:24.153_054+00:00 [20018] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:15:24.154_422+00:00 [20018] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:15:24.154_455+00:00 [20018] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:15:24.154_459+00:00 [20018] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:15:24.154_483+00:00 [20018] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:15:24.154_487+00:00 [20018] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:15:24.154_489+00:00 [20018] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:15:24.154_523+00:00 [20018] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:15:24.154_683+00:00 [20055] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:15:25.737_816+00:00 [20026] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:15:25.737_840+00:00 [20026] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:15:25.737_876+00:00 [20026] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:15:25.737_903+00:00 [20026] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:15:25.737_919+00:00 [20026] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:15:25.737_930+00:00 [20026] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:15:25.737_980+00:00 [20026] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:15:25.738_114+00:00 [20054] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:15:25.738_140+00:00 [20054] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:15:25.738_167+00:00 [20054] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:15:36.211_714+00:00 [20026] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:15:36.211_744+00:00 [20026] [INFO] session 1 got connection from 127.0.0.1:51138 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:15:36.211_865+00:00 [20026] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:15:36.211_891+00:00 [20026] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:15:36.211_956+00:00 [20026] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:15:36.211_991+00:00 [20026] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:15:36.211_994+00:00 [20026] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:15:36.211_996+00:00 [20026] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:15:36.212_004+00:00 [20026] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:15:36.212_731+00:00 [20026] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51138 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:15:36.713_346+00:00 [20026] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:15:36.713_393+00:00 [20026] [INFO] session 2 got connection from 127.0.0.1:51140 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:15:36.713_724+00:00 [20026] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:15:36.713_738+00:00 [20026] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:15:36.713_880+00:00 [20026] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:15:36.713_884+00:00 [20026] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:15:36.713_950+00:00 [20054] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:15:36.713_954+00:00 [20054] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:15:36.713_962+00:00 [20054] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:15:36.713_964+00:00 [20054] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:15:36.713_971+00:00 [20054] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:15:36.713_984+00:00 [20054] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:15:36.713_989+00:00 [20054] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:15:36.714_008+00:00 [20054] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:15:55.960_508+00:00 [20044] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51140 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:15:56.933_967+00:00 [20044] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:15:56.933_982+00:00 [20044] [INFO] session 3 got connection from 127.0.0.1:51142 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:15:56.934_085+00:00 [20044] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:15:56.934_094+00:00 [20044] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:15:57.445_612+00:00 [20044] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:15:57.445_637+00:00 [20044] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:15:57.445_646+00:00 [20044] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:15:57.445_730+00:00 [20044] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:15:57.445_773+00:00 [20044] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:15:57.446_228+00:00 [20044] [INFO] 0x7f0bdc013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:15:57.446_423+00:00 [20044] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:15:57.446_496+00:00 [20044] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:15:57.446_499+00:00 [20044] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:15:57.446_501+00:00 [20044] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:15:57.446_512+00:00 [20044] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:15:57.446_695+00:00 [20044] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:15:57.446_699+00:00 [20044] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:15:57.446_706+00:00 [20044] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:15:57.446_710+00:00 [20044] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:15:57.446_747+00:00 [20044] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:15:57.446_858+00:00 [20044] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:15:57.447_038+00:00 [20054] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:15:57.447_054+00:00 [20054] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:15:57.447_066+00:00 [20054] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:15:57.447_200+00:00 [20044] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:15:57.947_295+00:00 [20038] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:15:58.497_321+00:00 [20038] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:15:59.097_467+00:00 [20038] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:15:59.747_687+00:00 [20038] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:00.447_896+00:00 [20022] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:00.960_355+00:00 [20022] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:01.088_395+00:00 [20038] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:01.344_445+00:00 [20051] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:01.844_587+00:00 [20046] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:02.344_774+00:00 [20045] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:02.844_810+00:00 [20039] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:03.344_858+00:00 [20047] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:03.844_935+00:00 [20040] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:04.345_045+00:00 [20046] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:04.845_186+00:00 [20050] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:05.345_090+00:00 [20032] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:05.845_304+00:00 [20044] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:16:06.345_512+00:00 [20035] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:16:14.924_710+00:00 [20054] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:16:14.924_718+00:00 [20054] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:16:14.924_743+00:00 [20054] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:16:14.924_748+00:00 [20054] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:30:22.269_402+00:00 [23398] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:30:22.271_691+00:00 [23398] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:30:22.271_722+00:00 [23398] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:30:22.271_731+00:00 [23398] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:30:22.271_757+00:00 [23398] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:30:22.271_761+00:00 [23398] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:30:22.271_765+00:00 [23398] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:30:22.271_794+00:00 [23398] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:30:22.272_325+00:00 [23435] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:30:24.060_119+00:00 [23406] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:30:24.060_144+00:00 [23406] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:30:24.060_182+00:00 [23406] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:30:24.060_208+00:00 [23406] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:30:24.060_223+00:00 [23406] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:30:24.060_234+00:00 [23406] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:30:24.060_283+00:00 [23406] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:30:24.060_419+00:00 [23434] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:30:24.060_446+00:00 [23434] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:30:24.060_473+00:00 [23434] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:30:34.084_347+00:00 [23406] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:30:34.084_369+00:00 [23406] [INFO] session 1 got connection from 127.0.0.1:51144 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:30:34.084_473+00:00 [23406] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:30:34.084_499+00:00 [23406] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:30:34.084_561+00:00 [23406] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:30:34.084_595+00:00 [23406] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:30:34.084_598+00:00 [23406] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:30:34.084_600+00:00 [23406] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:30:34.084_608+00:00 [23406] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:30:34.085_383+00:00 [23406] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51144 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:30:34.585_735+00:00 [23406] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:30:34.585_751+00:00 [23406] [INFO] session 2 got connection from 127.0.0.1:51146 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:30:34.585_854+00:00 [23406] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:30:34.585_858+00:00 [23406] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:30:34.586_020+00:00 [23406] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:30:34.586_025+00:00 [23406] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:30:34.586_091+00:00 [23434] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:30:34.586_095+00:00 [23434] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:30:34.586_104+00:00 [23434] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:30:34.586_106+00:00 [23434] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:30:34.586_113+00:00 [23434] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:30:34.586_127+00:00 [23434] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:30:34.586_132+00:00 [23434] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:30:34.586_151+00:00 [23434] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:30:54.077_913+00:00 [23418] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51146 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:30:54.812_880+00:00 [23418] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:30:54.812_903+00:00 [23418] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:30:54.812_911+00:00 [23418] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:30:54.812_984+00:00 [23418] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:30:54.813_029+00:00 [23418] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:30:54.813_491+00:00 [23418] [INFO] 0x7fdf18002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:30:54.813_703+00:00 [23418] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:30:54.813_767+00:00 [23418] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:30:55.246_038+00:00 [23418] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:30:55.246_052+00:00 [23418] [INFO] session 3 got connection from 127.0.0.1:51148 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:30:55.246_128+00:00 [23418] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:30:55.246_136+00:00 [23418] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:30:55.246_308+00:00 [23418] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:30:55.246_330+00:00 [23418] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:30:55.246_339+00:00 [23418] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:30:55.246_352+00:00 [23418] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:30:55.246_577+00:00 [23418] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:30:55.246_832+00:00 [23434] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:30:55.246_856+00:00 [23434] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:30:55.246_872+00:00 [23434] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:30:59.077_564+00:00 [23403] [INFO] 0x7fded8001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:30:59.077_876+00:00 [23403] [INFO] 0x7fdedc0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:31:44.134_859+00:00 [23534] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:31:44.136_406+00:00 [23534] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:31:44.136_442+00:00 [23534] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:31:44.136_446+00:00 [23534] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:31:44.136_470+00:00 [23534] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:31:44.136_474+00:00 [23534] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:31:44.136_477+00:00 [23534] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:31:44.136_505+00:00 [23534] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:31:44.136_655+00:00 [23571] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:31:45.378_871+00:00 [23542] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:31:45.378_897+00:00 [23542] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:31:45.378_935+00:00 [23542] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:31:45.378_962+00:00 [23542] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:31:45.378_979+00:00 [23542] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:31:45.378_989+00:00 [23542] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:31:45.379_040+00:00 [23542] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:31:45.379_175+00:00 [23570] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:31:45.379_201+00:00 [23570] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:31:45.379_226+00:00 [23570] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:31:56.449_696+00:00 [23542] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:31:56.449_719+00:00 [23542] [INFO] session 1 got connection from 127.0.0.1:51150 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:31:56.449_823+00:00 [23542] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:31:56.449_848+00:00 [23542] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:31:56.449_913+00:00 [23542] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:31:56.449_947+00:00 [23542] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:31:56.449_950+00:00 [23542] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:31:56.449_952+00:00 [23542] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:31:56.449_960+00:00 [23542] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:31:56.450_710+00:00 [23542] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51150 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:31:56.951_033+00:00 [23542] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:31:56.951_048+00:00 [23542] [INFO] session 2 got connection from 127.0.0.1:51152 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:31:56.951_156+00:00 [23542] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:31:56.951_160+00:00 [23542] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:31:56.951_357+00:00 [23542] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:31:56.951_361+00:00 [23542] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:31:56.951_429+00:00 [23570] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:31:56.951_432+00:00 [23570] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:31:56.951_441+00:00 [23570] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:31:56.951_443+00:00 [23570] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:31:56.951_451+00:00 [23570] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:31:56.951_465+00:00 [23570] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:31:56.951_469+00:00 [23570] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:31:56.951_491+00:00 [23570] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:32:15.442_558+00:00 [23561] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51152 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:32:16.037_395+00:00 [23561] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:32:16.037_419+00:00 [23561] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:32:16.037_429+00:00 [23561] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:32:16.037_509+00:00 [23561] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:32:16.037_560+00:00 [23561] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:32:16.038_024+00:00 [23561] [INFO] 0x7fedc4002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:32:16.038_225+00:00 [23561] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:32:16.038_290+00:00 [23561] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:32:16.441_895+00:00 [23561] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:32:16.441_910+00:00 [23561] [INFO] session 3 got connection from 127.0.0.1:51154 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:32:16.441_990+00:00 [23561] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:32:16.441_998+00:00 [23561] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:32:16.442_213+00:00 [23561] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:32:16.442_238+00:00 [23561] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:32:16.442_247+00:00 [23561] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:32:16.442_259+00:00 [23561] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:32:16.442_487+00:00 [23561] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:32:16.442_754+00:00 [23570] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:32:16.442_775+00:00 [23570] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:32:16.442_790+00:00 [23570] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:32:20.442_116+00:00 [23558] [INFO] 0x7fed90001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:32:20.442_438+00:00 [23558] [INFO] 0x7fed880014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:33:05.511_726+00:00 [23721] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:33:05.513_916+00:00 [23721] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:33:05.513_950+00:00 [23721] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:33:05.513_956+00:00 [23721] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:33:05.513_980+00:00 [23721] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:33:05.513_985+00:00 [23721] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:33:05.513_989+00:00 [23721] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:33:05.514_019+00:00 [23721] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:33:05.514_571+00:00 [23758] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:33:07.093_306+00:00 [23729] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:33:07.093_317+00:00 [23729] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:33:07.093_330+00:00 [23729] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:33:07.093_344+00:00 [23729] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:33:07.093_349+00:00 [23729] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:33:07.093_353+00:00 [23729] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:33:07.093_370+00:00 [23729] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:33:07.093_417+00:00 [23757] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:33:07.093_423+00:00 [23757] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:33:07.093_432+00:00 [23757] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:33:17.826_041+00:00 [23729] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:33:17.826_064+00:00 [23729] [INFO] session 1 got connection from 127.0.0.1:51156 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:33:17.826_171+00:00 [23729] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:33:17.826_196+00:00 [23729] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:33:17.826_260+00:00 [23729] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:33:17.826_293+00:00 [23729] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:33:17.826_296+00:00 [23729] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:33:17.826_298+00:00 [23729] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:33:17.826_306+00:00 [23729] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:33:17.827_050+00:00 [23729] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51156 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:33:18.327_408+00:00 [23729] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:33:18.327_424+00:00 [23729] [INFO] session 2 got connection from 127.0.0.1:51158 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:33:18.327_529+00:00 [23729] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:33:18.327_533+00:00 [23729] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:33:18.327_698+00:00 [23729] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:33:18.327_703+00:00 [23729] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:33:18.327_772+00:00 [23757] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:33:18.327_776+00:00 [23757] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:33:18.327_784+00:00 [23757] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:33:18.327_786+00:00 [23757] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:33:18.327_793+00:00 [23757] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:33:18.327_807+00:00 [23757] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:33:18.327_811+00:00 [23757] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:33:18.327_831+00:00 [23757] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:33:37.320_411+00:00 [23745] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51158 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:33:38.254_214+00:00 [23745] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:33:38.254_240+00:00 [23745] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:33:38.254_249+00:00 [23745] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:33:38.254_325+00:00 [23745] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:33:38.254_372+00:00 [23745] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:33:38.254_856+00:00 [23745] [INFO] 0x7f514c002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:33:38.255_062+00:00 [23745] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:33:38.255_134+00:00 [23745] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:33:38.355_007+00:00 [23745] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:33:38.355_022+00:00 [23745] [INFO] session 3 got connection from 127.0.0.1:51160 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:33:38.355_099+00:00 [23745] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:33:38.355_107+00:00 [23745] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:33:38.355_334+00:00 [23745] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:33:38.355_357+00:00 [23745] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:33:38.355_367+00:00 [23745] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:33:38.355_379+00:00 [23745] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:33:38.355_620+00:00 [23744] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:33:38.355_780+00:00 [23757] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:33:38.355_797+00:00 [23757] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:33:38.355_809+00:00 [23757] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:33:42.320_001+00:00 [23744] [INFO] 0x7f5110001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:33:42.320_297+00:00 [23744] [INFO] 0x7f51040014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:33:50.186_950+00:00 [23756] [INFO] 0x7f511001f4f0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:34:27.389_583+00:00 [23924] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:34:27.390_974+00:00 [23924] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:34:27.391_004+00:00 [23924] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:34:27.391_011+00:00 [23924] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:34:27.391_033+00:00 [23924] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:34:27.391_037+00:00 [23924] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:34:27.391_040+00:00 [23924] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:34:27.391_073+00:00 [23924] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:34:27.391_255+00:00 [23961] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:34:29.167_298+00:00 [23932] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:34:29.167_310+00:00 [23932] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:34:29.167_325+00:00 [23932] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:34:29.167_336+00:00 [23932] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:34:29.167_343+00:00 [23932] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:34:29.167_347+00:00 [23932] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:34:29.167_367+00:00 [23932] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:34:29.167_423+00:00 [23960] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:34:29.167_431+00:00 [23960] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:34:29.167_442+00:00 [23960] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:34:39.204_164+00:00 [23932] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:34:39.204_189+00:00 [23932] [INFO] session 1 got connection from 127.0.0.1:51162 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:34:39.204_302+00:00 [23932] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:34:39.204_329+00:00 [23932] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:34:39.204_391+00:00 [23932] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:34:39.204_423+00:00 [23932] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:34:39.204_426+00:00 [23932] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:34:39.204_428+00:00 [23932] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:34:39.204_436+00:00 [23932] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:34:39.205_290+00:00 [23932] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51162 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:34:39.705_620+00:00 [23932] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:34:39.705_636+00:00 [23932] [INFO] session 2 got connection from 127.0.0.1:51164 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:34:39.705_741+00:00 [23932] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:34:39.705_744+00:00 [23932] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:34:39.705_911+00:00 [23932] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:34:39.705_915+00:00 [23932] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:34:39.705_984+00:00 [23960] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:34:39.705_987+00:00 [23960] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:34:39.705_996+00:00 [23960] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:34:39.705_998+00:00 [23960] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:34:39.706_005+00:00 [23960] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:34:39.706_019+00:00 [23960] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:34:39.706_024+00:00 [23960] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:34:39.706_044+00:00 [23960] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:37:05.241_227+00:00 [24227] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:37:05.242_607+00:00 [24227] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:37:05.242_644+00:00 [24227] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:37:05.242_650+00:00 [24227] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:37:05.242_691+00:00 [24227] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:37:05.242_697+00:00 [24227] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:37:05.242_708+00:00 [24227] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:37:05.242_744+00:00 [24227] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:37:05.242_896+00:00 [24264] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:37:06.647_955+00:00 [24235] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:37:06.647_967+00:00 [24235] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:37:06.647_981+00:00 [24235] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:37:06.647_997+00:00 [24235] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:37:06.648_003+00:00 [24235] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:37:06.648_008+00:00 [24235] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:37:06.648_026+00:00 [24235] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:37:06.648_080+00:00 [24263] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:37:06.648_088+00:00 [24263] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:37:06.648_098+00:00 [24263] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:37:17.555_700+00:00 [24235] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:37:17.555_724+00:00 [24235] [INFO] session 1 got connection from 127.0.0.1:51166 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:37:17.555_838+00:00 [24235] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:37:17.555_864+00:00 [24235] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:37:17.555_925+00:00 [24235] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:37:17.555_960+00:00 [24235] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:37:17.555_963+00:00 [24235] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:37:17.555_965+00:00 [24235] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:37:17.555_973+00:00 [24235] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:37:17.556_702+00:00 [24235] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51166 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:37:18.057_024+00:00 [24235] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:37:18.057_040+00:00 [24235] [INFO] session 2 got connection from 127.0.0.1:51168 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:37:18.057_149+00:00 [24235] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:37:18.057_153+00:00 [24235] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:37:18.057_325+00:00 [24235] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:37:18.057_330+00:00 [24235] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:37:18.057_405+00:00 [24263] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:37:18.057_409+00:00 [24263] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:37:18.057_419+00:00 [24263] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:37:18.057_421+00:00 [24263] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:37:18.057_429+00:00 [24263] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:37:18.057_444+00:00 [24263] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:37:18.057_450+00:00 [24263] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:37:18.057_472+00:00 [24263] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:37:36.798_722+00:00 [24259] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51168 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:37:37.714_403+00:00 [24259] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:37:37.714_417+00:00 [24259] [INFO] session 3 got connection from 127.0.0.1:51170 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:37:37.714_515+00:00 [24259] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:37:37.714_523+00:00 [24259] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:37:38.509_168+00:00 [24259] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:37:38.509_191+00:00 [24259] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:37:38.509_199+00:00 [24259] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:37:38.509_286+00:00 [24259] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:37:38.509_324+00:00 [24259] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:37:38.509_776+00:00 [24259] [INFO] 0x7fc2fc013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:37:38.509_967+00:00 [24259] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:38.510_030+00:00 [24259] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:37:38.510_033+00:00 [24259] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:37:38.510_035+00:00 [24259] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:37:38.510_046+00:00 [24259] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:37:38.510_255+00:00 [24255] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:37:38.510_265+00:00 [24255] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:37:38.510_273+00:00 [24255] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:37:38.510_276+00:00 [24255] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:37:38.510_311+00:00 [24255] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:37:38.510_433+00:00 [24255] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:37:38.510_632+00:00 [24263] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:37:38.510_653+00:00 [24263] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:37:38.510_689+00:00 [24263] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:37:38.510_860+00:00 [24255] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:39.010_856+00:00 [24255] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:39.560_861+00:00 [24255] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:40.161_015+00:00 [24255] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:40.811_219+00:00 [24255] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:41.511_313+00:00 [24255] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:41.798_705+00:00 [24255] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:41.926_725+00:00 [24244] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:42.182_741+00:00 [24233] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:42.682_906+00:00 [24246] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:43.183_079+00:00 [24239] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:43.683_167+00:00 [24233] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:44.183_115+00:00 [24235] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:44.683_243+00:00 [24256] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:45.183_130+00:00 [24242] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:45.683_302+00:00 [24237] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:46.183_424+00:00 [24231] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:46.683_542+00:00 [24256] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:37:47.183_447+00:00 [24233] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:37:55.819_625+00:00 [24263] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:37:55.819_634+00:00 [24263] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:37:55.819_659+00:00 [24263] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:37:55.819_665+00:00 [24263] [INFO] create snapshot idx 100000 log_term 2 done: 26 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:39:46.922_571+00:00 [25043] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:39:46.924_003+00:00 [25043] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:39:46.924_036+00:00 [25043] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:39:46.924_043+00:00 [25043] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:39:46.924_066+00:00 [25043] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:39:46.924_070+00:00 [25043] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:39:46.924_073+00:00 [25043] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:39:46.924_106+00:00 [25043] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:39:46.924_255+00:00 [25080] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:39:48.189_326+00:00 [25051] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:39:48.189_337+00:00 [25051] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:39:48.189_350+00:00 [25051] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:39:48.189_360+00:00 [25051] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:39:48.189_365+00:00 [25051] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:39:48.189_369+00:00 [25051] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:39:48.189_385+00:00 [25051] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:39:48.189_432+00:00 [25079] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:39:48.189_439+00:00 [25079] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:39:48.189_448+00:00 [25079] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:39:58.988_407+00:00 [25051] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:39:58.988_431+00:00 [25051] [INFO] session 1 got connection from 127.0.0.1:51172 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:39:58.988_534+00:00 [25051] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:39:58.988_559+00:00 [25051] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:39:58.988_615+00:00 [25051] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:39:58.988_644+00:00 [25051] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:39:58.988_647+00:00 [25051] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:39:58.988_649+00:00 [25051] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:39:58.988_656+00:00 [25051] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:39:58.989_355+00:00 [25051] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51172 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:39:59.489_628+00:00 [25051] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:39:59.489_648+00:00 [25051] [INFO] session 2 got connection from 127.0.0.1:51174 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:39:59.489_769+00:00 [25051] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:39:59.489_774+00:00 [25051] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:39:59.489_969+00:00 [25051] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:39:59.489_975+00:00 [25051] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:39:59.490_047+00:00 [25079] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:39:59.490_051+00:00 [25079] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:39:59.490_059+00:00 [25079] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:39:59.490_061+00:00 [25079] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:39:59.490_068+00:00 [25079] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:39:59.490_082+00:00 [25079] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:39:59.490_087+00:00 [25079] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:39:59.490_108+00:00 [25079] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:40:18.230_230+00:00 [25074] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51174 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:40:19.261_116+00:00 [25074] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:40:19.261_128+00:00 [25074] [INFO] session 3 got connection from 127.0.0.1:51178 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:40:19.261_224+00:00 [25074] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:40:19.261_232+00:00 [25074] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:40:19.745_929+00:00 [25074] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:40:19.745_972+00:00 [25074] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:40:19.745_986+00:00 [25074] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:40:19.746_125+00:00 [25074] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:40:19.746_185+00:00 [25074] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:40:19.747_970+00:00 [25074] [INFO] 0x7f5f0c013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:40:19.748_274+00:00 [25074] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:19.748_378+00:00 [25074] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:40:19.748_381+00:00 [25074] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:40:19.748_382+00:00 [25074] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:40:19.748_396+00:00 [25074] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:40:19.748_605+00:00 [25068] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:40:19.748_612+00:00 [25068] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:40:19.748_617+00:00 [25068] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:40:19.748_619+00:00 [25068] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:40:19.748_653+00:00 [25068] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:40:19.748_783+00:00 [25068] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:40:19.748_990+00:00 [25079] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:40:19.749_011+00:00 [25079] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:40:19.749_033+00:00 [25079] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:40:19.749_213+00:00 [25074] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:20.249_179+00:00 [25074] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:20.799_232+00:00 [25074] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:21.399_418+00:00 [25047] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:22.049_567+00:00 [25047] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:22.750_399+00:00 [25047] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:23.230_426+00:00 [25064] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:23.358_254+00:00 [25076] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:23.614_573+00:00 [25061] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:24.114_552+00:00 [25057] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:24.614_562+00:00 [25060] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:25.114_715+00:00 [25067] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:25.614_765+00:00 [25057] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:26.114_932+00:00 [25055] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:26.615_001+00:00 [25073] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:27.115_066+00:00 [25055] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:27.615_182+00:00 [25063] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:28.115_256+00:00 [25071] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:40:28.615_837+00:00 [25050] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:40:37.247_028+00:00 [25079] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:40:37.247_041+00:00 [25079] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:40:37.247_066+00:00 [25079] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:40:37.247_072+00:00 [25079] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:41:08.305_268+00:00 [25402] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:41:08.306_952+00:00 [25402] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:41:08.306_992+00:00 [25402] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:41:08.306_997+00:00 [25402] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:41:08.307_026+00:00 [25402] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:41:08.307_032+00:00 [25402] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:41:08.307_035+00:00 [25402] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:41:08.307_068+00:00 [25402] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:41:08.307_241+00:00 [25439] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:41:09.710_285+00:00 [25410] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:41:09.710_297+00:00 [25410] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:41:09.710_311+00:00 [25410] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:41:09.710_324+00:00 [25410] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:41:09.710_330+00:00 [25410] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:41:09.710_333+00:00 [25410] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:41:09.710_351+00:00 [25410] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:41:09.710_405+00:00 [25438] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:41:09.710_413+00:00 [25438] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:41:09.710_422+00:00 [25438] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:41:20.370_043+00:00 [25410] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:41:20.370_061+00:00 [25410] [INFO] session 1 got connection from 127.0.0.1:51180 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:41:20.370_196+00:00 [25410] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:41:20.370_226+00:00 [25410] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:41:20.370_292+00:00 [25410] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:41:20.370_328+00:00 [25410] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:41:20.370_330+00:00 [25410] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:41:20.370_333+00:00 [25410] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:41:20.370_341+00:00 [25410] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:41:20.371_137+00:00 [25410] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51180 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:41:20.871_414+00:00 [25410] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:41:20.871_428+00:00 [25410] [INFO] session 2 got connection from 127.0.0.1:51182 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:41:20.871_527+00:00 [25410] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:41:20.871_531+00:00 [25410] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:41:20.871_697+00:00 [25410] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:41:20.871_701+00:00 [25410] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:41:20.871_779+00:00 [25438] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:41:20.871_784+00:00 [25438] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:41:20.871_805+00:00 [25438] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:41:20.871_807+00:00 [25438] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:41:20.871_815+00:00 [25438] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:41:20.871_828+00:00 [25438] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:41:20.871_833+00:00 [25438] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:41:20.871_853+00:00 [25438] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:41:39.863_509+00:00 [25406] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51182 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:41:40.781_723+00:00 [25406] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:41:40.781_744+00:00 [25406] [INFO] session 3 got connection from 127.0.0.1:51184 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:41:40.781_897+00:00 [25406] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:41:40.781_906+00:00 [25406] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:41:41.201_792+00:00 [25406] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:41:41.201_814+00:00 [25406] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:41:41.201_822+00:00 [25406] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:41:41.201_898+00:00 [25406] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:41:41.201_940+00:00 [25406] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:41:41.202_387+00:00 [25406] [INFO] 0x7f0a04013c50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:41:41.202_586+00:00 [25406] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:41.202_654+00:00 [25406] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:41:41.202_656+00:00 [25406] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:41:41.202_684+00:00 [25406] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:41:41.202_714+00:00 [25406] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:41:41.202_900+00:00 [25427] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:41:41.202_906+00:00 [25427] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:41:41.202_919+00:00 [25427] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:41:41.202_923+00:00 [25427] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:41:41.202_958+00:00 [25427] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:41:41.203_081+00:00 [25427] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:41:41.203_246+00:00 [25438] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:41:41.203_267+00:00 [25438] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:41:41.203_282+00:00 [25438] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:41:41.203_437+00:00 [25429] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:41.703_518+00:00 [25429] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:42.253_565+00:00 [25429] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:42.853_781+00:00 [25429] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:43.503_899+00:00 [25429] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:44.204_216+00:00 [25429] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:44.863_776+00:00 [25429] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:44.991_897+00:00 [25424] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:45.248_030+00:00 [25413] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:45.748_016+00:00 [25433] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:46.248_319+00:00 [25421] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:46.748_378+00:00 [25418] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:47.248_496+00:00 [25419] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:47.748_448+00:00 [25426] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:48.248_495+00:00 [25410] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:48.748_817+00:00 [25407] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:49.248_882+00:00 [25406] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:49.749_066+00:00 [25418] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:41:50.249_226+00:00 [25423] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:41:53.382_708+00:00 [25438] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:41:53.382_720+00:00 [25438] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:41:53.382_745+00:00 [25438] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:41:53.382_750+00:00 [25438] [INFO] create snapshot idx 100000 log_term 2 done: 24 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:42:01.911_563+00:00 [25438] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:42:01.911_571+00:00 [25438] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:42:01.911_594+00:00 [25438] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:42:01.911_599+00:00 [25438] [INFO] create snapshot idx 200000 log_term 2 done: 23 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:42:37.743_981+00:00 [25869] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:42:37.745_541+00:00 [25869] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:42:37.745_573+00:00 [25869] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:42:37.745_578+00:00 [25869] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:42:37.745_599+00:00 [25869] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:42:37.745_603+00:00 [25869] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:42:37.745_606+00:00 [25869] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:42:37.745_634+00:00 [25869] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:42:37.745_844+00:00 [25906] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:42:39.239_837+00:00 [25877] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:42:39.239_848+00:00 [25877] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:42:39.239_862+00:00 [25877] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:42:39.239_878+00:00 [25877] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:42:39.239_884+00:00 [25877] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:42:39.239_888+00:00 [25877] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:42:39.239_906+00:00 [25877] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:42:39.239_958+00:00 [25905] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:42:39.239_967+00:00 [25905] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:42:39.239_977+00:00 [25905] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:42:49.300_868+00:00 [25877] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:42:49.300_890+00:00 [25877] [INFO] session 1 got connection from 127.0.0.1:51186 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:42:49.301_001+00:00 [25877] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:42:49.301_030+00:00 [25877] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:42:49.301_097+00:00 [25877] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:42:49.301_133+00:00 [25877] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:42:49.301_137+00:00 [25877] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:42:49.301_139+00:00 [25877] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:42:49.301_148+00:00 [25877] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:42:49.301_895+00:00 [25877] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51186 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:42:49.802_198+00:00 [25877] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:42:49.802_218+00:00 [25877] [INFO] session 2 got connection from 127.0.0.1:51188 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:42:49.802_348+00:00 [25877] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:42:49.802_797+00:00 [25877] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:42:49.802_982+00:00 [25877] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:42:49.802_987+00:00 [25877] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:42:49.803_056+00:00 [25905] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:42:49.803_059+00:00 [25905] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:42:49.803_068+00:00 [25905] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:42:49.803_070+00:00 [25905] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:42:49.803_077+00:00 [25905] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:42:49.803_091+00:00 [25905] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:42:49.803_096+00:00 [25905] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:42:49.803_116+00:00 [25905] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:43:09.301_581+00:00 [25891] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51188 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:43:10.108_883+00:00 [25891] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:43:10.108_897+00:00 [25891] [INFO] session 3 got connection from 127.0.0.1:51190 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:43:10.108_998+00:00 [25891] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:43:10.109_006+00:00 [25891] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:43:10.370_418+00:00 [25891] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:43:10.370_442+00:00 [25891] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:43:10.370_450+00:00 [25891] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:43:10.370_544+00:00 [25891] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:43:10.370_594+00:00 [25891] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:43:10.371_086+00:00 [25891] [INFO] 0x7f6a14013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:43:10.371_284+00:00 [25891] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:10.371_352+00:00 [25891] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:43:10.371_355+00:00 [25891] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:43:10.371_357+00:00 [25891] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:43:10.371_367+00:00 [25891] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:43:10.371_527+00:00 [25891] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:43:10.371_531+00:00 [25891] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:43:10.371_538+00:00 [25891] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:43:10.371_542+00:00 [25891] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:43:10.371_580+00:00 [25891] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:43:10.371_694+00:00 [25891] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:43:10.371_885+00:00 [25905] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:43:10.371_909+00:00 [25905] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:43:10.371_925+00:00 [25905] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:43:10.372_096+00:00 [25891] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:10.872_135+00:00 [25876] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:11.422_144+00:00 [25876] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:12.022_329+00:00 [25876] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:12.672_485+00:00 [25876] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:13.372_681+00:00 [25873] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:14.122_900+00:00 [25873] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:14.301_410+00:00 [25873] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:14.557_880+00:00 [25904] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:15.057_429+00:00 [25884] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:15.557_404+00:00 [25891] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:16.057_601+00:00 [25903] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:16.557_776+00:00 [25884] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:17.057_855+00:00 [25885] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:17.557_917+00:00 [25898] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:18.058_088+00:00 [25894] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:18.558_272+00:00 [25892] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:19.058_303+00:00 [25904] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:43:19.558_254+00:00 [25896] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:43:28.329_686+00:00 [25905] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:43:28.329_698+00:00 [25905] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:43:28.329_724+00:00 [25905] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:43:28.329_729+00:00 [25905] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:43:59.374_718+00:00 [26221] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:43:59.376_111+00:00 [26221] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:43:59.376_142+00:00 [26221] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:43:59.376_149+00:00 [26221] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:43:59.376_170+00:00 [26221] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:43:59.376_175+00:00 [26221] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:43:59.376_177+00:00 [26221] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:43:59.376_212+00:00 [26221] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:43:59.376_392+00:00 [26258] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:44:00.855_471+00:00 [26229] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:44:00.855_483+00:00 [26229] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:44:00.855_498+00:00 [26229] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:44:00.855_510+00:00 [26229] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:44:00.855_517+00:00 [26229] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:44:00.855_521+00:00 [26229] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:44:00.855_540+00:00 [26229] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:44:00.855_591+00:00 [26257] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:44:00.855_599+00:00 [26257] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:44:00.855_609+00:00 [26257] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:44:11.441_566+00:00 [26229] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:44:11.441_605+00:00 [26229] [INFO] session 1 got connection from 127.0.0.1:51194 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:44:11.441_791+00:00 [26229] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:44:11.441_816+00:00 [26229] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:44:11.441_876+00:00 [26229] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:44:11.441_909+00:00 [26229] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:44:11.441_912+00:00 [26229] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:44:11.441_914+00:00 [26229] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:44:11.441_922+00:00 [26229] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:44:11.442_650+00:00 [26229] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51194 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:44:11.942_999+00:00 [26229] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:44:11.943_025+00:00 [26229] [INFO] session 2 got connection from 127.0.0.1:51196 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:44:11.943_127+00:00 [26229] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:44:11.943_130+00:00 [26229] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:44:11.943_288+00:00 [26229] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:44:11.943_292+00:00 [26229] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:44:11.943_361+00:00 [26257] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:44:11.943_365+00:00 [26257] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:44:11.943_373+00:00 [26257] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:44:11.943_375+00:00 [26257] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:44:11.943_383+00:00 [26257] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:44:11.943_396+00:00 [26257] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:44:11.943_401+00:00 [26257] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:44:11.943_420+00:00 [26257] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:44:30.932_472+00:00 [26248] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51196 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:44:32.237_825+00:00 [26248] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:44:32.237_877+00:00 [26248] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:44:32.237_895+00:00 [26248] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:44:32.238_059+00:00 [26248] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:44:32.238_179+00:00 [26248] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:44:32.238_976+00:00 [26248] [INFO] 0x7f9574002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:44:32.239_187+00:00 [26248] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:44:32.239_253+00:00 [26248] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:44:32.389_501+00:00 [26248] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:44:32.389_515+00:00 [26248] [INFO] session 3 got connection from 127.0.0.1:51198 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:44:32.389_591+00:00 [26248] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:44:32.389_598+00:00 [26248] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:44:32.389_810+00:00 [26248] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:44:32.389_832+00:00 [26248] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:44:32.389_842+00:00 [26248] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:44:32.389_853+00:00 [26248] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:44:32.390_087+00:00 [26246] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:44:32.390_296+00:00 [26257] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:44:32.390_317+00:00 [26257] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:44:32.390_332+00:00 [26257] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:44:35.932_434+00:00 [26246] [INFO] 0x7f9534001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:44:35.932_723+00:00 [26246] [INFO] 0x7f95300014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:44:35.933_698+00:00 [26247] [INFO] 0x7f95240014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:44:35.933_918+00:00 [26247] [INFO] 0x7f95200014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:44:51.957_165+00:00 [26257] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:44:51.957_177+00:00 [26257] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:44:51.957_203+00:00 [26257] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:44:51.957_208+00:00 [26257] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:45:21.005_915+00:00 [26569] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:45:21.007_323+00:00 [26569] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:45:21.007_358+00:00 [26569] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:45:21.007_364+00:00 [26569] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:45:21.007_388+00:00 [26569] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:45:21.007_392+00:00 [26569] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:45:21.007_395+00:00 [26569] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:45:21.007_421+00:00 [26569] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:45:21.007_570+00:00 [26606] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:45:22.584_780+00:00 [26577] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:45:22.584_792+00:00 [26577] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:45:22.584_807+00:00 [26577] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:45:22.584_818+00:00 [26577] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:45:22.584_825+00:00 [26577] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:45:22.584_829+00:00 [26577] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:45:22.584_847+00:00 [26577] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:45:22.584_898+00:00 [26605] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:45:22.584_906+00:00 [26605] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:45:22.584_917+00:00 [26605] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:45:32.570_640+00:00 [26577] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:45:32.570_677+00:00 [26577] [INFO] session 1 got connection from 127.0.0.1:51200 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:45:32.570_791+00:00 [26577] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:45:32.570_817+00:00 [26577] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:45:32.570_884+00:00 [26577] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:45:32.570_919+00:00 [26577] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:45:32.570_921+00:00 [26577] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:45:32.570_923+00:00 [26577] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:45:32.570_932+00:00 [26577] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:45:32.571_654+00:00 [26577] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51200 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:45:33.071_990+00:00 [26577] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:45:33.072_005+00:00 [26577] [INFO] session 2 got connection from 127.0.0.1:51202 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:45:33.072_100+00:00 [26577] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:45:33.072_103+00:00 [26577] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:45:33.072_259+00:00 [26577] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:45:33.072_263+00:00 [26577] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:45:33.072_332+00:00 [26605] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:45:33.072_335+00:00 [26605] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:45:33.072_344+00:00 [26605] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:45:33.072_346+00:00 [26605] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:45:33.072_353+00:00 [26605] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:45:33.072_367+00:00 [26605] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:45:33.072_371+00:00 [26605] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:45:33.072_391+00:00 [26605] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:45:52.813_673+00:00 [26585] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51202 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:45:53.339_448+00:00 [26585] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:45:53.339_462+00:00 [26585] [INFO] session 3 got connection from 127.0.0.1:51204 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:45:53.339_557+00:00 [26585] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:45:53.339_564+00:00 [26585] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:45:54.330_854+00:00 [26585] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:45:54.330_879+00:00 [26585] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:45:54.330_888+00:00 [26585] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:45:54.330_979+00:00 [26585] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:45:54.331_024+00:00 [26585] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:45:54.331_510+00:00 [26585] [INFO] 0x7fbd48013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:45:54.331_723+00:00 [26585] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:54.331_784+00:00 [26585] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:45:54.331_787+00:00 [26585] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:45:54.331_789+00:00 [26585] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:45:54.331_799+00:00 [26585] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:45:54.331_960+00:00 [26585] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:45:54.331_964+00:00 [26585] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:45:54.331_971+00:00 [26585] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:45:54.331_975+00:00 [26585] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:45:54.332_012+00:00 [26585] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:45:54.332_122+00:00 [26585] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:45:54.332_304+00:00 [26605] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:45:54.332_325+00:00 [26605] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:45:54.332_341+00:00 [26605] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:45:54.332_506+00:00 [26585] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:54.832_490+00:00 [26590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:55.382_541+00:00 [26590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:55.983_042+00:00 [26590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:56.633_058+00:00 [26590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:57.333_387+00:00 [26590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:57.813_906+00:00 [26590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:57.941_958+00:00 [26580] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:58.198_271+00:00 [26575] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:58.698_314+00:00 [26604] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:59.198_376+00:00 [26573] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:45:59.698_314+00:00 [26595] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:46:00.198_652+00:00 [26594] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:46:00.698_834+00:00 [26600] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:46:01.198_808+00:00 [26575] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:46:01.699_036+00:00 [26586] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:46:02.198_921+00:00 [26573] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:46:02.699_002+00:00 [26580] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:46:03.199_362+00:00 [26604] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:46:04.461_424+00:00 [26605] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:46:04.461_433+00:00 [26605] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:46:04.461_454+00:00 [26605] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:46:04.461_459+00:00 [26605] [INFO] create snapshot idx 100000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:46:11.136_362+00:00 [26605] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:46:11.136_370+00:00 [26605] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:46:11.136_391+00:00 [26605] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:46:11.136_396+00:00 [26605] [INFO] create snapshot idx 200000 log_term 2 done: 21 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:46:42.898_754+00:00 [26921] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:46:42.900_164+00:00 [26921] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:46:42.900_203+00:00 [26921] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:46:42.900_209+00:00 [26921] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:46:42.900_233+00:00 [26921] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:46:42.900_236+00:00 [26921] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:46:42.900_239+00:00 [26921] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:46:42.900_270+00:00 [26921] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:46:42.900_419+00:00 [26958] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:46:44.405_476+00:00 [26929] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:46:44.405_486+00:00 [26929] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:46:44.405_499+00:00 [26929] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:46:44.405_509+00:00 [26929] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:46:44.405_516+00:00 [26929] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:46:44.405_519+00:00 [26929] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:46:44.405_534+00:00 [26929] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:46:44.405_579+00:00 [26957] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:46:44.405_586+00:00 [26957] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:46:44.405_594+00:00 [26957] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:47:16.136_534+00:00 [27129] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:47:16.137_913+00:00 [27129] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:47:16.137_945+00:00 [27129] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:47:16.137_949+00:00 [27129] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:47:16.137_968+00:00 [27129] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:47:16.137_972+00:00 [27129] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:47:16.137_974+00:00 [27129] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:47:16.138_006+00:00 [27129] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:47:16.138_152+00:00 [27166] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:47:18.115_224+00:00 [27137] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:47:18.115_237+00:00 [27137] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:47:18.115_251+00:00 [27137] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:47:18.115_267+00:00 [27137] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:47:18.115_273+00:00 [27137] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:47:18.115_277+00:00 [27137] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:47:18.115_296+00:00 [27137] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:47:18.115_350+00:00 [27165] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:47:18.115_358+00:00 [27165] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:47:18.115_368+00:00 [27165] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:47:27.691_577+00:00 [27137] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:47:27.691_599+00:00 [27137] [INFO] session 1 got connection from 127.0.0.1:51206 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:47:27.691_701+00:00 [27137] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:47:27.691_727+00:00 [27137] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:47:27.691_789+00:00 [27137] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:47:27.691_830+00:00 [27137] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:47:27.691_833+00:00 [27137] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:47:27.691_835+00:00 [27137] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:47:27.691_845+00:00 [27137] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:47:27.692_598+00:00 [27137] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51206 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:47:28.192_888+00:00 [27137] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:47:28.192_903+00:00 [27137] [INFO] session 2 got connection from 127.0.0.1:51208 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:47:28.193_002+00:00 [27137] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:47:28.193_006+00:00 [27137] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:47:28.193_168+00:00 [27137] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:47:28.193_172+00:00 [27137] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:47:28.193_240+00:00 [27165] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:47:28.193_243+00:00 [27165] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:47:28.193_251+00:00 [27165] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:47:28.193_253+00:00 [27165] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:47:28.193_260+00:00 [27165] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:47:28.193_273+00:00 [27165] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:47:28.193_278+00:00 [27165] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:47:28.193_297+00:00 [27165] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:47:48.194_120+00:00 [27134] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51208 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:47:49.401_674+00:00 [27134] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:47:49.401_698+00:00 [27134] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:47:49.401_707+00:00 [27134] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:47:49.401_780+00:00 [27134] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:47:49.401_829+00:00 [27134] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:47:49.402_268+00:00 [27134] [INFO] 0x7f083c002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:47:49.402_433+00:00 [27134] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:47:49.402_494+00:00 [27134] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:47:49.783_247+00:00 [27133] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:47:49.783_260+00:00 [27133] [INFO] session 3 got connection from 127.0.0.1:51210 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:47:49.783_361+00:00 [27133] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:47:49.783_370+00:00 [27133] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:47:49.783_557+00:00 [27133] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:47:49.783_579+00:00 [27133] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:47:49.783_588+00:00 [27133] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:47:49.783_600+00:00 [27133] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:47:49.783_809+00:00 [27133] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:47:49.783_993+00:00 [27165] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:47:49.784_013+00:00 [27165] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:47:49.784_193+00:00 [27165] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:47:53.193_688+00:00 [27137] [INFO] 0x7f0810001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:47:53.193_948+00:00 [27137] [INFO] 0x7f08040014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:47:58.186_871+00:00 [27140] [INFO] 0x7f081001ffd0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:48:38.262_417+00:00 [27315] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:48:38.263_854+00:00 [27315] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:48:38.263_885+00:00 [27315] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:48:38.263_890+00:00 [27315] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:48:38.263_913+00:00 [27315] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:48:38.263_917+00:00 [27315] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:48:38.263_920+00:00 [27315] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:48:38.263_958+00:00 [27315] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:48:38.264_123+00:00 [27352] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:48:40.054_182+00:00 [27323] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:48:40.054_192+00:00 [27323] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:48:40.054_205+00:00 [27323] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:48:40.054_220+00:00 [27323] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:48:40.054_226+00:00 [27323] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:48:40.054_229+00:00 [27323] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:48:40.054_245+00:00 [27323] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:48:40.054_292+00:00 [27351] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:48:40.054_298+00:00 [27351] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:48:40.054_307+00:00 [27351] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:48:50.573_173+00:00 [27323] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:48:50.573_197+00:00 [27323] [INFO] session 1 got connection from 127.0.0.1:51212 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:48:50.573_311+00:00 [27323] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:48:50.573_337+00:00 [27323] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:48:50.573_400+00:00 [27323] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:48:50.573_434+00:00 [27323] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:48:50.573_438+00:00 [27323] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:48:50.573_440+00:00 [27323] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:48:50.573_448+00:00 [27323] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:48:50.574_189+00:00 [27323] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51212 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:48:51.074_556+00:00 [27323] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:48:51.074_572+00:00 [27323] [INFO] session 2 got connection from 127.0.0.1:51214 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:48:51.074_708+00:00 [27323] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:48:51.074_712+00:00 [27323] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:48:51.074_878+00:00 [27323] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:48:51.074_882+00:00 [27323] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:48:51.074_950+00:00 [27351] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:48:51.074_953+00:00 [27351] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:48:51.074_962+00:00 [27351] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:48:51.074_963+00:00 [27351] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:48:51.074_970+00:00 [27351] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:48:51.074_984+00:00 [27351] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:48:51.074_989+00:00 [27351] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:48:51.075_009+00:00 [27351] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:49:10.069_923+00:00 [27335] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51214 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:49:11.213_011+00:00 [27335] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:49:11.213_034+00:00 [27335] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:49:11.213_043+00:00 [27335] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:49:11.213_115+00:00 [27335] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:49:11.213_158+00:00 [27335] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:49:11.213_983+00:00 [27335] [INFO] 0x7f3990002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:49:11.214_152+00:00 [27335] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:49:11.214_211+00:00 [27335] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:49:11.302_986+00:00 [27335] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:49:11.303_001+00:00 [27335] [INFO] session 3 got connection from 127.0.0.1:51216 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:49:11.303_078+00:00 [27335] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:49:11.303_086+00:00 [27335] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:49:11.303_286+00:00 [27335] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:49:11.303_308+00:00 [27335] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:49:11.303_318+00:00 [27335] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:49:11.303_330+00:00 [27335] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:49:11.303_530+00:00 [27335] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:49:11.303_750+00:00 [27351] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:49:11.303_771+00:00 [27351] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:49:11.303_786+00:00 [27351] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:49:15.069_569+00:00 [27338] [INFO] 0x7f3954001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:49:15.069_919+00:00 [27338] [INFO] 0x7f394c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:49:15.070_485+00:00 [27343] [INFO] 0x7f39440014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:49:15.071_203+00:00 [27343] [INFO] 0x7f393c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:49:31.104_536+00:00 [27351] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:49:31.104_550+00:00 [27351] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:49:31.104_575+00:00 [27351] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:49:31.104_580+00:00 [27351] [INFO] create snapshot idx 100000 log_term 2 done: 24 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:50:00.142_066+00:00 [27526] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:50:00.143_449+00:00 [27526] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:50:00.143_485+00:00 [27526] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:50:00.143_490+00:00 [27526] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:50:00.143_516+00:00 [27526] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:50:00.143_521+00:00 [27526] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:50:00.143_524+00:00 [27526] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:50:00.143_555+00:00 [27526] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:50:00.143_703+00:00 [27563] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:50:01.911_774+00:00 [27534] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:50:01.911_788+00:00 [27534] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:50:01.911_803+00:00 [27534] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:50:01.911_815+00:00 [27534] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:50:01.911_822+00:00 [27534] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:50:01.911_826+00:00 [27534] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:50:01.911_845+00:00 [27534] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:50:01.911_902+00:00 [27562] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:50:01.911_911+00:00 [27562] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:50:01.911_921+00:00 [27562] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:50:12.453_140+00:00 [27534] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:50:12.453_193+00:00 [27534] [INFO] session 1 got connection from 127.0.0.1:51218 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:50:12.453_415+00:00 [27534] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:50:12.453_442+00:00 [27534] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:50:12.453_505+00:00 [27534] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:50:12.453_541+00:00 [27534] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:50:12.453_544+00:00 [27534] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:50:12.453_546+00:00 [27534] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:50:12.453_554+00:00 [27534] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:50:12.454_259+00:00 [27534] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51218 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:50:12.954_608+00:00 [27534] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:50:12.954_625+00:00 [27534] [INFO] session 2 got connection from 127.0.0.1:51220 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:50:12.954_759+00:00 [27534] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:50:12.954_763+00:00 [27534] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:50:12.954_932+00:00 [27534] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:50:12.954_937+00:00 [27534] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:50:12.955_012+00:00 [27562] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:50:12.955_015+00:00 [27562] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:50:12.955_025+00:00 [27562] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:50:12.955_027+00:00 [27562] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:50:12.955_035+00:00 [27562] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:50:12.955_050+00:00 [27562] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:50:12.955_055+00:00 [27562] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:50:12.955_076+00:00 [27562] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:50:31.949_873+00:00 [27555] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51220 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:50:32.635_155+00:00 [27555] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:50:32.635_179+00:00 [27555] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:50:32.635_188+00:00 [27555] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:50:32.635_265+00:00 [27555] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:50:32.635_315+00:00 [27555] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:50:32.635_783+00:00 [27555] [INFO] 0x7fa3d4002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:50:32.635_984+00:00 [27555] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:50:32.636_052+00:00 [27555] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:50:33.343_311+00:00 [27555] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:50:33.343_326+00:00 [27555] [INFO] session 3 got connection from 127.0.0.1:51222 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:50:33.343_403+00:00 [27555] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:50:33.343_411+00:00 [27555] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:50:33.343_614+00:00 [27555] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:50:33.343_637+00:00 [27555] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:50:33.343_645+00:00 [27555] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:50:33.343_656+00:00 [27555] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:50:33.343_895+00:00 [27557] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:50:33.344_107+00:00 [27562] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:50:33.344_128+00:00 [27562] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:50:33.344_142+00:00 [27562] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:50:36.949_892+00:00 [27557] [INFO] 0x7fa38c001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:50:36.950_188+00:00 [27557] [INFO] 0x7fa3840014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:50:36.950_580+00:00 [27557] [INFO] 0x7fa37c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:50:36.950_969+00:00 [27557] [INFO] 0x7fa3800014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:50:36.951_332+00:00 [27557] [INFO] 0x7fa3780014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:50:36.951_645+00:00 [27557] [INFO] 0x7fa36c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:50:51.435_616+00:00 [27562] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:50:51.435_625+00:00 [27562] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:50:51.435_645+00:00 [27562] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:50:51.435_650+00:00 [27562] [INFO] create snapshot idx 100000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:51:22.014_236+00:00 [27747] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:51:22.015_645+00:00 [27747] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:51:22.015_676+00:00 [27747] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:51:22.015_682+00:00 [27747] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:51:22.015_706+00:00 [27747] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:51:22.015_710+00:00 [27747] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:51:22.015_713+00:00 [27747] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:51:22.015_740+00:00 [27747] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:51:22.015_892+00:00 [27784] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:51:23.783_923+00:00 [27755] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:51:23.783_935+00:00 [27755] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:51:23.783_950+00:00 [27755] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:51:23.783_967+00:00 [27755] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:51:23.783_974+00:00 [27755] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:51:23.783_977+00:00 [27755] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:51:23.783_995+00:00 [27755] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:51:23.784_048+00:00 [27783] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:51:23.784_056+00:00 [27783] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:51:23.784_066+00:00 [27783] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:51:34.324_947+00:00 [27755] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:51:34.324_969+00:00 [27755] [INFO] session 1 got connection from 127.0.0.1:51224 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:51:34.325_075+00:00 [27755] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:51:34.325_101+00:00 [27755] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:51:34.325_162+00:00 [27755] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:51:34.325_195+00:00 [27755] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:51:34.325_198+00:00 [27755] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:51:34.325_200+00:00 [27755] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:51:34.325_209+00:00 [27755] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:51:34.325_910+00:00 [27755] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51224 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:51:34.826_618+00:00 [27755] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:51:34.826_823+00:00 [27755] [INFO] session 2 got connection from 127.0.0.1:51226 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:51:34.827_100+00:00 [27755] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:51:34.827_112+00:00 [27755] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:51:34.827_356+00:00 [27755] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:51:34.827_361+00:00 [27755] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:51:34.827_432+00:00 [27783] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:51:34.827_435+00:00 [27783] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:51:34.827_444+00:00 [27783] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:51:34.827_446+00:00 [27783] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:51:34.827_453+00:00 [27783] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:51:34.827_467+00:00 [27783] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:51:34.827_472+00:00 [27783] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:51:34.827_491+00:00 [27783] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:51:53.821_638+00:00 [27772] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51226 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:51:54.458_132+00:00 [27772] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:51:54.458_157+00:00 [27772] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:51:54.458_167+00:00 [27772] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:51:54.458_243+00:00 [27772] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:51:54.458_290+00:00 [27772] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:51:54.458_797+00:00 [27772] [INFO] 0x7f397c002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:54.459_009+00:00 [27772] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:51:54.459_074+00:00 [27772] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:51:54.599_287+00:00 [27772] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:51:54.599_302+00:00 [27772] [INFO] session 3 got connection from 127.0.0.1:51228 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:51:54.599_383+00:00 [27772] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:51:54.599_391+00:00 [27772] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:51:54.599_599+00:00 [27772] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:51:54.599_622+00:00 [27772] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:51:54.599_631+00:00 [27772] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:51:54.599_643+00:00 [27772] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:51:54.599_869+00:00 [27778] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:51:54.600_041+00:00 [27783] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:51:54.600_059+00:00 [27783] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:51:54.600_070+00:00 [27783] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:51:58.821_640+00:00 [27751] [INFO] 0x7f3938001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:58.821_943+00:00 [27751] [INFO] 0x7f39300014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:58.822_431+00:00 [27751] [INFO] 0x7f39280014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:58.823_566+00:00 [27771] [INFO] 0x7f39180014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:58.823_994+00:00 [27753] [INFO] 0x7f39080014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:58.825_007+00:00 [27779] [INFO] 0x7f390c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:58.825_906+00:00 [27757] [INFO] 0x7f3914001840 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:51:58.826_199+00:00 [27757] [INFO] 0x7f3924001730 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:52:05.952_172+00:00 [27767] [INFO] 0x7f392826d000 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:52:13.047_777+00:00 [27783] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:52:13.047_789+00:00 [27783] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:52:13.047_813+00:00 [27783] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:52:13.047_819+00:00 [27783] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:52:43.896_804+00:00 [27961] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:52:43.898_286+00:00 [27961] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:52:43.898_316+00:00 [27961] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:52:43.898_324+00:00 [27961] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:52:43.898_346+00:00 [27961] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:52:43.898_350+00:00 [27961] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:52:43.898_353+00:00 [27961] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:52:43.898_380+00:00 [27961] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:52:43.898_533+00:00 [27998] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:52:45.054_603+00:00 [27969] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:52:45.054_615+00:00 [27969] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:52:45.054_630+00:00 [27969] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:52:45.054_641+00:00 [27969] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:52:45.054_647+00:00 [27969] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:52:45.054_650+00:00 [27969] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:52:45.054_688+00:00 [27969] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:52:45.054_747+00:00 [27997] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:52:45.054_755+00:00 [27997] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:52:45.054_765+00:00 [27997] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:52:55.457_537+00:00 [27969] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:52:55.457_559+00:00 [27969] [INFO] session 1 got connection from 127.0.0.1:51230 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:52:55.457_663+00:00 [27969] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:52:55.457_689+00:00 [27969] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:52:55.457_758+00:00 [27969] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:52:55.457_794+00:00 [27969] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:52:55.457_797+00:00 [27969] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:52:55.457_799+00:00 [27969] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:52:55.457_808+00:00 [27969] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:52:55.458_548+00:00 [27969] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51230 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:52:55.959_494+00:00 [27969] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:52:55.959_513+00:00 [27969] [INFO] session 2 got connection from 127.0.0.1:51232 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:52:55.959_643+00:00 [27969] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:52:55.959_650+00:00 [27969] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:52:55.959_847+00:00 [27969] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:52:55.959_853+00:00 [27969] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:52:55.960_001+00:00 [27997] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:52:55.960_005+00:00 [27997] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:52:55.960_015+00:00 [27997] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:52:55.960_018+00:00 [27997] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:52:55.960_025+00:00 [27997] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:52:55.960_040+00:00 [27997] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:52:55.960_045+00:00 [27997] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:52:55.960_066+00:00 [27997] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:53:15.204_211+00:00 [27966] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51232 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:53:15.943_524+00:00 [27966] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:53:15.943_538+00:00 [27966] [INFO] session 3 got connection from 127.0.0.1:51234 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:53:15.943_639+00:00 [27966] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:53:15.943_647+00:00 [27966] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:53:16.555_499+00:00 [27966] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:53:16.555_522+00:00 [27966] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:53:16.555_530+00:00 [27966] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:53:16.555_612+00:00 [27966] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:53:16.555_654+00:00 [27966] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:53:16.556_461+00:00 [27966] [INFO] 0x7fee78013c50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:53:16.556_650+00:00 [27966] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:16.556_728+00:00 [27966] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:53:16.556_730+00:00 [27966] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:53:16.556_732+00:00 [27966] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:53:16.556_742+00:00 [27966] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:53:16.556_908+00:00 [27966] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:53:16.556_912+00:00 [27966] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:53:16.556_919+00:00 [27966] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:53:16.556_923+00:00 [27966] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:53:16.556_962+00:00 [27966] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:53:16.557_072+00:00 [27966] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:53:16.557_247+00:00 [27997] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:53:16.557_264+00:00 [27997] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:53:16.557_275+00:00 [27997] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:53:16.557_416+00:00 [27966] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:17.057_500+00:00 [27972] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:17.607_483+00:00 [27966] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:18.207_648+00:00 [27966] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:18.857_746+00:00 [27966] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:19.558_111+00:00 [27969] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:20.204_620+00:00 [27969] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:20.332_572+00:00 [27981] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:20.589_095+00:00 [27978] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:21.089_138+00:00 [27983] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:21.589_186+00:00 [27981] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:22.089_470+00:00 [27986] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:22.589_643+00:00 [27971] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:23.089_807+00:00 [27991] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:23.589_926+00:00 [27985] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:24.089_767+00:00 [27985] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:24.589_878+00:00 [27970] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:25.090_003+00:00 [27969] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:53:25.334_619+00:00 [27997] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:53:25.334_627+00:00 [27997] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:53:25.334_648+00:00 [27997] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:53:25.334_653+00:00 [27997] [INFO] create snapshot idx 100000 log_term 2 done: 21 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:53:25.590_210+00:00 [27995] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:53:30.468_131+00:00 [27997] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:53:30.468_138+00:00 [27997] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:53:30.468_159+00:00 [27997] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:53:30.468_163+00:00 [27997] [INFO] create snapshot idx 200000 log_term 2 done: 19 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:53:35.616_773+00:00 [27997] [INFO] creating a snapshot for index 300000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:53:35.616_781+00:00 [27997] [INFO] create snapshot idx 300000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:53:35.616_801+00:00 [27997] [INFO] snapshot idx 300000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:53:35.616_805+00:00 [27997] [INFO] create snapshot idx 300000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:54:05.309_426+00:00 [28180] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:54:05.310_887+00:00 [28180] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:54:05.310_916+00:00 [28180] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:54:05.310_925+00:00 [28180] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:54:05.310_947+00:00 [28180] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:54:05.310_951+00:00 [28180] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:54:05.310_954+00:00 [28180] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:54:05.310_982+00:00 [28180] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:54:05.311_130+00:00 [28217] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:54:06.685_187+00:00 [28188] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:54:06.685_199+00:00 [28188] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:54:06.685_214+00:00 [28188] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:54:06.685_224+00:00 [28188] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:54:06.685_230+00:00 [28188] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:54:06.685_234+00:00 [28188] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:54:06.685_252+00:00 [28188] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:54:06.685_303+00:00 [28216] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:54:06.685_311+00:00 [28216] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:54:06.685_321+00:00 [28216] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:54:17.120_301+00:00 [28188] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:54:17.120_325+00:00 [28188] [INFO] session 1 got connection from 127.0.0.1:51236 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:54:17.120_434+00:00 [28188] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:54:17.120_461+00:00 [28188] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:54:17.120_523+00:00 [28188] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:54:17.120_557+00:00 [28188] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:54:17.120_560+00:00 [28188] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:54:17.120_562+00:00 [28188] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:54:17.120_570+00:00 [28188] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:54:17.121_349+00:00 [28188] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51236 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:54:17.621_719+00:00 [28188] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:54:17.621_736+00:00 [28188] [INFO] session 2 got connection from 127.0.0.1:51238 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:54:17.621_849+00:00 [28188] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:54:17.621_853+00:00 [28188] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:54:17.622_017+00:00 [28188] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:54:17.622_021+00:00 [28188] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:54:17.622_089+00:00 [28216] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:54:17.622_092+00:00 [28216] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:54:17.622_101+00:00 [28216] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:54:17.622_103+00:00 [28216] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:54:17.622_110+00:00 [28216] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:54:17.622_124+00:00 [28216] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:54:17.622_129+00:00 [28216] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:54:17.622_148+00:00 [28216] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:54:36.867_111+00:00 [28185] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51238 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:54:37.386_713+00:00 [28185] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:54:37.386_727+00:00 [28185] [INFO] session 3 got connection from 127.0.0.1:51240 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:54:37.386_825+00:00 [28185] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:54:37.386_833+00:00 [28185] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:54:37.894_529+00:00 [28185] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:54:37.894_552+00:00 [28185] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:54:37.894_561+00:00 [28185] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:54:37.894_647+00:00 [28185] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:54:37.894_710+00:00 [28185] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:54:37.895_149+00:00 [28185] [INFO] 0x7f0c9c013c50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:54:37.895_344+00:00 [28185] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:37.895_405+00:00 [28185] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:54:37.895_408+00:00 [28185] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:54:37.895_410+00:00 [28185] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:54:37.895_420+00:00 [28185] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:54:37.895_594+00:00 [28214] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:54:37.895_601+00:00 [28214] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:54:37.895_610+00:00 [28214] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:54:37.895_613+00:00 [28214] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:54:37.895_650+00:00 [28214] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:54:37.895_780+00:00 [28214] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:54:37.895_983+00:00 [28216] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:54:37.896_003+00:00 [28216] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:54:37.896_017+00:00 [28216] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:54:37.896_181+00:00 [28214] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:38.396_149+00:00 [28214] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:38.946_277+00:00 [28214] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:39.546_428+00:00 [28214] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:40.196_563+00:00 [28214] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:40.896_914+00:00 [28188] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:41.646_942+00:00 [28188] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:41.868_341+00:00 [28188] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:42.124_372+00:00 [28206] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:42.624_396+00:00 [28189] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:43.124_638+00:00 [28203] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:43.624_591+00:00 [28192] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:44.124_630+00:00 [28214] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:44.624_651+00:00 [28203] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:45.124_973+00:00 [28208] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:45.624_959+00:00 [28212] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:46.125_006+00:00 [28213] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:46.625_083+00:00 [28185] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:54:47.125_420+00:00 [28191] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:54:51.674_161+00:00 [28216] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:54:51.674_168+00:00 [28216] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:54:51.674_292+00:00 [28216] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:54:51.674_298+00:00 [28216] [INFO] create snapshot idx 100000 log_term 2 done: 125 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:55:26.948_198+00:00 [28392] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:55:26.949_552+00:00 [28392] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:55:26.949_586+00:00 [28392] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:55:26.949_590+00:00 [28392] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:55:26.949_611+00:00 [28392] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:55:26.949_615+00:00 [28392] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:55:26.949_618+00:00 [28392] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:55:26.949_651+00:00 [28392] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:55:26.949_796+00:00 [28429] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:55:28.334_875+00:00 [28400] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:55:28.334_887+00:00 [28400] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:55:28.334_901+00:00 [28400] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:55:28.334_918+00:00 [28400] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:55:28.334_924+00:00 [28400] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:55:28.334_928+00:00 [28400] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:55:28.334_946+00:00 [28400] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:55:28.334_999+00:00 [28428] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:55:28.335_008+00:00 [28428] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:55:28.335_020+00:00 [28428] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:55:39.254_598+00:00 [28400] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:55:39.254_622+00:00 [28400] [INFO] session 1 got connection from 127.0.0.1:51242 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:55:39.254_743+00:00 [28400] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:55:39.254_768+00:00 [28400] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:55:39.254_831+00:00 [28400] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:55:39.254_867+00:00 [28400] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:55:39.254_870+00:00 [28400] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:55:39.254_872+00:00 [28400] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:55:39.254_880+00:00 [28400] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:55:39.255_608+00:00 [28400] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51242 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:55:39.755_947+00:00 [28400] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:55:39.755_966+00:00 [28400] [INFO] session 2 got connection from 127.0.0.1:51244 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:55:39.756_086+00:00 [28400] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:55:39.756_090+00:00 [28400] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:55:39.756_261+00:00 [28400] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:55:39.756_265+00:00 [28400] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:55:39.756_334+00:00 [28428] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:55:39.756_337+00:00 [28428] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:55:39.756_346+00:00 [28428] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:55:39.756_348+00:00 [28428] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:55:39.756_355+00:00 [28428] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:55:39.756_369+00:00 [28428] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:55:39.756_374+00:00 [28428] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:55:39.756_394+00:00 [28428] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:55:58.505_746+00:00 [28418] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51244 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:55:59.205_595+00:00 [28418] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:55:59.205_609+00:00 [28418] [INFO] session 3 got connection from 127.0.0.1:51248 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:55:59.205_708+00:00 [28418] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:55:59.205_716+00:00 [28418] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T12:55:59.487_546+00:00 [28418] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:55:59.487_569+00:00 [28418] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:55:59.487_577+00:00 [28418] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:55:59.487_666+00:00 [28418] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:55:59.487_706+00:00 [28418] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:55:59.488_149+00:00 [28418] [INFO] 0x7f83c0013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:55:59.488_354+00:00 [28418] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:55:59.488_421+00:00 [28418] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:55:59.488_424+00:00 [28418] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T12:55:59.488_426+00:00 [28418] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T12:55:59.488_436+00:00 [28418] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:55:59.488_586+00:00 [28418] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T12:55:59.488_590+00:00 [28418] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T12:55:59.488_606+00:00 [28418] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:55:59.488_610+00:00 [28418] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T12:55:59.488_647+00:00 [28418] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T12:55:59.488_756+00:00 [28418] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T12:55:59.488_909+00:00 [28428] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:55:59.488_931+00:00 [28428] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:55:59.488_948+00:00 [28428] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:55:59.489_101+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:55:59.989_131+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:00.539_250+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:01.139_420+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:01.789_620+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:02.489_953+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:03.239_926+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:03.506_184+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:03.762_300+00:00 [28421] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:04.262_369+00:00 [28402] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:04.762_552+00:00 [28418] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:05.262_506+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:05.762_758+00:00 [28425] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:06.262_903+00:00 [28408] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:06.762_802+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:07.263_181+00:00 [28419] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:07.763_110+00:00 [28399] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:08.263_103+00:00 [28415] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:56:08.763_305+00:00 [28413] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T12:56:13.389_290+00:00 [28428] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:56:13.389_299+00:00 [28428] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:56:13.389_570+00:00 [28428] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:56:13.389_575+00:00 [28428] [INFO] create snapshot idx 100000 log_term 2 done: 270 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:56:48.587_216+00:00 [28597] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:56:48.588_592+00:00 [28597] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:56:48.588_627+00:00 [28597] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:56:48.588_632+00:00 [28597] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:56:48.588_656+00:00 [28597] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:56:48.588_661+00:00 [28597] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:56:48.588_663+00:00 [28597] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:56:48.588_692+00:00 [28597] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:56:48.588_850+00:00 [28634] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:56:49.849_927+00:00 [28605] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:56:49.849_939+00:00 [28605] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:56:49.849_955+00:00 [28605] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:56:49.849_967+00:00 [28605] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:56:49.849_973+00:00 [28605] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:56:49.849_977+00:00 [28605] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:56:49.849_997+00:00 [28605] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:56:49.850_052+00:00 [28633] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:56:49.850_060+00:00 [28633] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:56:49.850_072+00:00 [28633] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:57:00.398_227+00:00 [28605] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:57:00.398_251+00:00 [28605] [INFO] session 1 got connection from 127.0.0.1:51250 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:57:00.398_358+00:00 [28605] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:57:00.398_383+00:00 [28605] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:57:00.398_445+00:00 [28605] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:57:00.398_480+00:00 [28605] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:57:00.398_483+00:00 [28605] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:57:00.398_485+00:00 [28605] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:57:00.398_493+00:00 [28605] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:57:00.399_257+00:00 [28605] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51250 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:57:00.899_571+00:00 [28605] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:57:00.899_589+00:00 [28605] [INFO] session 2 got connection from 127.0.0.1:51252 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:57:00.899_698+00:00 [28605] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:57:00.899_702+00:00 [28605] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:57:00.899_864+00:00 [28605] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:57:00.899_869+00:00 [28605] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:57:00.899_944+00:00 [28633] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:57:00.899_947+00:00 [28633] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:57:00.899_957+00:00 [28633] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:57:00.899_959+00:00 [28633] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:57:00.899_967+00:00 [28633] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:57:00.899_982+00:00 [28633] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:57:00.899_987+00:00 [28633] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:57:00.900_008+00:00 [28633] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:57:19.894_594+00:00 [28626] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51252 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:57:20.432_857+00:00 [28602] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:57:20.432_877+00:00 [28602] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:57:20.432_883+00:00 [28602] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:57:20.432_946+00:00 [28602] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:57:20.432_983+00:00 [28602] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:57:20.433_369+00:00 [28602] [INFO] 0x7f02e4000cf0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:20.433_553+00:00 [28602] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:57:20.433_620+00:00 [28602] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:57:20.972_730+00:00 [28602] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:57:20.972_742+00:00 [28602] [INFO] session 3 got connection from 127.0.0.1:51254 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:57:20.972_823+00:00 [28602] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:57:20.972_829+00:00 [28602] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:57:20.972_993+00:00 [28602] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:57:20.973_011+00:00 [28602] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:57:20.973_019+00:00 [28602] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:57:20.973_029+00:00 [28602] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:57:20.973_228+00:00 [28629] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:57:20.973_412+00:00 [28633] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:57:20.973_431+00:00 [28633] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:57:20.973_445+00:00 [28633] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:57:24.894_854+00:00 [28629] [INFO] 0x7f029c001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.895_140+00:00 [28629] [INFO] 0x7f02940014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.895_530+00:00 [28629] [INFO] 0x7f02980014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.896_071+00:00 [28620] [INFO] 0x7f028c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.896_648+00:00 [28620] [INFO] 0x7f02740014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.896_978+00:00 [28620] [INFO] 0x7f02780014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.897_368+00:00 [28620] [INFO] 0x556121ce6070 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.899_497+00:00 [28602] [INFO] 0x7f0274015bc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.901_046+00:00 [28625] [INFO] 0x7f029c014e20 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:24.901_645+00:00 [28629] [INFO] 0x7f02800054a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:57:41.181_784+00:00 [28633] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:57:41.181_886+00:00 [28633] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:57:41.181_928+00:00 [28633] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:57:41.183_311+00:00 [28633] [INFO] create snapshot idx 100000 log_term 2 done: 1417 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:58:09.966_651+00:00 [28820] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:58:09.968_205+00:00 [28820] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:58:09.968_237+00:00 [28820] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:58:09.968_241+00:00 [28820] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:58:09.968_265+00:00 [28820] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:58:09.968_269+00:00 [28820] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:58:09.968_272+00:00 [28820] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:58:09.968_302+00:00 [28820] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:58:09.968_460+00:00 [28857] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:58:11.839_528+00:00 [28828] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:58:11.839_540+00:00 [28828] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:58:11.839_554+00:00 [28828] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:58:11.839_571+00:00 [28828] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:58:11.839_577+00:00 [28828] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:58:11.839_581+00:00 [28828] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:58:11.839_600+00:00 [28828] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:58:11.839_654+00:00 [28856] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:58:11.839_662+00:00 [28856] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:58:11.839_673+00:00 [28856] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:58:21.527_230+00:00 [28828] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:58:21.527_253+00:00 [28828] [INFO] session 1 got connection from 127.0.0.1:51256 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:58:21.527_358+00:00 [28828] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:58:21.527_384+00:00 [28828] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:58:21.527_447+00:00 [28828] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:58:21.527_484+00:00 [28828] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:58:21.527_487+00:00 [28828] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:58:21.527_489+00:00 [28828] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:58:21.527_497+00:00 [28828] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:58:21.528_226+00:00 [28828] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51256 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:58:22.028_532+00:00 [28828] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:58:22.028_547+00:00 [28828] [INFO] session 2 got connection from 127.0.0.1:51258 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:58:22.028_655+00:00 [28828] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:58:22.028_660+00:00 [28828] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:58:22.028_843+00:00 [28828] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:58:22.028_847+00:00 [28828] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:58:22.028_917+00:00 [28856] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:58:22.028_920+00:00 [28856] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:58:22.028_929+00:00 [28856] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:58:22.028_931+00:00 [28856] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:58:22.028_938+00:00 [28856] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:58:22.028_953+00:00 [28856] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:58:22.028_957+00:00 [28856] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:58:22.028_976+00:00 [28856] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:58:42.024_699+00:00 [28833] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51258 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:58:42.992_282+00:00 [28833] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:58:42.992_305+00:00 [28833] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:58:42.992_314+00:00 [28833] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:58:42.992_393+00:00 [28833] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T12:58:42.992_440+00:00 [28833] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T12:58:42.993_243+00:00 [28833] [INFO] 0x7f1908002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:42.993_434+00:00 [28833] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T12:58:42.993_513+00:00 [28833] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T12:58:43.050_120+00:00 [28824] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:58:43.050_133+00:00 [28824] [INFO] session 3 got connection from 127.0.0.1:51260 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:58:43.050_232+00:00 [28824] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T12:58:43.050_239+00:00 [28824] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T12:58:43.050_417+00:00 [28824] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T12:58:43.050_438+00:00 [28824] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:58:43.050_448+00:00 [28824] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T12:58:43.050_460+00:00 [28824] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T12:58:43.050_682+00:00 [28824] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:58:43.050_890+00:00 [28856] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:58:43.050_913+00:00 [28856] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:58:43.050_928+00:00 [28856] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:58:47.024_895+00:00 [28844] [INFO] 0x7f18c4001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.025_196+00:00 [28844] [INFO] 0x7f18c00014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.025_747+00:00 [28845] [INFO] 0x7f18b80014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.026_110+00:00 [28845] [INFO] 0x7f18b00014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.026_816+00:00 [28845] [INFO] 0x7f18a40014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.027_286+00:00 [28845] [INFO] 0x7f18940014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.032_477+00:00 [28832] [INFO] 0x7f18c0014c20 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.039_562+00:00 [28854] [INFO] 0x7f1894015940 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.039_850+00:00 [28854] [INFO] 0x7f189c0031e0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:58:47.040_032+00:00 [28854] [INFO] 0x7f1890001e40 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T12:59:02.967_083+00:00 [28856] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T12:59:02.967_092+00:00 [28856] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T12:59:02.967_115+00:00 [28856] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T12:59:02.967_120+00:00 [28856] [INFO] create snapshot idx 100000 log_term 2 done: 22 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T12:59:32.095_338+00:00 [29046] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T12:59:32.097_067+00:00 [29046] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T12:59:32.097_102+00:00 [29046] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T12:59:32.097_114+00:00 [29046] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T12:59:32.097_142+00:00 [29046] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T12:59:32.097_147+00:00 [29046] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T12:59:32.097_150+00:00 [29046] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T12:59:32.097_185+00:00 [29046] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T12:59:32.097_356+00:00 [29083] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T12:59:33.610_394+00:00 [29054] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T12:59:33.610_406+00:00 [29054] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T12:59:33.610_420+00:00 [29054] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T12:59:33.610_431+00:00 [29054] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T12:59:33.610_438+00:00 [29054] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T12:59:33.610_443+00:00 [29054] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T12:59:33.610_462+00:00 [29054] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T12:59:33.610_515+00:00 [29082] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:59:33.610_523+00:00 [29082] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:59:33.610_533+00:00 [29082] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:59:43.910_290+00:00 [29054] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:59:43.910_312+00:00 [29054] [INFO] session 1 got connection from 127.0.0.1:51262 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:59:43.910_428+00:00 [29054] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T12:59:43.910_454+00:00 [29054] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:59:43.910_516+00:00 [29054] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:59:43.910_551+00:00 [29054] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T12:59:43.910_554+00:00 [29054] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T12:59:43.910_556+00:00 [29054] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T12:59:43.910_564+00:00 [29054] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T12:59:43.911_317+00:00 [29054] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51262 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T12:59:44.411_846+00:00 [29054] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T12:59:44.411_862+00:00 [29054] [INFO] session 2 got connection from 127.0.0.1:51264 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T12:59:44.411_970+00:00 [29054] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T12:59:44.411_974+00:00 [29054] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T12:59:44.412_144+00:00 [29054] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:59:44.412_149+00:00 [29054] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T12:59:44.412_223+00:00 [29082] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:59:44.412_226+00:00 [29082] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:59:44.412_236+00:00 [29082] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:59:44.412_238+00:00 [29082] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T12:59:44.412_247+00:00 [29082] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T12:59:44.412_262+00:00 [29082] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T12:59:44.412_267+00:00 [29082] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T12:59:44.412_288+00:00 [29082] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:00:03.653_516+00:00 [29073] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51264 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:00:04.655_491+00:00 [29073] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:00:04.655_515+00:00 [29073] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:00:04.655_523+00:00 [29073] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:00:04.655_598+00:00 [29073] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:00:04.655_644+00:00 [29073] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:00:04.656_092+00:00 [29073] [INFO] 0x7f6d44002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:04.656_292+00:00 [29073] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:00:04.656_360+00:00 [29073] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:00:04.768_473+00:00 [29073] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:00:04.768_487+00:00 [29073] [INFO] session 3 got connection from 127.0.0.1:51266 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:00:04.768_562+00:00 [29073] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:00:04.768_570+00:00 [29073] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:00:04.768_776+00:00 [29073] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:00:04.768_796+00:00 [29073] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:00:04.768_803+00:00 [29073] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:00:04.768_813+00:00 [29073] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:00:04.768_990+00:00 [29073] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:00:04.769_154+00:00 [29082] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:00:04.769_175+00:00 [29082] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:00:04.769_191+00:00 [29082] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:00:08.653_736+00:00 [29063] [INFO] 0x7f6d00001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.654_036+00:00 [29063] [INFO] 0x7f6cf80014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.654_436+00:00 [29063] [INFO] 0x7f6cf00014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.655_259+00:00 [29051] [INFO] 0x7f6ce80014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.655_787+00:00 [29051] [INFO] 0x7f6cc8001840 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.656_093+00:00 [29051] [INFO] 0x7f6cd80018e0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.656_472+00:00 [29051] [INFO] 0x7f6ce4001a50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.658_025+00:00 [29071] [INFO] 0x7f6cc8014fc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.659_333+00:00 [29075] [INFO] 0x7f6cf0015940 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:08.660_137+00:00 [29075] [INFO] 0x7f6cd8016e50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:00:24.358_012+00:00 [29082] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:00:24.358_020+00:00 [29082] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:00:24.358_042+00:00 [29082] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:00:24.358_083+00:00 [29082] [INFO] create snapshot idx 100000 log_term 2 done: 57 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:04:25.066_383+00:00 [29494] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:04:25.067_792+00:00 [29494] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:04:25.067_823+00:00 [29494] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:04:25.067_832+00:00 [29494] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:04:25.067_857+00:00 [29494] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:04:25.067_861+00:00 [29494] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:04:25.067_864+00:00 [29494] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:04:25.067_897+00:00 [29494] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:04:25.068_047+00:00 [29531] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:04:26.646_099+00:00 [29502] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:04:26.646_110+00:00 [29502] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:04:26.646_125+00:00 [29502] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:04:26.646_136+00:00 [29502] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:04:26.646_142+00:00 [29502] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:04:26.646_146+00:00 [29502] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:04:26.646_164+00:00 [29502] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:04:26.646_218+00:00 [29530] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:04:26.646_226+00:00 [29530] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:04:26.646_236+00:00 [29530] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:04:37.381_440+00:00 [29502] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:04:37.381_462+00:00 [29502] [INFO] session 1 got connection from 127.0.0.1:51268 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:04:37.381_571+00:00 [29502] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:04:37.381_596+00:00 [29502] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:04:37.381_657+00:00 [29502] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:04:37.381_698+00:00 [29502] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:04:37.381_701+00:00 [29502] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:04:37.381_703+00:00 [29502] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:04:37.381_712+00:00 [29502] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:04:37.382_675+00:00 [29502] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51268 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:04:37.883_010+00:00 [29502] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:04:37.883_026+00:00 [29502] [INFO] session 2 got connection from 127.0.0.1:51270 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:04:37.883_127+00:00 [29502] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:04:37.883_131+00:00 [29502] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:04:37.883_305+00:00 [29502] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:04:37.883_310+00:00 [29502] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:04:37.883_377+00:00 [29530] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:04:37.883_381+00:00 [29530] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:04:37.883_389+00:00 [29530] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:04:37.883_391+00:00 [29530] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:04:37.883_399+00:00 [29530] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:04:37.883_413+00:00 [29530] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:04:37.883_417+00:00 [29530] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:04:37.883_437+00:00 [29530] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:04:56.874_014+00:00 [29525] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51270 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:04:57.883_254+00:00 [29525] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:04:57.883_277+00:00 [29525] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:04:57.883_285+00:00 [29525] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:04:57.883_355+00:00 [29525] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:04:57.883_400+00:00 [29525] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:04:57.883_842+00:00 [29525] [INFO] 0x7f269c002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:04:57.884_034+00:00 [29525] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:04:57.884_105+00:00 [29525] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:04:58.126_876+00:00 [29525] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:04:58.126_890+00:00 [29525] [INFO] session 3 got connection from 127.0.0.1:51272 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:04:58.126_968+00:00 [29525] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:04:58.126_976+00:00 [29525] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:04:58.127_177+00:00 [29525] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:04:58.127_199+00:00 [29525] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:04:58.127_208+00:00 [29525] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:04:58.127_219+00:00 [29525] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:04:58.127_435+00:00 [29520] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:04:58.127_600+00:00 [29530] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:04:58.127_617+00:00 [29530] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:04:58.127_629+00:00 [29530] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:05:01.873_609+00:00 [29520] [INFO] 0x7f2660001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:05:01.873_906+00:00 [29520] [INFO] 0x7f26540014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:05:46.927_734+00:00 [29677] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:05:46.929_154+00:00 [29677] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:05:46.929_186+00:00 [29677] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:05:46.929_192+00:00 [29677] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:05:46.929_215+00:00 [29677] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:05:46.929_219+00:00 [29677] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:05:46.929_222+00:00 [29677] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:05:46.929_253+00:00 [29677] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:05:46.929_409+00:00 [29714] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:05:48.219_510+00:00 [29685] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:05:48.219_521+00:00 [29685] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:05:48.219_536+00:00 [29685] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:05:48.219_549+00:00 [29685] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:05:48.219_556+00:00 [29685] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:05:48.219_560+00:00 [29685] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:05:48.219_579+00:00 [29685] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:05:48.219_632+00:00 [29713] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:05:48.219_640+00:00 [29713] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:05:48.219_650+00:00 [29713] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:05:58.987_950+00:00 [29685] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:05:58.987_970+00:00 [29685] [INFO] session 1 got connection from 127.0.0.1:51274 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:05:58.988_072+00:00 [29685] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:05:58.988_098+00:00 [29685] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:05:58.988_160+00:00 [29685] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:05:58.988_195+00:00 [29685] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:05:58.988_198+00:00 [29685] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:05:58.988_200+00:00 [29685] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:05:58.988_209+00:00 [29685] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:05:58.988_950+00:00 [29685] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51274 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:05:59.489_263+00:00 [29685] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:05:59.489_282+00:00 [29685] [INFO] session 2 got connection from 127.0.0.1:51276 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:05:59.489_408+00:00 [29685] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:05:59.489_414+00:00 [29685] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:05:59.489_578+00:00 [29685] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:05:59.489_582+00:00 [29685] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:05:59.489_650+00:00 [29713] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:05:59.489_654+00:00 [29713] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:05:59.489_663+00:00 [29713] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:05:59.489_665+00:00 [29713] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:05:59.489_672+00:00 [29713] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:05:59.489_685+00:00 [29713] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:05:59.489_690+00:00 [29713] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:05:59.489_709+00:00 [29713] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:06:18.235_474+00:00 [29710] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51276 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:06:19.389_135+00:00 [29710] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:06:19.389_147+00:00 [29710] [INFO] session 3 got connection from 127.0.0.1:51278 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:06:19.389_229+00:00 [29710] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:06:19.389_236+00:00 [29710] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:06:19.502_609+00:00 [29710] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:06:19.502_629+00:00 [29710] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:06:19.502_636+00:00 [29710] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:06:19.502_730+00:00 [29710] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:06:19.502_763+00:00 [29710] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:06:19.503_142+00:00 [29710] [INFO] 0x7fec30013df0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:06:19.503_316+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:19.503_372+00:00 [29710] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:06:19.503_375+00:00 [29710] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:06:19.503_376+00:00 [29710] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:06:19.503_385+00:00 [29710] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:06:19.503_509+00:00 [29710] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:06:19.503_513+00:00 [29710] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:06:19.503_519+00:00 [29710] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:06:19.503_522+00:00 [29710] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:06:19.503_553+00:00 [29710] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:06:19.503_610+00:00 [29710] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:06:19.503_808+00:00 [29713] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:06:19.503_824+00:00 [29713] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:06:19.503_835+00:00 [29713] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:06:20.004_033+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:20.504_153+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:21.054_266+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:21.654_387+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:22.304_620+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:23.004_923+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:23.235_705+00:00 [29710] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:23.363_689+00:00 [29702] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:23.619_975+00:00 [29698] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:24.120_073+00:00 [29683] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:24.619_923+00:00 [29688] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:25.120_256+00:00 [29685] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:25.620_409+00:00 [29708] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:26.121_264+00:00 [29703] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:26.620_412+00:00 [29690] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:27.120_701+00:00 [29703] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:27.620_844+00:00 [29685] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:28.120_772+00:00 [29708] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:06:28.620_835+00:00 [29681] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:06:31.708_269+00:00 [29713] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:06:31.708_277+00:00 [29713] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:06:31.708_302+00:00 [29713] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:06:31.708_307+00:00 [29713] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:06:40.201_584+00:00 [29713] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:06:40.201_591+00:00 [29713] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:06:40.201_616+00:00 [29713] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:06:40.201_622+00:00 [29713] [INFO] create snapshot idx 200000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:07:08.319_458+00:00 [29898] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:07:08.320_794+00:00 [29898] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:07:08.320_827+00:00 [29898] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:07:08.320_832+00:00 [29898] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:07:08.320_854+00:00 [29898] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:07:08.320_858+00:00 [29898] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:07:08.320_861+00:00 [29898] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:07:08.320_896+00:00 [29898] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:07:08.321_050+00:00 [29935] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:07:09.673_111+00:00 [29906] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:07:09.673_125+00:00 [29906] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:07:09.673_141+00:00 [29906] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:07:09.673_153+00:00 [29906] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:07:09.673_160+00:00 [29906] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:07:09.673_164+00:00 [29906] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:07:09.673_185+00:00 [29906] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:07:09.673_241+00:00 [29934] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:07:09.673_250+00:00 [29934] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:07:09.673_261+00:00 [29934] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:07:20.634_325+00:00 [29906] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:07:20.634_347+00:00 [29906] [INFO] session 1 got connection from 127.0.0.1:51282 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:07:20.634_454+00:00 [29906] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:07:20.634_480+00:00 [29906] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:07:20.634_543+00:00 [29906] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:07:20.634_578+00:00 [29906] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:07:20.634_581+00:00 [29906] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:07:20.634_583+00:00 [29906] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:07:20.634_592+00:00 [29906] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:07:20.635_573+00:00 [29906] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51282 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:07:21.135_899+00:00 [29906] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:07:21.135_915+00:00 [29906] [INFO] session 2 got connection from 127.0.0.1:51284 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:07:21.136_019+00:00 [29906] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:07:21.136_023+00:00 [29906] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:07:21.136_190+00:00 [29906] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:07:21.136_194+00:00 [29906] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:07:21.136_262+00:00 [29934] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:07:21.136_265+00:00 [29934] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:07:21.136_274+00:00 [29934] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:07:21.136_276+00:00 [29934] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:07:21.136_284+00:00 [29934] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:07:21.136_298+00:00 [29934] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:07:21.136_302+00:00 [29934] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:07:21.136_322+00:00 [29934] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:07:39.876_974+00:00 [29920] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51284 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:07:41.077_284+00:00 [29920] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:07:41.077_298+00:00 [29920] [INFO] session 3 got connection from 127.0.0.1:51286 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:07:41.077_398+00:00 [29920] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:07:41.077_407+00:00 [29920] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:07:41.429_922+00:00 [29920] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:07:41.429_948+00:00 [29920] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:07:41.429_957+00:00 [29920] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:07:41.430_043+00:00 [29920] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:07:41.430_087+00:00 [29920] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:07:41.430_550+00:00 [29920] [INFO] 0x7ff394013c00 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:07:41.430_784+00:00 [29920] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:41.430_846+00:00 [29920] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:07:41.430_849+00:00 [29920] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:07:41.430_851+00:00 [29920] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:07:41.430_861+00:00 [29920] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:07:41.431_058+00:00 [29920] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:07:41.431_062+00:00 [29920] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:07:41.431_078+00:00 [29920] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:07:41.431_088+00:00 [29920] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:07:41.431_123+00:00 [29920] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:07:41.431_231+00:00 [29920] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:07:41.431_387+00:00 [29934] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:07:41.431_408+00:00 [29934] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:07:41.431_425+00:00 [29934] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:07:41.431_583+00:00 [29921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:41.931_638+00:00 [29921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:42.481_742+00:00 [29921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:43.081_936+00:00 [29921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:43.732_082+00:00 [29921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:44.432_386+00:00 [29921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:44.877_231+00:00 [29921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:45.005_313+00:00 [29925] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:45.261_433+00:00 [29902] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:45.761_943+00:00 [29928] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:46.262_058+00:00 [29930] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:46.762_106+00:00 [29924] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:47.262_197+00:00 [29906] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:47.762_136+00:00 [29925] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:48.262_463+00:00 [29919] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:48.762_626+00:00 [29906] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:49.262_472+00:00 [29911] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:49.762_578+00:00 [29931] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:07:50.262_776+00:00 [29921] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:07:51.554_678+00:00 [29934] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:07:51.554_686+00:00 [29934] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:07:51.554_708+00:00 [29934] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:07:51.554_713+00:00 [29934] [INFO] create snapshot idx 100000 log_term 2 done: 21 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:07:58.272_676+00:00 [29934] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:07:58.272_683+00:00 [29934] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:07:58.272_704+00:00 [29934] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:07:58.272_709+00:00 [29934] [INFO] create snapshot idx 200000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:08:29.962_164+00:00 [30111] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:08:29.963_556+00:00 [30111] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:08:29.963_587+00:00 [30111] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:08:29.963_593+00:00 [30111] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:08:29.963_615+00:00 [30111] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:08:29.963_619+00:00 [30111] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:08:29.963_622+00:00 [30111] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:08:29.963_650+00:00 [30111] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:08:29.963_795+00:00 [30148] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:08:31.517_983+00:00 [30119] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:08:31.517_994+00:00 [30119] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:08:31.518_009+00:00 [30119] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:08:31.518_025+00:00 [30119] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:08:31.518_032+00:00 [30119] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:08:31.518_036+00:00 [30119] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:08:31.518_054+00:00 [30119] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:08:31.518_106+00:00 [30147] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:08:31.518_113+00:00 [30147] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:08:31.518_123+00:00 [30147] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:08:42.277_001+00:00 [30119] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:08:42.277_026+00:00 [30119] [INFO] session 1 got connection from 127.0.0.1:51288 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:08:42.277_133+00:00 [30119] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:08:42.277_160+00:00 [30119] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:08:42.277_221+00:00 [30119] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:08:42.277_254+00:00 [30119] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:08:42.277_257+00:00 [30119] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:08:42.277_259+00:00 [30119] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:08:42.277_268+00:00 [30119] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:08:42.278_489+00:00 [30119] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51288 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:08:42.778_944+00:00 [30119] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:08:42.778_960+00:00 [30119] [INFO] session 2 got connection from 127.0.0.1:51290 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:08:42.779_073+00:00 [30119] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:08:42.779_078+00:00 [30119] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:08:42.779_249+00:00 [30119] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:08:42.779_254+00:00 [30119] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:08:42.779_325+00:00 [30147] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:08:42.779_328+00:00 [30147] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:08:42.779_337+00:00 [30147] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:08:42.779_339+00:00 [30147] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:08:42.779_346+00:00 [30147] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:08:42.779_360+00:00 [30147] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:08:42.779_364+00:00 [30147] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:08:42.779_384+00:00 [30147] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:09:01.769_851+00:00 [30146] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51290 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:09:03.048_605+00:00 [30146] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:09:03.048_628+00:00 [30146] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:09:03.048_636+00:00 [30146] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:09:03.048_711+00:00 [30146] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:09:03.048_756+00:00 [30146] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:09:03.049_192+00:00 [30146] [INFO] 0x7fce60002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:03.049_392+00:00 [30146] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:09:03.049_457+00:00 [30146] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:09:03.329_822+00:00 [30146] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:09:03.329_834+00:00 [30146] [INFO] session 3 got connection from 127.0.0.1:51292 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:09:03.329_908+00:00 [30146] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:09:03.329_916+00:00 [30146] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:09:03.330_118+00:00 [30146] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:09:03.330_139+00:00 [30146] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:09:03.330_148+00:00 [30146] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:09:03.330_161+00:00 [30146] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:09:03.330_376+00:00 [30119] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:09:03.330_583+00:00 [30147] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:09:03.330_606+00:00 [30147] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:09:03.330_623+00:00 [30147] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:09:06.769_933+00:00 [30119] [INFO] 0x7fce24001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:06.770_232+00:00 [30119] [INFO] 0x7fce1c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:06.770_609+00:00 [30119] [INFO] 0x7fce140014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:06.770_989+00:00 [30119] [INFO] 0x7fce0c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:06.771_289+00:00 [30131] [INFO] 0x7fce040014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:06.771_664+00:00 [30131] [INFO] 0x7fce080014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:06.772_891+00:00 [30131] [INFO] 0x7fcdf00014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:06.773_620+00:00 [30141] [INFO] 0x7fcdf8001840 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:12.707_885+00:00 [30141] [INFO] 0x7fce042c2c10 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:09:20.935_048+00:00 [30147] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:09:20.936_400+00:00 [30147] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:09:20.936_429+00:00 [30147] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:09:20.936_435+00:00 [30147] [INFO] create snapshot idx 100000 log_term 2 done: 24 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:09:51.844_629+00:00 [30335] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:09:51.846_363+00:00 [30335] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:09:51.846_399+00:00 [30335] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:09:51.846_406+00:00 [30335] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:09:51.846_435+00:00 [30335] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:09:51.846_440+00:00 [30335] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:09:51.846_444+00:00 [30335] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:09:51.846_496+00:00 [30335] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:09:51.846_721+00:00 [30372] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:09:53.789_854+00:00 [30343] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:09:53.789_866+00:00 [30343] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:09:53.789_882+00:00 [30343] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:09:53.789_894+00:00 [30343] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:09:53.789_901+00:00 [30343] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:09:53.789_905+00:00 [30343] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:09:53.789_925+00:00 [30343] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:09:53.789_985+00:00 [30371] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:09:53.789_994+00:00 [30371] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:09:53.790_005+00:00 [30371] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:10:03.408_878+00:00 [30343] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:10:03.408_901+00:00 [30343] [INFO] session 1 got connection from 127.0.0.1:51294 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:10:03.409_025+00:00 [30343] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:10:03.409_052+00:00 [30343] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:10:03.409_124+00:00 [30343] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:10:03.409_170+00:00 [30343] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:10:03.409_175+00:00 [30343] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:10:03.409_177+00:00 [30343] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:10:03.409_189+00:00 [30343] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:10:03.410_042+00:00 [30343] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51294 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:10:03.910_347+00:00 [30343] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:10:03.910_366+00:00 [30343] [INFO] session 2 got connection from 127.0.0.1:51296 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:10:03.910_484+00:00 [30343] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:10:03.910_487+00:00 [30343] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:10:03.910_724+00:00 [30343] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:10:03.910_729+00:00 [30343] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:10:03.910_800+00:00 [30371] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:10:03.910_803+00:00 [30371] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:10:03.910_812+00:00 [30371] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:10:03.910_814+00:00 [30371] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:10:03.910_821+00:00 [30371] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:10:03.910_835+00:00 [30371] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:10:03.910_839+00:00 [30371] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:10:03.910_858+00:00 [30371] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:10:23.903_058+00:00 [30356] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51296 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:10:24.642_419+00:00 [30356] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:10:24.642_444+00:00 [30356] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:10:24.642_453+00:00 [30356] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:10:24.642_533+00:00 [30356] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:10:24.642_592+00:00 [30356] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:10:24.643_091+00:00 [30356] [INFO] 0x7f1b70002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:24.643_283+00:00 [30356] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:10:24.643_366+00:00 [30356] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:10:25.175_927+00:00 [30339] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:10:25.175_940+00:00 [30339] [INFO] session 3 got connection from 127.0.0.1:51298 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:10:25.176_040+00:00 [30339] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:10:25.176_048+00:00 [30339] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:10:25.176_251+00:00 [30339] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:10:25.176_273+00:00 [30339] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:10:25.176_281+00:00 [30339] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:10:25.176_293+00:00 [30339] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:10:25.176_523+00:00 [30339] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:10:25.176_749+00:00 [30371] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:10:25.176_771+00:00 [30371] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:10:25.176_786+00:00 [30371] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:10:28.903_568+00:00 [30342] [INFO] 0x7f1b30001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.903_822+00:00 [30342] [INFO] 0x7f1b2c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.904_167+00:00 [30342] [INFO] 0x7f1b240014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.904_469+00:00 [30342] [INFO] 0x7f1b180014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.904_816+00:00 [30342] [INFO] 0x7f1b1c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.905_215+00:00 [30349] [INFO] 0x7f1b0c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.906_637+00:00 [30367] [INFO] 0x7f1b040014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.907_594+00:00 [30361] [INFO] 0x7f1b0c014fa0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.908_073+00:00 [30361] [INFO] 0x7f1b1c015e50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:28.909_076+00:00 [30362] [INFO] 0x7f1b18014fa0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:10:48.341_929+00:00 [30371] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:10:48.341_942+00:00 [30371] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:10:48.342_128+00:00 [30371] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:10:48.342_135+00:00 [30371] [INFO] create snapshot idx 100000 log_term 2 done: 186 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:11:13.976_459+00:00 [30543] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:11:13.977_803+00:00 [30543] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:11:13.977_833+00:00 [30543] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:11:13.977_838+00:00 [30543] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:11:13.977_859+00:00 [30543] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:11:13.977_863+00:00 [30543] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:11:13.977_865+00:00 [30543] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:11:13.977_898+00:00 [30543] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:11:13.978_043+00:00 [30580] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:11:15.658_075+00:00 [30551] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:11:15.658_085+00:00 [30551] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:11:15.658_100+00:00 [30551] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:11:15.658_112+00:00 [30551] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:11:15.658_119+00:00 [30551] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:11:15.658_124+00:00 [30551] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:11:15.658_145+00:00 [30551] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:11:15.658_193+00:00 [30579] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:11:15.658_201+00:00 [30579] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:11:15.658_211+00:00 [30579] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:11:25.541_011+00:00 [30551] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:11:25.541_035+00:00 [30551] [INFO] session 1 got connection from 127.0.0.1:51300 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:11:25.541_145+00:00 [30551] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:11:25.541_170+00:00 [30551] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:11:25.541_232+00:00 [30551] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:11:25.541_268+00:00 [30551] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:11:25.541_271+00:00 [30551] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:11:25.541_273+00:00 [30551] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:11:25.541_282+00:00 [30551] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:11:25.542_058+00:00 [30551] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51300 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:11:26.042_400+00:00 [30551] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:11:26.042_417+00:00 [30551] [INFO] session 2 got connection from 127.0.0.1:51302 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:11:26.042_535+00:00 [30551] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:11:26.042_540+00:00 [30551] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:11:26.042_728+00:00 [30551] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:11:26.042_732+00:00 [30551] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:11:26.042_802+00:00 [30579] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:11:26.042_805+00:00 [30579] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:11:26.042_814+00:00 [30579] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:11:26.042_816+00:00 [30579] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:11:26.042_823+00:00 [30579] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:11:26.042_837+00:00 [30579] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:11:26.042_842+00:00 [30579] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:11:26.042_861+00:00 [30579] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:11:45.784_065+00:00 [30570] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51302 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:11:46.675_904+00:00 [30570] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:11:46.675_918+00:00 [30570] [INFO] session 3 got connection from 127.0.0.1:51304 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:11:46.676_018+00:00 [30570] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:11:46.676_026+00:00 [30570] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:11:47.320_216+00:00 [30570] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:11:47.320_239+00:00 [30570] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:11:47.320_247+00:00 [30570] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:11:47.320_332+00:00 [30570] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:11:47.320_370+00:00 [30570] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:11:47.320_819+00:00 [30570] [INFO] 0x7f09e4013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:11:47.321_026+00:00 [30570] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:47.321_087+00:00 [30570] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:11:47.321_090+00:00 [30570] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:11:47.321_092+00:00 [30570] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:11:47.321_102+00:00 [30570] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:11:47.321_259+00:00 [30570] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:11:47.321_263+00:00 [30570] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:11:47.321_270+00:00 [30570] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:11:47.321_274+00:00 [30570] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:11:47.321_314+00:00 [30570] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:11:47.321_421+00:00 [30570] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:11:47.321_616+00:00 [30579] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:11:47.321_638+00:00 [30579] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:11:47.321_654+00:00 [30579] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:11:47.321_805+00:00 [30570] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:47.821_775+00:00 [30548] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:48.371_914+00:00 [30548] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:48.972_104+00:00 [30548] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:49.622_268+00:00 [30548] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:50.322_568+00:00 [30548] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:50.784_404+00:00 [30548] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:50.912_356+00:00 [30572] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:51.168_716+00:00 [30568] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:51.669_107+00:00 [30577] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:52.168_889+00:00 [30570] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:52.669_074+00:00 [30552] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:53.169_638+00:00 [30548] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:53.670_052+00:00 [30570] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:54.169_866+00:00 [30574] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:54.670_527+00:00 [30559] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:55.170_912+00:00 [30561] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:55.531_121+00:00 [30579] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:11:55.531_128+00:00 [30579] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:11:55.531_148+00:00 [30579] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:11:55.531_153+00:00 [30579] [INFO] create snapshot idx 100000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:11:55.671_022+00:00 [30564] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:11:56.170_845+00:00 [30566] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:12:00.265_536+00:00 [30579] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:12:00.265_544+00:00 [30579] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:12:00.265_565+00:00 [30579] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:12:00.265_570+00:00 [30579] [INFO] create snapshot idx 200000 log_term 2 done: 21 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:12:05.018_481+00:00 [30579] [INFO] creating a snapshot for index 300000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:12:05.018_489+00:00 [30579] [INFO] create snapshot idx 300000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:12:05.018_509+00:00 [30579] [INFO] snapshot idx 300000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:12:05.018_514+00:00 [30579] [INFO] create snapshot idx 300000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:12:09.770_769+00:00 [30579] [INFO] creating a snapshot for index 400000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:12:09.770_777+00:00 [30579] [INFO] create snapshot idx 400000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:12:09.770_798+00:00 [30579] [INFO] snapshot idx 400000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:12:09.770_803+00:00 [30579] [INFO] create snapshot idx 400000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:12:35.894_795+00:00 [30786] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:12:35.896_361+00:00 [30786] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:12:35.896_392+00:00 [30786] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:12:35.896_398+00:00 [30786] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:12:35.896_424+00:00 [30786] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:12:35.896_428+00:00 [30786] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:12:35.896_430+00:00 [30786] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:12:35.896_461+00:00 [30786] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:12:35.896_626+00:00 [30823] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:12:37.283_676+00:00 [30794] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:12:37.283_688+00:00 [30794] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:12:37.283_701+00:00 [30794] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:12:37.283_712+00:00 [30794] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:12:37.283_719+00:00 [30794] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:12:37.283_722+00:00 [30794] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:12:37.283_740+00:00 [30794] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:12:37.283_791+00:00 [30822] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:12:37.283_799+00:00 [30822] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:12:37.283_809+00:00 [30822] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:12:48.209_430+00:00 [30794] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:12:48.209_452+00:00 [30794] [INFO] session 1 got connection from 127.0.0.1:51306 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:12:48.209_564+00:00 [30794] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:12:48.209_592+00:00 [30794] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:12:48.209_658+00:00 [30794] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:12:48.209_694+00:00 [30794] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:12:48.209_697+00:00 [30794] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:12:48.209_700+00:00 [30794] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:12:48.209_709+00:00 [30794] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:12:48.210_577+00:00 [30794] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51306 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:12:48.710_906+00:00 [30794] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:12:48.710_922+00:00 [30794] [INFO] session 2 got connection from 127.0.0.1:51308 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:12:48.711_026+00:00 [30794] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:12:48.711_030+00:00 [30794] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:12:48.711_194+00:00 [30794] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:12:48.711_199+00:00 [30794] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:12:48.711_273+00:00 [30822] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:12:48.711_276+00:00 [30822] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:12:48.711_285+00:00 [30822] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:12:48.711_287+00:00 [30822] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:12:48.711_294+00:00 [30822] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:12:48.711_308+00:00 [30822] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:12:48.711_313+00:00 [30822] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:12:48.711_332+00:00 [30822] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:13:07.452_544+00:00 [30810] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51308 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:13:08.733_592+00:00 [30810] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:13:08.733_615+00:00 [30810] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:13:08.733_623+00:00 [30810] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:13:08.733_697+00:00 [30810] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:13:08.733_741+00:00 [30810] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:13:08.734_184+00:00 [30810] [INFO] 0x7fbf90002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:08.734_388+00:00 [30810] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:13:08.734_457+00:00 [30810] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:13:08.957_767+00:00 [30810] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:13:08.957_782+00:00 [30810] [INFO] session 3 got connection from 127.0.0.1:51310 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:13:08.957_857+00:00 [30810] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:13:08.957_866+00:00 [30810] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:13:08.958_065+00:00 [30810] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:13:08.958_086+00:00 [30810] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:13:08.958_096+00:00 [30810] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:13:08.958_107+00:00 [30810] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:13:08.958_352+00:00 [30815] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:13:08.958_511+00:00 [30822] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:13:08.958_529+00:00 [30822] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:13:08.958_541+00:00 [30822] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:13:12.453_068+00:00 [30815] [INFO] 0x7fbf48001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.453_363+00:00 [30815] [INFO] 0x7fbf400014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.453_789+00:00 [30815] [INFO] 0x7fbf440014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.454_006+00:00 [30815] [INFO] 0x7fbf380014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.454_209+00:00 [30815] [INFO] 0x7fbf300014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.454_407+00:00 [30815] [INFO] 0x7fbf340014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.454_991+00:00 [30815] [INFO] 0x7fbf280014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.457_050+00:00 [30814] [INFO] 0x7fbf34014f60 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.457_418+00:00 [30814] [INFO] 0x7fbf24001840 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:12.458_248+00:00 [30800] [INFO] 0x7fbf340294f0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:13:30.292_901+00:00 [30822] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:13:30.293_163+00:00 [30822] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:13:30.293_278+00:00 [30822] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:13:30.293_343+00:00 [30822] [INFO] create snapshot idx 100000 log_term 2 done: 172 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:13:57.526_197+00:00 [31008] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:13:57.527_586+00:00 [31008] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:13:57.527_618+00:00 [31008] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:13:57.527_624+00:00 [31008] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:13:57.527_648+00:00 [31008] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:13:57.527_652+00:00 [31008] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:13:57.527_655+00:00 [31008] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:13:57.527_686+00:00 [31008] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:13:57.527_838+00:00 [31045] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:13:59.275_892+00:00 [31016] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:13:59.275_905+00:00 [31016] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:13:59.275_923+00:00 [31016] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:13:59.275_936+00:00 [31016] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:13:59.275_945+00:00 [31016] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:13:59.275_950+00:00 [31016] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:13:59.275_974+00:00 [31016] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:13:59.276_038+00:00 [31044] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:13:59.276_048+00:00 [31044] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:13:59.276_061+00:00 [31044] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:14:09.838_165+00:00 [31016] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:14:09.838_188+00:00 [31016] [INFO] session 1 got connection from 127.0.0.1:51312 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:14:09.838_292+00:00 [31016] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:14:09.838_318+00:00 [31016] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:14:09.838_380+00:00 [31016] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:14:09.838_414+00:00 [31016] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:14:09.838_417+00:00 [31016] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:14:09.838_419+00:00 [31016] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:14:09.838_429+00:00 [31016] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:14:09.839_179+00:00 [31016] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51312 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:14:10.339_563+00:00 [31016] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:14:10.339_578+00:00 [31016] [INFO] session 2 got connection from 127.0.0.1:51314 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:14:10.339_682+00:00 [31016] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:14:10.339_686+00:00 [31016] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:14:10.339_857+00:00 [31016] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:14:10.339_861+00:00 [31016] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:14:10.339_930+00:00 [31044] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:14:10.339_933+00:00 [31044] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:14:10.339_942+00:00 [31044] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:14:10.339_944+00:00 [31044] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:14:10.339_951+00:00 [31044] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:14:10.339_964+00:00 [31044] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:14:10.339_969+00:00 [31044] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:14:10.339_988+00:00 [31044] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:14:29.333_707+00:00 [31036] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51314 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:14:30.480_049+00:00 [31036] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:14:30.480_073+00:00 [31036] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:14:30.480_081+00:00 [31036] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:14:30.480_159+00:00 [31036] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:14:30.480_205+00:00 [31036] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:14:30.480_674+00:00 [31036] [INFO] 0x7fc798002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:30.480_873+00:00 [31036] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:14:30.480_943+00:00 [31036] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:14:30.733_338+00:00 [31036] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:14:30.733_353+00:00 [31036] [INFO] session 3 got connection from 127.0.0.1:51316 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:14:30.733_429+00:00 [31036] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:14:30.733_436+00:00 [31036] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:14:30.733_712+00:00 [31036] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:14:30.733_735+00:00 [31036] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:14:30.733_744+00:00 [31036] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:14:30.733_756+00:00 [31036] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:14:30.734_003+00:00 [31037] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:14:30.734_193+00:00 [31044] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:14:30.734_215+00:00 [31044] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:14:30.734_228+00:00 [31044] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:14:34.334_208+00:00 [31037] [INFO] 0x7fc74c001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.334_462+00:00 [31037] [INFO] 0x7fc7440014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.334_829+00:00 [31037] [INFO] 0x7fc73c0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.335_394+00:00 [31031] [INFO] 0x7fc7340014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.336_286+00:00 [31025] [INFO] 0x7fc724001880 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.336_791+00:00 [31025] [INFO] 0x7fc72c001760 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.337_423+00:00 [31023] [INFO] 0x7fc744014f40 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.338_297+00:00 [31043] [INFO] 0x7fc734015010 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.340_023+00:00 [31025] [INFO] 0x7fc734028600 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:34.340_375+00:00 [31028] [INFO] 0x7fc744028960 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:14:50.913_825+00:00 [31044] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:14:50.913_833+00:00 [31044] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:14:50.913_854+00:00 [31044] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:14:50.913_860+00:00 [31044] [INFO] create snapshot idx 100000 log_term 2 done: 21 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:15:19.402_326+00:00 [31238] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:15:19.403_726+00:00 [31238] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:15:19.403_757+00:00 [31238] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:15:19.403_764+00:00 [31238] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:15:19.403_784+00:00 [31238] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:15:19.403_788+00:00 [31238] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:15:19.403_790+00:00 [31238] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:15:19.403_818+00:00 [31238] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:15:19.403_971+00:00 [31275] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:15:20.871_022+00:00 [31246] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:15:20.871_035+00:00 [31246] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:15:20.871_049+00:00 [31246] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:15:20.871_060+00:00 [31246] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:15:20.871_066+00:00 [31246] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:15:20.871_070+00:00 [31246] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:15:20.871_088+00:00 [31246] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:15:20.871_140+00:00 [31274] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:15:20.871_148+00:00 [31274] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:15:20.871_158+00:00 [31274] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:15:31.216_338+00:00 [31246] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:15:31.216_363+00:00 [31246] [INFO] session 1 got connection from 127.0.0.1:51320 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:15:31.216_474+00:00 [31246] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:15:31.216_503+00:00 [31246] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:15:31.216_570+00:00 [31246] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:15:31.216_608+00:00 [31246] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:15:31.216_611+00:00 [31246] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:15:31.216_613+00:00 [31246] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:15:31.216_622+00:00 [31246] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:15:31.217_352+00:00 [31246] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51320 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:15:31.717_716+00:00 [31246] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:15:31.717_732+00:00 [31246] [INFO] session 2 got connection from 127.0.0.1:51322 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:15:31.717_833+00:00 [31246] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:15:31.717_837+00:00 [31246] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:15:31.718_011+00:00 [31246] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:15:31.718_015+00:00 [31246] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:15:31.718_082+00:00 [31274] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:15:31.718_085+00:00 [31274] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:15:31.718_094+00:00 [31274] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:15:31.718_096+00:00 [31274] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:15:31.718_104+00:00 [31274] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:15:31.718_117+00:00 [31274] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:15:31.718_122+00:00 [31274] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:15:31.718_141+00:00 [31274] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:15:50.959_869+00:00 [31262] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51322 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:15:51.748_307+00:00 [31262] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:15:51.748_321+00:00 [31262] [INFO] session 3 got connection from 127.0.0.1:51324 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:15:51.748_421+00:00 [31262] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:15:51.748_430+00:00 [31262] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:15:52.312_248+00:00 [31262] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:15:52.312_271+00:00 [31262] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:15:52.312_279+00:00 [31262] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:15:52.312_362+00:00 [31262] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:15:52.312_402+00:00 [31262] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:15:52.312_855+00:00 [31262] [INFO] 0x7fab1c013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:15:52.313_050+00:00 [31262] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:52.313_117+00:00 [31262] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:15:52.313_119+00:00 [31262] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:15:52.313_121+00:00 [31262] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:15:52.313_132+00:00 [31262] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:15:52.313_297+00:00 [31262] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:15:52.313_301+00:00 [31262] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:15:52.313_308+00:00 [31262] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:15:52.313_313+00:00 [31262] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:15:52.313_349+00:00 [31262] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:15:52.313_459+00:00 [31262] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:15:52.313_646+00:00 [31274] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:15:52.313_665+00:00 [31274] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:15:52.313_678+00:00 [31274] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:15:52.313_823+00:00 [31262] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:52.813_750+00:00 [31264] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:53.363_852+00:00 [31264] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:53.964_035+00:00 [31264] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:54.614_225+00:00 [31264] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:55.314_589+00:00 [31261] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:55.960_407+00:00 [31261] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:56.088_307+00:00 [31265] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:56.344_537+00:00 [31262] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:56.844_513+00:00 [31261] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:57.344_505+00:00 [31263] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:57.844_517+00:00 [31244] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:58.344_546+00:00 [31248] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:58.844_849+00:00 [31246] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:59.344_760+00:00 [31253] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:15:59.844_901+00:00 [31272] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:16:00.344_800+00:00 [31264] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:16:00.845_082+00:00 [31242] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:16:01.344_955+00:00 [31273] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:16:06.586_410+00:00 [31274] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:16:06.586_417+00:00 [31274] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:16:06.586_553+00:00 [31274] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:16:06.586_560+00:00 [31274] [INFO] create snapshot idx 100000 log_term 2 done: 138 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:16:41.040_250+00:00 [31483] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:16:41.041_577+00:00 [31483] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:16:41.041_612+00:00 [31483] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:16:41.041_617+00:00 [31483] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:16:41.041_641+00:00 [31483] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:16:41.041_644+00:00 [31483] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:16:41.041_647+00:00 [31483] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:16:41.041_681+00:00 [31483] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:16:41.041_828+00:00 [31520] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:16:42.430_917+00:00 [31491] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:16:42.430_929+00:00 [31491] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:16:42.430_944+00:00 [31491] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:16:42.430_959+00:00 [31491] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:16:42.430_965+00:00 [31491] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:16:42.430_969+00:00 [31491] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:16:42.430_987+00:00 [31491] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:16:42.431_039+00:00 [31519] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:16:42.431_048+00:00 [31519] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:16:42.431_058+00:00 [31519] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:16:52.854_793+00:00 [31491] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:16:52.854_815+00:00 [31491] [INFO] session 1 got connection from 127.0.0.1:51326 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:16:52.854_921+00:00 [31491] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:16:52.854_946+00:00 [31491] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:16:52.855_007+00:00 [31491] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:16:52.855_049+00:00 [31491] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:16:52.855_052+00:00 [31491] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:16:52.855_054+00:00 [31491] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:16:52.855_063+00:00 [31491] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:16:52.855_799+00:00 [31491] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51326 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:16:53.356_124+00:00 [31491] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:16:53.356_140+00:00 [31491] [INFO] session 2 got connection from 127.0.0.1:51328 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:16:53.356_245+00:00 [31491] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:16:53.356_248+00:00 [31491] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:16:53.356_411+00:00 [31491] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:16:53.356_415+00:00 [31491] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:16:53.356_482+00:00 [31519] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:16:53.356_485+00:00 [31519] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:16:53.356_494+00:00 [31519] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:16:53.356_496+00:00 [31519] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:16:53.356_503+00:00 [31519] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:16:53.356_516+00:00 [31519] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:16:53.356_522+00:00 [31519] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:16:53.356_541+00:00 [31519] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:17:12.598_004+00:00 [31510] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51328 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:17:13.859_347+00:00 [31510] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:17:13.859_361+00:00 [31510] [INFO] session 3 got connection from 127.0.0.1:51330 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:17:13.859_463+00:00 [31510] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:17:13.859_471+00:00 [31510] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:17:14.353_568+00:00 [31510] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:17:14.353_592+00:00 [31510] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:17:14.353_600+00:00 [31510] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:17:14.353_684+00:00 [31510] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:17:14.353_723+00:00 [31510] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:17:14.354_178+00:00 [31510] [INFO] 0x7fb998013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:17:14.354_379+00:00 [31510] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:14.354_444+00:00 [31510] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:17:14.354_447+00:00 [31510] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:17:14.354_448+00:00 [31510] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:17:14.354_458+00:00 [31510] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:17:14.354_625+00:00 [31510] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:17:14.354_629+00:00 [31510] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:17:14.354_636+00:00 [31510] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:17:14.354_640+00:00 [31510] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:17:14.354_710+00:00 [31510] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:17:14.354_820+00:00 [31510] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:17:14.355_019+00:00 [31519] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:17:14.355_040+00:00 [31519] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:17:14.355_053+00:00 [31519] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:17:14.355_214+00:00 [31510] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:14.855_202+00:00 [31503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:15.405_262+00:00 [31503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:16.005_435+00:00 [31503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:16.655_607+00:00 [31503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:17.355_994+00:00 [31508] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:17.598_691+00:00 [31508] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:17.726_753+00:00 [31502] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:17.982_730+00:00 [31506] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:18.483_280+00:00 [31517] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:18.983_164+00:00 [31487] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:19.483_373+00:00 [31505] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:19.983_257+00:00 [31488] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:20.483_439+00:00 [31492] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:20.983_428+00:00 [31503] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:21.483_459+00:00 [31498] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:21.983_528+00:00 [31509] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:22.483_551+00:00 [31505] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:17:22.983_535+00:00 [31490] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:17:27.995_176+00:00 [31519] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:17:27.995_183+00:00 [31519] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:17:27.995_295+00:00 [31519] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:17:27.995_301+00:00 [31519] [INFO] create snapshot idx 100000 log_term 2 done: 114 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:20:25.466_949+00:00 [31826] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:20:25.468_325+00:00 [31826] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:20:25.468_366+00:00 [31826] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:20:25.468_370+00:00 [31826] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:20:25.468_395+00:00 [31826] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:20:25.468_400+00:00 [31826] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:20:25.468_403+00:00 [31826] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:20:25.468_436+00:00 [31826] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:20:25.468_599+00:00 [31863] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:20:26.788_676+00:00 [31834] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:20:26.788_688+00:00 [31834] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:20:26.788_702+00:00 [31834] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:20:26.788_714+00:00 [31834] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:20:26.788_719+00:00 [31834] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:20:26.788_723+00:00 [31834] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:20:26.788_742+00:00 [31834] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:20:26.788_798+00:00 [31862] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:20:26.788_806+00:00 [31862] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:20:26.788_816+00:00 [31862] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:20:37.027_359+00:00 [31834] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:20:37.027_386+00:00 [31834] [INFO] session 1 got connection from 127.0.0.1:51332 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:20:37.027_522+00:00 [31834] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:20:37.027_548+00:00 [31834] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:20:37.027_613+00:00 [31834] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:20:37.027_650+00:00 [31834] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:20:37.027_653+00:00 [31834] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:20:37.027_655+00:00 [31834] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:20:37.027_663+00:00 [31834] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:20:37.028_430+00:00 [31834] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51332 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:20:37.528_738+00:00 [31834] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:20:37.528_758+00:00 [31834] [INFO] session 2 got connection from 127.0.0.1:51334 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:20:37.528_882+00:00 [31834] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:20:37.528_887+00:00 [31834] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:20:37.529_058+00:00 [31834] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:20:37.529_063+00:00 [31834] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:20:37.529_132+00:00 [31862] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:20:37.529_136+00:00 [31862] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:20:37.529_146+00:00 [31862] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:20:37.529_147+00:00 [31862] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:20:37.529_155+00:00 [31862] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:20:37.529_168+00:00 [31862] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:20:37.529_173+00:00 [31862] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:20:37.529_191+00:00 [31862] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:20:57.024_546+00:00 [31831] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51334 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:20:58.292_253+00:00 [31831] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:20:58.292_268+00:00 [31831] [INFO] session 3 got connection from 127.0.0.1:51336 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:20:58.292_369+00:00 [31831] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:20:58.292_377+00:00 [31831] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:20:58.526_623+00:00 [31831] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:20:58.526_646+00:00 [31831] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:20:58.526_655+00:00 [31831] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:20:58.526_770+00:00 [31831] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:20:58.526_812+00:00 [31831] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:20:58.527_240+00:00 [31831] [INFO] 0x7f6eac013c50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:20:58.527_432+00:00 [31831] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:20:58.527_492+00:00 [31831] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:20:58.527_495+00:00 [31831] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:20:58.527_497+00:00 [31831] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:20:58.527_506+00:00 [31831] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:20:58.527_666+00:00 [31831] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:20:58.527_670+00:00 [31831] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:20:58.527_677+00:00 [31831] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:20:58.527_681+00:00 [31831] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:20:58.527_725+00:00 [31831] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:20:58.527_834+00:00 [31831] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:20:58.528_021+00:00 [31862] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:20:58.528_039+00:00 [31862] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:20:58.528_053+00:00 [31862] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:20:58.528_190+00:00 [31831] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:20:59.028_197+00:00 [31855] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:20:59.578_284+00:00 [31855] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:00.178_936+00:00 [31855] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:00.828_783+00:00 [31855] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:01.529_157+00:00 [31860] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:02.024_684+00:00 [31860] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:02.152_788+00:00 [31834] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:02.408_968+00:00 [31855] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:02.909_128+00:00 [31856] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:03.409_216+00:00 [31839] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:03.909_366+00:00 [31861] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:04.409_283+00:00 [31851] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:04.909_474+00:00 [31844] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:05.409_618+00:00 [31858] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:05.909_671+00:00 [31852] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:06.409_760+00:00 [31858] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:06.909_878+00:00 [31831] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:21:07.409_790+00:00 [31841] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:21:16.061_698+00:00 [31862] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:21:16.061_707+00:00 [31862] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:21:16.061_732+00:00 [31862] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:21:16.061_738+00:00 [31862] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:21:47.098_245+00:00 [32033] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:21:47.099_628+00:00 [32033] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:21:47.099_659+00:00 [32033] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:21:47.099_667+00:00 [32033] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:21:47.099_689+00:00 [32033] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:21:47.099_692+00:00 [32033] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:21:47.099_696+00:00 [32033] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:21:47.099_725+00:00 [32033] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:21:47.099_877+00:00 [32070] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:21:48.436_947+00:00 [32041] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:21:48.436_959+00:00 [32041] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:21:48.436_974+00:00 [32041] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:21:48.436_985+00:00 [32041] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:21:48.436_991+00:00 [32041] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:21:48.436_994+00:00 [32041] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:21:48.437_013+00:00 [32041] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:21:48.437_065+00:00 [32069] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:21:48.437_072+00:00 [32069] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:21:48.437_082+00:00 [32069] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:21:58.906_375+00:00 [32041] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:21:58.906_397+00:00 [32041] [INFO] session 1 got connection from 127.0.0.1:51338 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:21:58.906_506+00:00 [32041] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:21:58.906_533+00:00 [32041] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:21:58.906_595+00:00 [32041] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:21:58.906_629+00:00 [32041] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:21:58.906_632+00:00 [32041] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:21:58.906_635+00:00 [32041] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:21:58.906_643+00:00 [32041] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:21:58.907_389+00:00 [32041] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51338 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:21:59.408_111+00:00 [32041] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:21:59.408_128+00:00 [32041] [INFO] session 2 got connection from 127.0.0.1:51340 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:21:59.408_234+00:00 [32041] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:21:59.408_238+00:00 [32041] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:21:59.408_402+00:00 [32041] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:21:59.408_406+00:00 [32041] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:21:59.408_474+00:00 [32069] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:21:59.408_477+00:00 [32069] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:21:59.408_486+00:00 [32069] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:21:59.408_488+00:00 [32069] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:21:59.408_494+00:00 [32069] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:21:59.408_509+00:00 [32069] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:21:59.408_513+00:00 [32069] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:21:59.408_533+00:00 [32069] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:22:18.655_641+00:00 [32068] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51340 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:22:19.615_767+00:00 [32068] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:22:19.615_780+00:00 [32068] [INFO] session 3 got connection from 127.0.0.1:51344 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:22:19.615_881+00:00 [32068] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:22:19.615_889+00:00 [32068] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:22:19.809_144+00:00 [32068] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:22:19.809_167+00:00 [32068] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:22:19.809_175+00:00 [32068] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:22:19.809_259+00:00 [32068] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:22:19.809_309+00:00 [32068] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:22:19.809_754+00:00 [32068] [INFO] 0x7f4104013c50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:22:19.809_943+00:00 [32068] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:19.810_006+00:00 [32068] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:22:19.810_009+00:00 [32068] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:22:19.810_010+00:00 [32068] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:22:19.810_020+00:00 [32068] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:22:19.810_172+00:00 [32068] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:22:19.810_176+00:00 [32068] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:22:19.810_182+00:00 [32068] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:22:19.810_186+00:00 [32068] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:22:19.810_227+00:00 [32068] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:22:19.810_335+00:00 [32068] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:22:19.810_527+00:00 [32069] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:22:19.810_547+00:00 [32069] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:22:19.810_560+00:00 [32069] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:22:19.810_742+00:00 [32068] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:20.310_797+00:00 [32044] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:20.860_874+00:00 [32044] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:21.461_062+00:00 [32052] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:22.111_267+00:00 [32052] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:22.811_536+00:00 [32052] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:23.561_582+00:00 [32052] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:23.689_812+00:00 [32042] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:23.946_007+00:00 [32050] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:24.445_925+00:00 [32045] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:24.946_150+00:00 [32046] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:25.446_148+00:00 [32066] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:25.946_276+00:00 [32054] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:26.446_225+00:00 [32048] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:26.946_235+00:00 [32068] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:27.446_298+00:00 [32057] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:27.946_605+00:00 [32055] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:28.446_536+00:00 [32056] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:22:28.946_525+00:00 [32041] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:22:32.117_104+00:00 [32069] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:22:32.117_116+00:00 [32069] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:22:32.117_140+00:00 [32069] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:22:32.117_146+00:00 [32069] [INFO] create snapshot idx 100000 log_term 2 done: 24 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:22:40.612_056+00:00 [32069] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:22:40.612_067+00:00 [32069] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:22:40.612_093+00:00 [32069] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:22:40.612_098+00:00 [32069] [INFO] create snapshot idx 200000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:23:08.742_346+00:00 [32255] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:23:08.743_724+00:00 [32255] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:23:08.743_757+00:00 [32255] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:23:08.743_762+00:00 [32255] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:23:08.743_786+00:00 [32255] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:23:08.743_790+00:00 [32255] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:23:08.743_793+00:00 [32255] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:23:08.743_827+00:00 [32255] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:23:08.743_975+00:00 [32292] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:23:10.594_057+00:00 [32263] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:23:10.594_069+00:00 [32263] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:23:10.594_086+00:00 [32263] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:23:10.594_099+00:00 [32263] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:23:10.594_107+00:00 [32263] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:23:10.594_111+00:00 [32263] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:23:10.594_132+00:00 [32263] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:23:10.594_195+00:00 [32291] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:23:10.594_204+00:00 [32291] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:23:10.594_215+00:00 [32291] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:23:20.553_414+00:00 [32263] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:23:20.553_439+00:00 [32263] [INFO] session 1 got connection from 127.0.0.1:51346 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:23:20.553_546+00:00 [32263] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:23:20.553_573+00:00 [32263] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:23:20.553_642+00:00 [32263] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:23:20.553_675+00:00 [32263] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:23:20.553_678+00:00 [32263] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:23:20.553_680+00:00 [32263] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:23:20.553_688+00:00 [32263] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:23:20.554_481+00:00 [32263] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51346 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:23:21.054_847+00:00 [32263] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:23:21.054_864+00:00 [32263] [INFO] session 2 got connection from 127.0.0.1:51348 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:23:21.054_979+00:00 [32263] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:23:21.054_983+00:00 [32263] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:23:21.055_169+00:00 [32263] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:23:21.055_174+00:00 [32263] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:23:21.055_249+00:00 [32291] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:23:21.055_252+00:00 [32291] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:23:21.055_261+00:00 [32291] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:23:21.055_263+00:00 [32291] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:23:21.055_270+00:00 [32291] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:23:21.055_284+00:00 [32291] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:23:21.055_289+00:00 [32291] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:23:21.055_309+00:00 [32291] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:23:40.804_529+00:00 [32290] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51348 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:23:42.202_368+00:00 [32290] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:23:42.202_383+00:00 [32290] [INFO] session 3 got connection from 127.0.0.1:51350 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:23:42.202_482+00:00 [32290] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:23:42.202_490+00:00 [32290] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:23:42.389_356+00:00 [32290] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:23:42.389_378+00:00 [32290] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:23:42.389_387+00:00 [32290] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:23:42.389_462+00:00 [32290] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:23:42.389_508+00:00 [32290] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:23:42.389_936+00:00 [32290] [INFO] 0x7f3e48013c50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:23:42.390_121+00:00 [32290] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:23:42.390_128+00:00 [32290] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:23:42.390_131+00:00 [32290] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:23:42.390_142+00:00 [32290] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:23:42.390_182+00:00 [32290] [WARN] failed to send vote request: peer 1 (tcp://localhost:12347) is busy	[handle_vote.cxx:271, request_vote()]
2022-04-27T13:23:42.390_228+00:00 [32290] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:42.390_296+00:00 [32290] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:23:42.390_299+00:00 [32290] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:23:42.390_306+00:00 [32290] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:23:42.390_309+00:00 [32290] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:23:42.390_348+00:00 [32290] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:23:42.390_422+00:00 [32290] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:23:42.390_698+00:00 [32291] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:23:42.390_715+00:00 [32291] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:23:42.390_726+00:00 [32291] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:23:42.390_851+00:00 [32290] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:42.890_784+00:00 [32290] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:43.440_909+00:00 [32290] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:44.041_067+00:00 [32290] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:44.691_171+00:00 [32263] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:45.391_383+00:00 [32263] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:45.804_874+00:00 [32263] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:45.932_900+00:00 [32287] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:46.189_029+00:00 [32262] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:46.689_281+00:00 [32273] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:47.189_137+00:00 [32281] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:47.689_188+00:00 [32261] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:48.189_268+00:00 [32281] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:48.689_495+00:00 [32283] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:49.189_723+00:00 [32277] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:49.689_805+00:00 [32273] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:50.189_821+00:00 [32287] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:50.689_666+00:00 [32286] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:23:51.190_068+00:00 [32281] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:23:52.465_550+00:00 [32291] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:23:52.465_560+00:00 [32291] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:23:52.465_585+00:00 [32291] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:23:52.465_590+00:00 [32291] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:23:59.165_425+00:00 [32291] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:23:59.165_433+00:00 [32291] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:23:59.165_456+00:00 [32291] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:23:59.165_461+00:00 [32291] [INFO] create snapshot idx 200000 log_term 2 done: 23 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:24:30.894_819+00:00 [32470] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:24:30.896_300+00:00 [32470] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:24:30.896_331+00:00 [32470] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:24:30.896_336+00:00 [32470] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:24:30.896_360+00:00 [32470] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:24:30.896_364+00:00 [32470] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:24:30.896_367+00:00 [32470] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:24:30.896_398+00:00 [32470] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:24:30.896_545+00:00 [32507] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:24:32.884_621+00:00 [32478] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:24:32.884_633+00:00 [32478] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:24:32.884_648+00:00 [32478] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:24:32.884_666+00:00 [32478] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:24:32.884_673+00:00 [32478] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:24:32.884_676+00:00 [32478] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:24:32.884_696+00:00 [32478] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:24:32.884_763+00:00 [32506] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:24:32.884_772+00:00 [32506] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:24:32.884_782+00:00 [32506] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:24:42.455_284+00:00 [32478] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:24:42.455_310+00:00 [32478] [INFO] session 1 got connection from 127.0.0.1:51352 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:24:42.455_425+00:00 [32478] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:24:42.455_452+00:00 [32478] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:24:42.455_519+00:00 [32478] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:24:42.455_557+00:00 [32478] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:24:42.455_560+00:00 [32478] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:24:42.455_563+00:00 [32478] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:24:42.455_572+00:00 [32478] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:24:42.456_494+00:00 [32478] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51352 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:24:42.956_749+00:00 [32478] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:24:42.956_764+00:00 [32478] [INFO] session 2 got connection from 127.0.0.1:51354 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:24:42.956_862+00:00 [32478] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:24:42.956_865+00:00 [32478] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:24:42.957_009+00:00 [32478] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:24:42.957_013+00:00 [32478] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:24:42.957_091+00:00 [32506] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:24:42.957_094+00:00 [32506] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:24:42.957_102+00:00 [32506] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:24:42.957_104+00:00 [32506] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:24:42.957_111+00:00 [32506] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:24:42.957_125+00:00 [32506] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:24:42.957_129+00:00 [32506] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:24:42.957_148+00:00 [32506] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:25:02.952_486+00:00 [32475] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51354 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:25:03.721_099+00:00 [32475] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:25:03.721_121+00:00 [32475] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:25:03.721_130+00:00 [32475] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:25:03.721_206+00:00 [32475] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:25:03.721_249+00:00 [32475] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:25:03.722_089+00:00 [32475] [INFO] 0x7f8334002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:03.722_282+00:00 [32475] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:25:03.722_357+00:00 [32475] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:25:04.106_341+00:00 [32493] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:25:04.106_354+00:00 [32493] [INFO] session 3 got connection from 127.0.0.1:51356 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:25:04.106_459+00:00 [32493] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:25:04.106_467+00:00 [32493] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:25:04.106_648+00:00 [32493] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:25:04.106_692+00:00 [32493] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:25:04.106_701+00:00 [32493] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:25:04.106_712+00:00 [32493] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:25:04.106_931+00:00 [32493] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:25:04.107_126+00:00 [32506] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:25:04.107_146+00:00 [32506] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:25:04.107_159+00:00 [32506] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:25:07.952_538+00:00 [32478] [INFO] 0x7f82fc001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:07.952_849+00:00 [32478] [INFO] 0x7f82f80014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:07.953_455+00:00 [32478] [INFO] 0x7f82ec0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:07.953_765+00:00 [32478] [INFO] 0x7f82e40014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:07.954_768+00:00 [32500] [INFO] 0x7f82dc0014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:07.955_161+00:00 [32500] [INFO] 0x7f82c80014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:07.956_883+00:00 [32500] [INFO] 0x7f82c00014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:07.957_244+00:00 [32493] [INFO] 0x7f82c8014fa0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:13.153_873+00:00 [32500] [INFO] 0x7f82c80301c0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:14.433_999+00:00 [32493] [INFO] 0x7f82e4018ef0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:25:21.986_392+00:00 [32506] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:25:21.986_404+00:00 [32506] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:25:21.986_429+00:00 [32506] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:25:21.986_434+00:00 [32506] [INFO] create snapshot idx 100000 log_term 2 done: 25 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:25:53.026_876+00:00 [32685] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:25:53.028_225+00:00 [32685] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:25:53.028_259+00:00 [32685] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:25:53.028_265+00:00 [32685] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:25:53.028_289+00:00 [32685] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:25:53.028_293+00:00 [32685] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:25:53.028_296+00:00 [32685] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:25:53.028_328+00:00 [32685] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:25:53.028_477+00:00 [32722] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:25:54.429_576+00:00 [32693] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:25:54.429_588+00:00 [32693] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:25:54.429_603+00:00 [32693] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:25:54.429_614+00:00 [32693] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:25:54.429_622+00:00 [32693] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:25:54.429_626+00:00 [32693] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:25:54.429_644+00:00 [32693] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:25:54.429_698+00:00 [32721] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:25:54.429_706+00:00 [32721] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:25:54.429_715+00:00 [32721] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:26:05.337_477+00:00 [32693] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:26:05.337_500+00:00 [32693] [INFO] session 1 got connection from 127.0.0.1:51358 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:26:05.337_611+00:00 [32693] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:26:05.337_636+00:00 [32693] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:26:05.337_698+00:00 [32693] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:26:05.337_733+00:00 [32693] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:26:05.337_736+00:00 [32693] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:26:05.337_738+00:00 [32693] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:26:05.337_747+00:00 [32693] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:26:05.338_460+00:00 [32693] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51358 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:26:05.839_093+00:00 [32693] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:26:05.839_110+00:00 [32693] [INFO] session 2 got connection from 127.0.0.1:51360 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:26:05.839_216+00:00 [32693] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:26:05.839_220+00:00 [32693] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:26:05.839_387+00:00 [32693] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:26:05.839_391+00:00 [32693] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:26:05.839_460+00:00 [32721] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:26:05.839_464+00:00 [32721] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:26:05.839_472+00:00 [32721] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:26:05.839_474+00:00 [32721] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:26:05.839_482+00:00 [32721] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:26:05.839_496+00:00 [32721] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:26:05.839_500+00:00 [32721] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:26:05.839_522+00:00 [32721] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:26:24.584_441+00:00 [32712] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51360 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:26:25.814_289+00:00 [32712] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:26:25.814_302+00:00 [32712] [INFO] session 3 got connection from 127.0.0.1:51362 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:26:25.814_405+00:00 [32712] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:26:25.814_413+00:00 [32712] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:26:26.102_788+00:00 [32712] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:26:26.102_812+00:00 [32712] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:26:26.102_820+00:00 [32712] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:26:26.102_913+00:00 [32712] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:26:26.102_962+00:00 [32712] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:26:26.103_422+00:00 [32712] [INFO] 0x7f8eac013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:26:26.103_630+00:00 [32712] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:26.103_699+00:00 [32712] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:26:26.103_702+00:00 [32712] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:26:26.103_704+00:00 [32712] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:26:26.103_715+00:00 [32712] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:26:26.103_886+00:00 [32707] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:26:26.103_892+00:00 [32707] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:26:26.103_902+00:00 [32707] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:26:26.103_905+00:00 [32707] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:26:26.103_941+00:00 [32707] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:26:26.104_063+00:00 [32707] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:26:26.104_263+00:00 [32721] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:26:26.104_285+00:00 [32721] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:26:26.104_302+00:00 [32721] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:26:26.104_460+00:00 [32707] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:26.604_369+00:00 [32707] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:27.154_435+00:00 [32707] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:27.754_579+00:00 [32707] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:28.404_787+00:00 [32707] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:29.105_073+00:00 [32707] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:29.584_763+00:00 [32707] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:29.712_955+00:00 [32705] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:29.969_506+00:00 [32697] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:30.469_581+00:00 [32698] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:30.969_659+00:00 [32709] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:31.469_579+00:00 [32691] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:31.970_041+00:00 [32689] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:32.470_079+00:00 [32711] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:32.970_231+00:00 [32716] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:33.470_191+00:00 [32695] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:33.970_500+00:00 [32690] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:34.470_467+00:00 [32711] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:26:34.779_625+00:00 [32721] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:26:34.779_632+00:00 [32721] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:26:34.779_654+00:00 [32721] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:26:34.779_660+00:00 [32721] [INFO] create snapshot idx 100000 log_term 2 done: 22 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:26:34.970_854+00:00 [32718] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:26:39.990_787+00:00 [32721] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:26:39.990_794+00:00 [32721] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:26:39.990_815+00:00 [32721] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:26:39.990_820+00:00 [32721] [INFO] create snapshot idx 200000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:26:45.213_733+00:00 [32721] [INFO] creating a snapshot for index 300000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:26:45.213_742+00:00 [32721] [INFO] create snapshot idx 300000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:26:45.213_762+00:00 [32721] [INFO] snapshot idx 300000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:26:45.213_767+00:00 [32721] [INFO] create snapshot idx 300000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:27:14.695_309+00:00 [32910] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:27:14.696_714+00:00 [32910] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:27:14.696_749+00:00 [32910] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:27:14.696_755+00:00 [32910] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:27:14.696_782+00:00 [32910] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:27:14.696_786+00:00 [32910] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:27:14.696_789+00:00 [32910] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:27:14.696_820+00:00 [32910] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:27:14.696_977+00:00 [32947] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:27:16.369_036+00:00 [32918] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:27:16.369_048+00:00 [32918] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:27:16.369_062+00:00 [32918] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:27:16.369_073+00:00 [32918] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:27:16.369_080+00:00 [32918] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:27:16.369_084+00:00 [32918] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:27:16.369_103+00:00 [32918] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:27:16.369_154+00:00 [32946] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:27:16.369_163+00:00 [32946] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:27:16.369_173+00:00 [32946] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:27:26.255_888+00:00 [32918] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:27:26.255_912+00:00 [32918] [INFO] session 1 got connection from 127.0.0.1:51364 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:27:26.256_022+00:00 [32918] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:27:26.256_049+00:00 [32918] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:27:26.256_122+00:00 [32918] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:27:26.256_160+00:00 [32918] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:27:26.256_163+00:00 [32918] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:27:26.256_166+00:00 [32918] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:27:26.256_175+00:00 [32918] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:27:26.256_989+00:00 [32918] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51364 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:27:26.757_425+00:00 [32918] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:27:26.757_438+00:00 [32918] [INFO] session 2 got connection from 127.0.0.1:51366 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:27:26.757_535+00:00 [32918] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:27:26.757_538+00:00 [32918] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:27:26.757_690+00:00 [32918] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:27:26.757_694+00:00 [32918] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:27:26.757_762+00:00 [32946] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:27:26.757_765+00:00 [32946] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:27:26.757_773+00:00 [32946] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:27:26.757_775+00:00 [32946] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:27:26.757_782+00:00 [32946] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:27:26.757_796+00:00 [32946] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:27:26.757_800+00:00 [32946] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:27:26.757_819+00:00 [32946] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:27:46.502_863+00:00 [32938] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51366 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:27:47.616_626+00:00 [32938] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:27:47.616_640+00:00 [32938] [INFO] session 3 got connection from 127.0.0.1:51368 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:27:47.616_740+00:00 [32938] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:27:47.616_748+00:00 [32938] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:27:47.806_959+00:00 [32938] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:27:47.806_984+00:00 [32938] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:27:47.806_994+00:00 [32938] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:27:47.807_087+00:00 [32938] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:27:47.807_130+00:00 [32938] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:27:47.807_585+00:00 [32938] [INFO] 0x7ff0c4013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:27:47.807_776+00:00 [32938] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:47.807_841+00:00 [32938] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:27:47.807_844+00:00 [32938] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:27:47.807_846+00:00 [32938] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:27:47.807_856+00:00 [32938] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:27:47.808_013+00:00 [32938] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:27:47.808_017+00:00 [32938] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:27:47.808_024+00:00 [32938] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:27:47.808_028+00:00 [32938] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:27:47.808_073+00:00 [32938] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:27:47.808_185+00:00 [32938] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:27:47.808_380+00:00 [32946] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:27:47.808_402+00:00 [32946] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:27:47.808_418+00:00 [32946] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:27:47.808_588+00:00 [32938] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:48.308_589+00:00 [32914] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:48.858_767+00:00 [32914] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:49.458_914+00:00 [32914] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:50.109_046+00:00 [32914] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:50.809_394+00:00 [32933] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:51.503_250+00:00 [32933] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:51.631_227+00:00 [32917] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:51.887_751+00:00 [32927] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:52.387_691+00:00 [32938] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:52.888_159+00:00 [32930] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:53.388_526+00:00 [32933] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:53.888_439+00:00 [32921] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:54.388_740+00:00 [32922] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:54.888_714+00:00 [32933] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:55.389_255+00:00 [32931] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:55.889_541+00:00 [32939] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:56.280_318+00:00 [32946] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:27:56.280_325+00:00 [32946] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:27:56.280_347+00:00 [32946] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:27:56.280_351+00:00 [32946] [INFO] create snapshot idx 100000 log_term 2 done: 21 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:27:56.389_832+00:00 [32930] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:27:56.889_874+00:00 [32920] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:28:01.075_843+00:00 [32946] [INFO] creating a snapshot for index 200000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:28:01.075_851+00:00 [32946] [INFO] create snapshot idx 200000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:28:01.075_872+00:00 [32946] [INFO] snapshot idx 200000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:28:01.075_876+00:00 [32946] [INFO] create snapshot idx 200000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:28:05.870_945+00:00 [32946] [INFO] creating a snapshot for index 300000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:28:05.870_953+00:00 [32946] [INFO] create snapshot idx 300000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:28:05.870_973+00:00 [32946] [INFO] snapshot idx 300000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:28:05.870_978+00:00 [32946] [INFO] create snapshot idx 300000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:28:10.672_881+00:00 [32946] [INFO] creating a snapshot for index 400000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:28:10.672_889+00:00 [32946] [INFO] create snapshot idx 400000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:28:10.672_910+00:00 [32946] [INFO] snapshot idx 400000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:28:10.672_914+00:00 [32946] [INFO] create snapshot idx 400000 log_term 2 done: 20 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:28:36.613_800+00:00 [33145] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:28:36.615_195+00:00 [33145] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:28:36.615_225+00:00 [33145] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:28:36.615_229+00:00 [33145] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:28:36.615_251+00:00 [33145] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:28:36.615_255+00:00 [33145] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:28:36.615_257+00:00 [33145] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:28:36.615_284+00:00 [33145] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:28:36.615_427+00:00 [33182] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:28:37.968_517+00:00 [33153] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:28:37.968_529+00:00 [33153] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:28:37.968_543+00:00 [33153] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:28:37.968_555+00:00 [33153] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:28:37.968_562+00:00 [33153] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:28:37.968_566+00:00 [33153] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:28:37.968_584+00:00 [33153] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:28:37.968_637+00:00 [33181] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:28:37.968_645+00:00 [33181] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:28:37.968_655+00:00 [33181] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:28:48.424_600+00:00 [33153] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:28:48.424_624+00:00 [33153] [INFO] session 1 got connection from 127.0.0.1:51370 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:28:48.424_731+00:00 [33153] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:28:48.424_758+00:00 [33153] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:28:48.424_822+00:00 [33153] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:28:48.424_857+00:00 [33153] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:28:48.424_860+00:00 [33153] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:28:48.424_862+00:00 [33153] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:28:48.424_870+00:00 [33153] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:28:48.425_605+00:00 [33153] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51370 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:28:48.925_945+00:00 [33153] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:28:48.925_961+00:00 [33153] [INFO] session 2 got connection from 127.0.0.1:51372 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:28:48.926_067+00:00 [33153] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:28:48.926_072+00:00 [33153] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:28:48.926_225+00:00 [33153] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:28:48.926_229+00:00 [33153] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:28:48.926_298+00:00 [33181] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:28:48.926_301+00:00 [33181] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:28:48.926_310+00:00 [33181] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:28:48.926_312+00:00 [33181] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:28:48.926_320+00:00 [33181] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:28:48.926_334+00:00 [33181] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:28:48.926_340+00:00 [33181] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:28:48.926_359+00:00 [33181] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:29:08.171_205+00:00 [33170] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51372 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:29:08.954_332+00:00 [33170] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:29:08.954_347+00:00 [33170] [INFO] session 3 got connection from 127.0.0.1:51374 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:29:08.954_449+00:00 [33170] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:29:08.954_457+00:00 [33170] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:29:09.736_715+00:00 [33170] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:29:09.736_738+00:00 [33170] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:29:09.736_746+00:00 [33170] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:29:09.736_831+00:00 [33170] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:29:09.736_869+00:00 [33170] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:29:09.737_317+00:00 [33170] [INFO] 0x7f6360013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:29:09.737_516+00:00 [33170] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:09.737_580+00:00 [33170] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:29:09.737_583+00:00 [33170] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:29:09.737_584+00:00 [33170] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:29:09.737_594+00:00 [33170] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:29:09.737_744+00:00 [33170] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:29:09.737_747+00:00 [33170] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:29:09.737_753+00:00 [33170] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:29:09.737_756+00:00 [33170] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:29:09.737_789+00:00 [33170] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:29:09.737_882+00:00 [33170] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:29:09.738_049+00:00 [33181] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:29:09.738_065+00:00 [33181] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:29:09.738_109+00:00 [33181] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:29:09.738_249+00:00 [33170] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:10.238_322+00:00 [33177] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:10.788_373+00:00 [33177] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:11.388_568+00:00 [33177] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:12.038_800+00:00 [33177] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:12.739_093+00:00 [33149] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:13.171_575+00:00 [33149] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:13.299_697+00:00 [33151] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:13.555_863+00:00 [33153] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:14.056_115+00:00 [33163] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:14.556_325+00:00 [33163] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:15.056_087+00:00 [33172] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:15.556_469+00:00 [33172] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:16.056_643+00:00 [33159] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:16.556_841+00:00 [33179] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:17.056_963+00:00 [33168] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:17.556_862+00:00 [33177] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:18.057_026+00:00 [33176] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:29:18.557_094+00:00 [33156] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:29:23.420_325+00:00 [33181] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:29:23.420_334+00:00 [33181] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:29:23.420_358+00:00 [33181] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:29:23.420_363+00:00 [33181] [INFO] create snapshot idx 100000 log_term 2 done: 23 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:29:58.250_213+00:00 [33359] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:29:58.251_626+00:00 [33359] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:29:58.251_658+00:00 [33359] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:29:58.251_662+00:00 [33359] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:29:58.251_688+00:00 [33359] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:29:58.251_692+00:00 [33359] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:29:58.251_694+00:00 [33359] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:29:58.251_723+00:00 [33359] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:29:58.251_876+00:00 [33396] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:30:00.219_990+00:00 [33367] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:30:00.220_002+00:00 [33367] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:30:00.220_017+00:00 [33367] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:30:00.220_028+00:00 [33367] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:30:00.220_035+00:00 [33367] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:30:00.220_039+00:00 [33367] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:30:00.220_059+00:00 [33367] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:30:00.220_118+00:00 [33395] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:30:00.220_126+00:00 [33395] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:30:00.220_137+00:00 [33395] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:30:10.560_932+00:00 [33367] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:30:10.560_956+00:00 [33367] [INFO] session 1 got connection from 127.0.0.1:51376 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:30:10.561_064+00:00 [33367] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:30:10.561_090+00:00 [33367] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:30:10.561_153+00:00 [33367] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:30:10.561_187+00:00 [33367] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:30:10.561_190+00:00 [33367] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:30:10.561_192+00:00 [33367] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:30:10.561_201+00:00 [33367] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:30:10.561_973+00:00 [33367] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51376 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:30:11.062_226+00:00 [33367] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:30:11.062_242+00:00 [33367] [INFO] session 2 got connection from 127.0.0.1:51378 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:30:11.062_342+00:00 [33367] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:30:11.062_345+00:00 [33367] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:30:11.062_504+00:00 [33367] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:30:11.062_509+00:00 [33367] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:30:11.062_578+00:00 [33395] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:30:11.062_581+00:00 [33395] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:30:11.062_590+00:00 [33395] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:30:11.062_591+00:00 [33395] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:30:11.062_599+00:00 [33395] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:30:11.062_612+00:00 [33395] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:30:11.062_617+00:00 [33395] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:30:11.062_637+00:00 [33395] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:30:30.308_247+00:00 [33393] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51378 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:30:31.165_830+00:00 [33393] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:30:31.165_845+00:00 [33393] [INFO] session 3 got connection from 127.0.0.1:51380 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:30:31.165_952+00:00 [33393] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:30:31.165_958+00:00 [33393] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:30:31.554_372+00:00 [33393] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:30:31.554_395+00:00 [33393] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:30:31.554_403+00:00 [33393] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:30:31.554_485+00:00 [33393] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:30:31.554_526+00:00 [33393] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:30:31.555_392+00:00 [33393] [INFO] 0x7f02d8013c50 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:30:31.555_588+00:00 [33393] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:31.555_651+00:00 [33393] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:30:31.555_654+00:00 [33393] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:30:31.555_656+00:00 [33393] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:30:31.555_665+00:00 [33393] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:30:31.555_831+00:00 [33393] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:30:31.555_835+00:00 [33393] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:30:31.555_842+00:00 [33393] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:30:31.555_847+00:00 [33393] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:30:31.555_885+00:00 [33393] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:30:31.555_996+00:00 [33393] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:30:31.556_188+00:00 [33395] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:30:31.556_208+00:00 [33395] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:30:31.556_221+00:00 [33395] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:30:31.556_384+00:00 [33393] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:32.056_397+00:00 [33381] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:32.606_494+00:00 [33381] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:33.206_760+00:00 [33381] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:33.856_887+00:00 [33381] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:34.557_244+00:00 [33364] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:35.307_219+00:00 [33364] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:35.435_649+00:00 [33368] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:35.691_740+00:00 [33378] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:36.191_964+00:00 [33377] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:36.691_969+00:00 [33375] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:37.192_073+00:00 [33379] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:37.692_124+00:00 [33393] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:38.192_457+00:00 [33381] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:38.692_451+00:00 [33368] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:39.192_776+00:00 [33371] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:39.692_790+00:00 [33388] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:40.193_178+00:00 [33366] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:30:40.693_024+00:00 [33388] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:30:45.304_824+00:00 [33395] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:30:45.304_833+00:00 [33395] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:30:45.304_989+00:00 [33395] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:30:45.305_134+00:00 [33395] [INFO] create snapshot idx 100000 log_term 2 done: 296 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:31:20.382_924+00:00 [33565] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:31:20.384_335+00:00 [33565] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:31:20.384_369+00:00 [33565] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:31:20.384_373+00:00 [33565] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:31:20.384_397+00:00 [33565] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:31:20.384_401+00:00 [33565] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:31:20.384_404+00:00 [33565] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:31:20.384_438+00:00 [33565] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:31:20.384_594+00:00 [33602] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:31:22.109_649+00:00 [33573] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:31:22.109_660+00:00 [33573] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:31:22.109_675+00:00 [33573] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:31:22.109_692+00:00 [33573] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:31:22.109_698+00:00 [33573] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:31:22.109_701+00:00 [33573] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:31:22.109_720+00:00 [33573] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:31:22.109_773+00:00 [33601] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:31:22.109_781+00:00 [33601] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:31:22.109_791+00:00 [33601] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:31:32.440_462+00:00 [33573] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:31:32.440_484+00:00 [33573] [INFO] session 1 got connection from 127.0.0.1:51382 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:31:32.440_587+00:00 [33573] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:31:32.440_613+00:00 [33573] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:31:32.440_674+00:00 [33573] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:31:32.440_709+00:00 [33573] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:31:32.440_711+00:00 [33573] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:31:32.440_714+00:00 [33573] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:31:32.440_722+00:00 [33573] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:31:32.441_476+00:00 [33573] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51382 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:31:32.941_756+00:00 [33573] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:31:32.941_771+00:00 [33573] [INFO] session 2 got connection from 127.0.0.1:51384 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:31:32.941_867+00:00 [33573] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:31:32.941_872+00:00 [33573] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:31:32.942_022+00:00 [33573] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:31:32.942_026+00:00 [33573] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:31:32.942_095+00:00 [33601] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:31:32.942_098+00:00 [33601] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:31:32.942_108+00:00 [33601] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:31:32.942_110+00:00 [33601] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:31:32.942_117+00:00 [33601] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:31:32.942_131+00:00 [33601] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:31:32.942_136+00:00 [33601] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:31:32.942_157+00:00 [33601] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:31:52.190_740+00:00 [33590] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51384 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:31:52.864_048+00:00 [33590] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:31:52.864_061+00:00 [33590] [INFO] session 3 got connection from 127.0.0.1:51386 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:31:52.864_156+00:00 [33590] [INFO] [PRE-VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB alive	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:31:52.864_164+00:00 [33590] [INFO] pre-vote decision: X (deny)	[handle_vote.cxx:429, handle_prevote_req()]
2022-04-27T13:31:53.779_653+00:00 [33590] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:31:53.779_675+00:00 [33590] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:31:53.779_683+00:00 [33590] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:31:53.779_767+00:00 [33590] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:31:53.779_806+00:00 [33590] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:31:53.780_243+00:00 [33590] [INFO] 0x7f06f8013cc0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:31:53.780_435+00:00 [33590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:53.780_509+00:00 [33590] [INFO] [PRE-VOTE RESP] peer 2 (O), term 1, resp term 1, my role candidate, dead 2, live 0, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:31:53.780_511+00:00 [33590] [INFO] [PRE-VOTE DONE] SUCCESS, term 1	[handle_vote.cxx:475, handle_prevote_resp()]
2022-04-27T13:31:53.780_513+00:00 [33590] [INFO] [PRE-VOTE DONE] initiate actual vote	[handle_vote.cxx:480, handle_prevote_resp()]
2022-04-27T13:31:53.780_523+00:00 [33590] [INFO] [VOTE INIT] my id 3, my role candidate, term 2, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:31:53.780_676+00:00 [33590] [INFO] [VOTE RESP] peer 2 (O), resp term 2, my role candidate, granted 2, responded 2, num voting members 3, quorum 2	[handle_vote.cxx:374, handle_vote_resp()]
2022-04-27T13:31:53.780_680+00:00 [33590] [INFO] Server is elected as leader for term 2	[handle_vote.cxx:383, handle_vote_resp()]
2022-04-27T13:31:53.780_687+00:00 [33590] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:31:53.780_691+00:00 [33590] [INFO] state machine commit index 3, precommit index 3, last log index 3	[raft_server.cxx:953, become_leader()]
2022-04-27T13:31:53.780_727+00:00 [33590] [INFO] [BECOME LEADER] appended new config at 4	[raft_server.cxx:993, become_leader()]
2022-04-27T13:31:53.780_839+00:00 [33590] [INFO]   === LEADER (term 2) ===	[handle_vote.cxx:386, handle_vote_resp()]
2022-04-27T13:31:53.781_030+00:00 [33601] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:31:53.781_050+00:00 [33601] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:31:53.781_064+00:00 [33601] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:31:53.781_226+00:00 [33590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:54.281_262+00:00 [33576] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:54.831_287+00:00 [33590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:55.431_485+00:00 [33590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:56.081_567+00:00 [33590] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:56.781_760+00:00 [33592] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:57.191_106+00:00 [33592] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:57.319_232+00:00 [33597] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:57.575_311+00:00 [33589] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:58.075_575+00:00 [33578] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:58.575_682+00:00 [33591] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:59.075_786+00:00 [33585] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:31:59.575_919+00:00 [33583] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:32:00.076_087+00:00 [33591] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:32:00.575_964+00:00 [33573] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:32:01.076_119+00:00 [33588] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:32:01.576_214+00:00 [33580] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:32:02.076_287+00:00 [33574] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:32:02.576_435+00:00 [33597] [WARN] too verbose RPC error on peer (1), will suppress it from now	[raft_server.cxx:756, handle_peer_resp()]
2022-04-27T13:32:07.716_669+00:00 [33601] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:32:07.716_677+00:00 [33601] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:32:07.716_941+00:00 [33601] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:32:07.716_966+00:00 [33601] [INFO] create snapshot idx 100000 log_term 2 done: 284 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
2022-04-27T13:32:42.262_883+00:00 [33806] [====] Start logger: ./srv3.log (32 MB per file, up to 10 files)	[logger.cc:979, start()]
2022-04-27T13:32:42.264_584+00:00 [33806] [INFO] Raft ASIO listener initiated, UNSECURED	[asio_service.cxx:749, asio_rpc_listener()]
2022-04-27T13:32:42.264_621+00:00 [33806] [INFO] parameters: timeout 1000 - 2000, heartbeat 500, leadership expiry 10000, max batch 100, backoff 50, snapshot distance 100000, log sync stop gap 99999, reserved logs 10000000, client timeout 4000, auto forwarding ON, API call type BLOCKING, custom commit quorum size 0, custom election quorum size 0, snapshot receiver INCLUDED, leadership transfer wait time 0, grace period of lagging state machine 0, snapshot IO: BLOCKING, parallel log appending: OFF	[raft_server.cxx:352, apply_and_log_current_params()]
2022-04-27T13:32:42.264_631+00:00 [33806] [INFO] new timeout range: 1000 -- 2000	[raft_server.cxx:326, update_rand_timeout()]
2022-04-27T13:32:42.264_658+00:00 [33806] [INFO]    === INIT RAFT SERVER ===
commit index 0
term 0
election timer allowed
log store start 1, end 0
config log idx 0, prev log idx 0	[raft_server.cxx:149, raft_server()]
2022-04-27T13:32:42.264_663+00:00 [33806] [INFO] peer 3: DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, voting_member
num peers: 0	[raft_server.cxx:242, raft_server()]
2022-04-27T13:32:42.264_666+00:00 [33806] [INFO] global manager does not exist. will use local thread for commit and append	[raft_server.cxx:260, start_server()]
2022-04-27T13:32:42.264_706+00:00 [33806] [INFO] wait for HB, for 50 + [1000, 2000] ms	[raft_server.cxx:285, start_server()]
2022-04-27T13:32:42.264_882+00:00 [33843] [INFO] bg append_entries thread initiated	[handle_append_entries.cxx:49, append_entries_in_bg()]
2022-04-27T13:32:43.385_923+00:00 [33814] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:32:43.385_935+00:00 [33814] [INFO] [PRIORITY] decay, target 1 -> 1, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:32:43.385_949+00:00 [33814] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 0, state term 0, target p 1, my p 50, hb dead, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:32:43.385_961+00:00 [33814] [INFO] [VOTE INIT] my id 3, my role candidate, term 1, log idx 0, log term 0, priority (target 1 / mine 50)	[handle_vote.cxx:225, request_vote()]
2022-04-27T13:32:43.385_968+00:00 [33814] [INFO] number of pending commit elements: 0	[raft_server.cxx:940, become_leader()]
2022-04-27T13:32:43.385_972+00:00 [33814] [INFO] state machine commit index 0, precommit index 0, last log index 0	[raft_server.cxx:953, become_leader()]
2022-04-27T13:32:43.385_991+00:00 [33814] [INFO] [BECOME LEADER] appended new config at 1	[raft_server.cxx:993, become_leader()]
2022-04-27T13:32:43.386_044+00:00 [33842] [INFO] config at index 1 is committed, prev config log idx 0	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:32:43.386_052+00:00 [33842] [INFO] new config log idx 1, prev log idx 0, cur config log idx 0, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:32:43.386_063+00:00 [33842] [INFO] new configuration: log idx 1, prev log idx 0
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 3, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:32:54.573_780+00:00 [33814] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:32:54.573_806+00:00 [33814] [INFO] session 1 got connection from 127.0.0.1:51388 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:32:54.573_927+00:00 [33814] [INFO] got join cluster req from leader 1	[handle_join_leave.cxx:165, handle_join_cluster_req()]
2022-04-27T13:32:54.573_958+00:00 [33814] [INFO] new config log idx 2, prev log idx 1, cur config log idx 1, prev log idx 0	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:32:54.574_036+00:00 [33814] [INFO] server 1 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:32:54.574_082+00:00 [33814] [INFO] server 2 is added to cluster	[handle_commit.cxx:667, reconfigure()]
2022-04-27T13:32:54.574_086+00:00 [33814] [INFO] peer 3 cannot be found, no action for removing	[handle_commit.cxx:761, reconfigure()]
2022-04-27T13:32:54.574_089+00:00 [33814] [INFO] add peer 1, tcp://localhost:12347, voting member
add peer 2, tcp://localhost:12345, voting member	[handle_commit.cxx:766, reconfigure()]
2022-04-27T13:32:54.574_101+00:00 [33814] [INFO] new configuration: log idx 2, prev log idx 1
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:32:54.574_847+00:00 [33814] [ERRO] session 1 failed to read rpc header from socket 127.0.0.1:51388 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:32:55.075_162+00:00 [33814] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:32:55.075_177+00:00 [33814] [INFO] session 2 got connection from 127.0.0.1:51390 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:32:55.075_285+00:00 [33814] [INFO] [LOG XX] req log idx: 3, req log term: 1, my last log idx: 1, my log (3) term: 0	[handle_append_entries.cxx:570, handle_append_entries()]
2022-04-27T13:32:55.075_288+00:00 [33814] [INFO] deny, req term 1, my term 1, req log idx 3, my log idx 1	[handle_append_entries.cxx:582, handle_append_entries()]
2022-04-27T13:32:55.075_451+00:00 [33814] [INFO] receive a config change from leader at 2	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:32:55.075_456+00:00 [33814] [INFO] receive a config change from leader at 3	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:32:55.075_524+00:00 [33842] [INFO] config at index 1 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:32:55.075_527+00:00 [33842] [INFO] skipped config 1, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:32:55.075_535+00:00 [33842] [INFO] config at index 2 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:32:55.075_537+00:00 [33842] [INFO] skipped config 2, latest config 2	[handle_commit.cxx:405, commit_conf()]
2022-04-27T13:32:55.075_545+00:00 [33842] [INFO] config at index 3 is committed, prev config log idx 2	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:32:55.075_558+00:00 [33842] [INFO] new config log idx 3, prev log idx 2, cur config log idx 2, prev log idx 1	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:32:55.075_563+00:00 [33842] [INFO] now this node is the part of cluster, catch-up process is done, clearing the flag	[handle_commit.cxx:624, reconfigure()]
2022-04-27T13:32:55.075_582+00:00 [33842] [INFO] new configuration: log idx 3, prev log idx 2
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 1, term: 1	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:33:13.571_081+00:00 [33833] [ERRO] session 2 failed to read rpc header from socket 127.0.0.1:51390 due to error 2, End of file, ref count 1	[asio_service.cxx:315, operator()()]
2022-04-27T13:33:14.146_385+00:00 [33833] [WARN] Election timeout, initiate leader election	[handle_timeout.cxx:286, handle_election_timeout()]
2022-04-27T13:33:14.146_408+00:00 [33833] [INFO] [ELECTION TIMEOUT] current role: follower, log last term 1, state term 1, target p 50, my p 50, hb alive, pre-vote NOT done	[handle_timeout.cxx:299, handle_election_timeout()]
2022-04-27T13:33:14.146_417+00:00 [33833] [INFO] reset RPC client for peer 2	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:33:14.146_491+00:00 [33833] [INFO] reset RPC client for peer 1	[handle_vote.cxx:79, request_prevote()]
2022-04-27T13:33:14.146_536+00:00 [33833] [INFO] [PRE-VOTE INIT] my id 3, my role candidate, term 1, log idx 3, log term 1, priority (target 50 / mine 50)	[handle_vote.cxx:134, request_prevote()]
2022-04-27T13:33:14.146_997+00:00 [33833] [INFO] 0x7f349c002b80 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:14.147_200+00:00 [33833] [WARN] peer (1) response error: failed to connect to peer 1, localhost:12347, error 111, Connection refused	[raft_server.cxx:754, handle_peer_resp()]
2022-04-27T13:33:14.147_274+00:00 [33833] [INFO] [PRE-VOTE RESP] peer 2 (X), term 1, resp term 1, my role candidate, dead 1, live 1, num voting members 3, quorum 2	[handle_vote.cxx:465, handle_prevote_resp()]
2022-04-27T13:33:14.626_539+00:00 [33833] [INFO] receive a incoming rpc connection	[asio_service.cxx:809, handle_accept()]
2022-04-27T13:33:14.626_554+00:00 [33833] [INFO] session 3 got connection from 127.0.0.1:51392 (as a server)	[asio_service.cxx:248, prepare_handshake()]
2022-04-27T13:33:14.626_632+00:00 [33833] [INFO] [PRE-VOTE REQ] my role candidate, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 1 / mine 1
HB dead	[handle_vote.cxx:398, handle_prevote_req()]
2022-04-27T13:33:14.626_640+00:00 [33833] [INFO] pre-vote decision: O (grant)	[handle_vote.cxx:425, handle_prevote_req()]
2022-04-27T13:33:14.626_879+00:00 [33833] [INFO] [BECOME FOLLOWER] term 2	[raft_server.cxx:1266, become_follower()]
2022-04-27T13:33:14.626_901+00:00 [33833] [INFO] [PRIORITY] decay, target 50 -> 40, mine 50	[handle_priority.cxx:211, decay_target_priority()]
2022-04-27T13:33:14.626_910+00:00 [33833] [INFO] [VOTE REQ] my role follower, from peer 2, log term: req 1 / mine 1
last idx: req 3 / mine 3, term: req 2 / mine 2
priority: target 40 / mine 50, voted_for -1	[handle_vote.cxx:278, handle_vote_req()]
2022-04-27T13:33:14.626_922+00:00 [33833] [INFO] decision: O (grant), voted_for 2, term 2	[handle_vote.cxx:337, handle_vote_req()]
2022-04-27T13:33:14.627_130+00:00 [33833] [INFO] receive a config change from leader at 4	[handle_append_entries.cxx:726, handle_append_entries()]
2022-04-27T13:33:14.627_365+00:00 [33842] [INFO] config at index 4 is committed, prev config log idx 3	[handle_commit.cxx:396, commit_conf()]
2022-04-27T13:33:14.627_385+00:00 [33842] [INFO] new config log idx 4, prev log idx 3, cur config log idx 3, prev log idx 2	[handle_commit.cxx:589, reconfigure()]
2022-04-27T13:33:14.627_398+00:00 [33842] [INFO] new configuration: log idx 4, prev log idx 3
peer 1, DC ID 1, tcp://localhost:12347, voting member, 50
peer 2, DC ID 1, tcp://localhost:12345, voting member, 50
peer 3, DC ID 1, tcp://localhost:12346, voting member, 50
my id: 3, leader: 2, term: 2	[handle_commit.cxx:809, reconfigure()]
2022-04-27T13:33:18.571_719+00:00 [33830] [INFO] 0x7f3458001630 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.571_997+00:00 [33830] [INFO] 0x7f34540014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.572_353+00:00 [33830] [INFO] 0x7f34440014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.573_236+00:00 [33830] [INFO] 0x7f34240014a0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.573_635+00:00 [33830] [INFO] 0x7f34240157e0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.574_286+00:00 [33819] [INFO] 0x7f3434001980 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.575_179+00:00 [33826] [INFO] 0x7f343c001840 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.576_111+00:00 [33832] [INFO] 0x7f3438002850 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.576_391+00:00 [33832] [INFO] 0x7f3434015b30 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:18.576_823+00:00 [33832] [INFO] 0x7f3424028ff0 connected to localhost:12345 (as a client)	[asio_service.cxx:1233, connected()]
2022-04-27T13:33:34.212_002+00:00 [33842] [INFO] creating a snapshot for index 100000	[handle_commit.cxx:482, snapshot_and_compact()]
2022-04-27T13:33:34.212_009+00:00 [33842] [INFO] create snapshot idx 100000 log_term 2	[handle_commit.cxx:523, snapshot_and_compact()]
2022-04-27T13:33:34.212_026+00:00 [33842] [INFO] snapshot idx 100000 log_term 2 created, compact the log store if needed	[handle_commit.cxx:567, on_snapshot_completed()]
2022-04-27T13:33:34.212_029+00:00 [33842] [INFO] create snapshot idx 100000 log_term 2 done: 16 us elapsed	[handle_commit.cxx:534, snapshot_and_compact()]
